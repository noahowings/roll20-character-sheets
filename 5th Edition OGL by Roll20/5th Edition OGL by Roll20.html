<input class="npc_toggle" name="attr_npc_toggle" type="hidden" value="0">

<div class="container npc compendium-drop-target" style="width: 350px;">
    <input class="npc_options-flag" type="checkbox" name="attr_npc_options-flag" checked="checked"><span>y</span>
    <div class="npc_options">
        <div class="row title">
            <span>NPC OPTIONS</span>
        </div>
        <div class="row">
            <span>NAME</span>
            <input type="text" name="attr_npc_name" accept="Name">
        </div>
        <div class="row">
            <span>NPC TYPE</span>
            <input type="text" name="attr_npc_type" placeholder="Medium fiend, any evil alignment">
        </div>
        <div class="row">
            <span>ARMOR CLASS</span>
            <input class="num" type="text" name="attr_npc_ac" placeholder="10">
            <span>TYPE</span>
            <input type="text" name="attr_npc_actype" placeholder="scale mail">
        </div>
        <div class="row">
            <span>HIT POINTS</span>
            <input class="num" type="text" name="attr_hp_max" placeholder="82">
            <span>FORMULA</span>
            <input type="text" name="attr_npc_hpformula" placeholder="11d8 + 33">
        </div>
        <div class="row">
            <span>SPEED</span>
            <input type="text" name="attr_npc_speed" placeholder="30 ft., fly 60ft." accept="Speed">
        </div>
        <div class="spacer"></div>
        <div class="row">
            <span>ATTRIBUTES</span>
        </div>
        <div class="row">
            <span>STR</span>
            <input class="num" type="text" name="attr_strength" value="10" accept="STR">
            <span>DEX</span>
            <input class="num" type="text" name="attr_dexterity" value="10" accept="DEX">
            <span>CON</span>
            <input class="num" type="text" name="attr_constitution" value="10" accept="CON">
            <span>INT</span>
            <input class="num" type="text" name="attr_intelligence" value="10" accept="INT">
            <span>WIS</span>
            <input class="num" type="text" name="attr_wisdom" value="10" accept="WIS">
            <span>CHA</span>
            <input class="num" type="text" name="attr_charisma" value="10" accept="CHA">
        </div>
        <div class="spacer"></div>
        <div class="row">
            <span>SAVES</span>
        </div>
        <div class="row">
            <span>STR</span>
            <input class="num" type="text" name="attr_npc_str_save" placeholder="0">
            <span>DEX</span>
            <input class="num" type="text" name="attr_npc_dex_save" placeholder="0">
            <span>CON</span>
            <input class="num" type="text" name="attr_npc_con_save" placeholder="0">
            <span>INT</span>
            <input class="num" type="text" name="attr_npc_int_save" placeholder="0">
            <span>WIS</span>
            <input class="num" type="text" name="attr_npc_wis_save" placeholder="0">
            <span>CHA</span>
            <input class="num" type="text" name="attr_npc_cha_save" placeholder="0">
        </div>
        <div class="spacer"></div>
        <div class="row">
            <span>SKILLS</span>
        </div>
        <div class="row">
            <div class="col">
                <div class="row">
                    <span>ACROBATICS</span>
                    <input class="num" type="text" name="attr_npc_acrobatics" placeholder="0">
                </div>
                <div class="row">
                    <span>ANIMAL HANDLING</span>
                    <input class="num" type="text" name="attr_npc_animal_handling" placeholder="0">
                </div>
                <div class="row">
                    <span>ARCANA</span>
                    <input class="num" type="text" name="attr_npc_arcana" placeholder="0">
                </div>
                <div class="row">
                    <span>ATHLETICS</span>
                    <input class="num" type="text" name="attr_npc_athletics" placeholder="0">
                </div>
                <div class="row">
                    <span>DECEPTION</span>
                    <input class="num" type="text" name="attr_npc_deception" placeholder="0">
                </div>
                <div class="row">
                    <span>HISTORY</span>
                    <input class="num" type="text" name="attr_npc_history" placeholder="0">
                </div>
            </div>
            <div class="col">
                <div class="row">
                    <span>INSIGHT</span>
                    <input class="num" type="text" name="attr_npc_insight" placeholder="0">
                </div>
                <div class="row">
                    <span>INTIMIDATION</span>
                    <input class="num" type="text" name="attr_npc_intimidation" placeholder="0">
                </div>
                <div class="row">
                    <span>INVESTIGATION</span>
                    <input class="num" type="text" name="attr_npc_investigation" placeholder="0">
                </div>
                <div class="row">
                    <span>MEDICINE</span>
                    <input class="num" type="text" name="attr_npc_medicine" placeholder="0">
                </div>
                <div class="row">
                    <span>NATURE</span>
                    <input class="num" type="text" name="attr_npc_nature" placeholder="0">
                </div>
                <div class="row">
                    <span>PERCEPTION</span>
                    <input class="num" type="text" name="attr_npc_perception" placeholder="0">
                </div>
            </div>
            <div class="col">
                <div class="row">
                    <span>PERFORMANCE</span>
                    <input class="num" type="text" name="attr_npc_performance" placeholder="0">
                </div>
                <div class="row">
                    <span>PERSUASION</span>
                    <input class="num" type="text" name="attr_npc_persuasion" placeholder="0">
                </div>
                <div class="row">
                    <span>RELIGION</span>
                    <input class="num" type="text" name="attr_npc_religion" placeholder="0">
                </div>
                <div class="row">
                    <span>SLEIGHT OF HAND</span>
                    <input class="num" type="text" name="attr_npc_sleight_of_hand" placeholder="0">
                </div>
                <div class="row">
                    <span>STEALTH</span>
                    <input class="num" type="text" name="attr_npc_stealth" placeholder="0">
                </div>
                <div class="row">
                    <span>SURVIVAL</span>
                    <input class="num" type="text" name="attr_npc_survival" placeholder="0">
                </div>
            </div>
        </div>
        <div class="row">
            <span>DAMAGE VULNERABILITIES</span>
            <input type="text" name="attr_npc_vulnerabilities" placeholder="fire" accept="Vulnerabilities">
        </div>
        <div class="row">
            <span>DAMAGE RESISTANCES</span>
            <input type="text" name="attr_npc_resistances" placeholder="cold" accept="Resistances">
        </div>
        <div class="row">
            <span>DAMAGE IMMUNITIES</span>
            <input type="text" name="attr_npc_immunities" placeholder="lighting, thunder" accept="Immunities">
        </div>
        <div class="row">
            <span>CONDITION IMMUNITIES</span>
            <input type="text" name="attr_npc_condition_immunities" placeholder="charmed" accept="Condition Immunities">
        </div>
        <div class="row">
            <span>SENSES</span>
            <input type="text" name="attr_npc_senses" placeholder="darkvision 120ft., passive Perception 16">
        </div>
        <div class="row">
            <span>LANGUAGES</span>
            <input type="text" name="attr_npc_languages" placeholder="Abyssal, Common, Infernal" accept="Languages">
        </div>
        <div class="row">
            <span>CHALLENGE</span>
            <input class="num" type="text" name="attr_npc_challenge" placeholder="1" accept="Challenge Rating">
            <span>XP</span>
            <input type="text" name="attr_npc_xp" placeholder="250">
        </div>
        <div class="row">
            <span>LEGENDARY ACTIONS:</span>
            <input class="num" type="text" name="attr_npc_legendary_actions" placeholder="0">
        </div>
        <input type="hidden" name="attr_npc_sizebase" accept="Size">
        <input type="hidden" name="attr_npc_typebase" accept="Type">
        <input type="hidden" name="attr_npc_alignmentbase" accept="Alignment">
        <input type="hidden" name="attr_npc_acbase" accept="AC">
        <input type="hidden" name="attr_npc_hpbase" accept="HP">
        <input type="hidden" name="attr_npc_savingthrowsbase" accept="Saving Throws">
        <input type="hidden" name="attr_npc_sensesbase" accept="Senses">
        <input type="hidden" name="attr_npc_passiveperceptionbase" accept="Passive Perception">
        <input type="hidden" name="attr_npc_skillsbase" accept="Skills">
        <input type="hidden" name="attr_npc_content" accept="Content">
        <div class="row title">
            <span>GENERAL OPTIONS</span>
        </div>
        <div class="row">
        <input type="checkbox" name="attr_npc" value="1">
            <span>NPC</span>
        </div>
        <div class="row">
            <span>ROLL QUERIES:</span>
            <select name="attr_rtype">
                <option value="{{always=1}} {{r2=[[1d20">Always Roll Advantage</option>
                <option value="{{query=1}} ?{Advantage?|Normal Roll,&#123&#123normal=1&#125&#125 &#123&#123r2=[[0d20|Advantage,&#123&#123advantage=1&#125&#125 &#123&#123r2=[[1d20|Disadvantage,&#123&#123disadvantage=1&#125&#125 &#123&#123r2=[[1d20}">Query Advantage</option>
                <option value="{{normal=1}} {{r2=[[0d20">Never Roll Advantage</option>
            </select>
        </div>
        <div class="row">
            <span>WHISPER ROLLS TO GM:</span>
            <select name="attr_wtype">
                <option value="">Never Whisper Rolls</option>
                <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }">Query Whisper</option>
                <option value="/w gm ">Always Whisper Rolls</option>
            </select>
        </div>
        <div class="row">
            <span>AUTO DAMAGE ROLL:</span>
            <select class="dtype" name="attr_dtype">
                <option value="pick">Don't Auto Roll Damage</option>
                <option value="full">Auto Roll Damage & Crit</option>
            </select>
        </div>
    </div>
    <div class="display">
        <div class="row title red">
            <button type="roll" name="roll_npc_init" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Initiative}} {{mod=[[[[@{dexterity_mod}]][DEX]]]}} {{r1=[[1d20+[[@{dexterity_mod}]][DEX] &{tracker}]]}} {{normal=1}}">
                <input type="text" name="attr_npcd_name" style="text-align: left; margin-left: -4px;">
            </button>
        </div>
        <div class="row subtitle">
            <input class="italics" type="text" name="attr_npcd_type">
        </div>
        <div class="triangle"></div>
        <div class="row red">
            <span>Armor Class</span>
            <input class="num" type="text" name="attr_npcd_ac">
            <input class="parens" type="text" name="attr_npcd_actype">
        </div>
        <div class="row red">
            <span>Hit Points</span>
            <input class="num3" type="text" name="attr_npcd_hp">
            <button type="roll" name="roll_npc_hpformula" value="@{wtype}&{template:npc} {{normal=1}} {{name=@{npc_name}}} {{rname=Hit Points}} {{mod=@{npc_hpformula}}} {{r1=[[@{npc_hpformula}]]}}">
                <input class="parens" type="text" name="attr_npcd_hpformula" style="width: 200px; text-align: left;">
            </button>
        </div>
        <div class="row red">
            <span>Speed</span>
            <input type="text" name="attr_npcd_speed">
        </div>
        <div class="triangle"></div>
        <div class="row red">
            <div class="attr-container">
                <button type="roll" name="roll_npc_str" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Strength}} {{mod=[[[[@{strength_mod}]][STR]]]}} {{r1=[[1d20+[[@{strength_mod}]][STR]]]}} @{rtype}+[[@{strength_mod}]][STR]]]}}">
                    <span>STR</span>
                    <input type="text" name="attr_npcd_str">
                    <input type="text" name="attr_npcd_str_mod">
                </button>
            </div>
            <div class="attr-container">
                <button type="roll" name="roll_npc_dex" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Dexterity}} {{mod=[[[[@{dexterity_mod}]][DEX]]]}} {{r1=[[1d20+[[@{dexterity_mod}]][DEX]]]}} @{rtype}+[[@{dexterity_mod}]][DEX]]]}}">
                    <span>DEX</span>
                    <input type="text" name="attr_npcd_dex">
                    <input type="text" name="attr_npcd_dex_mod">
                </button>
            </div>
            <div class="attr-container">
                <button type="roll" name="roll_npc_con" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Constitution}} {{mod=[[[[@{constitution_mod}]][CON]]]}} {{r1=[[1d20+[[@{constitution_mod}]][CON]]]}} @{rtype}+[[@{constitution_mod}]][CON]]]}}">
                    <span>CON</span>
                    <input type="text" name="attr_npcd_con">
                    <input type="text" name="attr_npcd_con_mod">
                </button>
            </div>
            <div class="attr-container">
                <button type="roll" name="roll_npc_int" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Intelligence}} {{mod=[[[[@{intelligence_mod}]][INT]]]}} {{r1=[[1d20+[[@{intelligence_mod}]][INT]]]}} @{rtype}+[[@{intelligence_mod}]][INT]]]}}">
                    <span>INT</span>
                    <input type="text" name="attr_npcd_int">
                    <input type="text" name="attr_npcd_int_mod">
                </button>
            </div>
            <div class="attr-container">
                <button type="roll" name="roll_npc_wis" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Wisdom}} {{mod=[[[[@{wisdom_mod}]][WIS]]]}} {{r1=[[1d20+[[@{wisdom_mod}]][WIS]]]}} @{rtype}+[[@{wisdom_mod}]][WIS]]]}}">
                    <span>WIS</span>
                    <input type="text" name="attr_npcd_wis">
                    <input type="text" name="attr_npcd_wis_mod">
                </button>
            </div>
            <div class="attr-container">
                <button type="roll" name="roll_npc_cha" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Charisma}} {{mod=[[[[@{charisma_mod}]][CHA]]]}} {{r1=[[1d20+[[@{charisma_mod}]][CHA]]]}} @{rtype}+[[@{charisma_mod}]][CHA]]]}}">
                    <span>CHA</span>
                    <input type="text" name="attr_npcd_cha">
                    <input type="text" name="attr_npcd_cha_mod">
                </button>
            </div>
        </div>
        <div class="triangle"></div>
        <input class="flag" type="hidden" name="attr_npc_saving_flag" value="0">
        <div class="row saving red">
            <span>Saving Throws</span>
            <input class="flag" type="hidden" name="attr_npc_str_save_flag" value="0">
            <button type="roll" name="roll_npc_str_save" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Strength Save}} {{mod=[[[[@{npc_str_save}]][STR SAVE]]]}} {{r1=[[1d20+[[@{npc_str_save}]][STR SAVE]]]}} @{rtype}+[[@{npc_str_save}]][STR SAVE]]]}}">
                <span>Str +</span>
                <input type="text" name="attr_npcd_str_save">
            </button>
            <input class="flag" type="hidden" name="attr_npc_dex_save_flag" value="0">
            <button type="roll" name="roll_npc_dex_save" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Dexterity Save}} {{mod=[[[[@{npc_dex_save}]][DEX SAVE]]]}} {{r1=[[1d20+[[@{npc_dex_save}]][DEX SAVE]]]}} @{rtype}+[[@{npc_dex_save}]][DEX SAVE]]]}}">
                <span class="spacer">, </span>
                <span>Dex +</span>
                <input type="text" name="attr_npcd_dex_save">
            </button>
            <input class="flag" type="hidden" name="attr_npc_con_save_flag" value="0">
            <button type="roll" name="roll_npc_con_save" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Constitution Save}} {{mod=[[[[@{npc_con_save}]][CON SAVE]]]}} {{r1=[[1d20+[[@{npc_con_save}]][CON SAVE]]]}} @{rtype}+[[@{npc_con_save}]][CON SAVE]]]}}">
                <span class="spacer">, </span>
                <span>Con +</span>
                <input type="text" name="attr_npcd_con_save">
            </button>
            <input class="flag" type="hidden" name="attr_npc_int_save_flag" value="0">
            <button type="roll" name="roll_npc_int_save" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Intelligence Save}} {{mod=[[[[@{npc_int_save}]][INT SAVE]]]}} {{r1=[[1d20+[[@{npc_int_save}]][INT SAVE]]]}} @{rtype}+[[@{npc_int_save}]][INT SAVE]]]}}">
                <span class="spacer">, </span>
                <span>Int +</span>
                <input type="text" name="attr_npcd_int_save">
            </button>
            <input class="flag" type="hidden" name="attr_npc_wis_save_flag" value="0">
            <button type="roll" name="roll_npc_wis_save" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Wisdom Save}} {{mod=[[[[@{npc_wis_save}]][WIS SAVE]]]}} {{r1=[[1d20+[[@{npc_wis_save}]][WIS SAVE]]]}} @{rtype}+[[@{npc_wis_save}]][WIS SAVE]]]}}">
                <span class="spacer">, </span>
                <span>Wis +</span>
                <input type="text" name="attr_npcd_wis_save">
            </button>
            <input class="flag" type="hidden" name="attr_npc_cha_save_flag" value="0">
            <button type="roll" name="roll_npc_cha_save" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Charisma Save}} {{mod=[[[[@{npc_cha_save}]][CHA SAVE]]]}} {{r1=[[1d20+[[@{npc_cha_save}]][CHA SAVE]]]}} @{rtype}+[[@{npc_cha_save}]][CHA SAVE]]]}}">
                <span class="spacer">, </span>
                <span>Cha +</span>
                <input type="text" name="attr_npcd_cha_save">
            </button>
        </div>
        <input class="flag" type="hidden" name="attr_npc_skills_flag" value="0">
        <div class="row skills red">
            <span>Skills</span>
            <input class="flag" type="hidden" name="attr_npc_acrobatics_flag" value="0">
            <button type="roll" name="roll_npc_acrobatics" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Acrobatics}} {{mod=@{npc_acrobatics}}} {{r1=[[1d20+@{npc_acrobatics}]]}} @{rtype}+@{npc_acrobatics}]]}}">
                <span class="spacer">, </span>
                <span>Acrobatics +</span>
                <input type="text" name="attr_npcd_acrobatics">
            </button>
            <input class="flag" type="hidden" name="attr_npc_animal_handling_flag" value="0">
            <button type="roll" name="roll_npc_animal_handling" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Animal Handling}} {{mod=@{npc_animal_handling}}} {{r1=[[1d20+@{npc_animal_handling}]]}} @{rtype}+@{npc_animal_handling}]]}}">
                <span class="spacer">, </span>
                <span>Animal Handling +</span>
                <input type="text" name="attr_npcd_animal_handling">
            </button>
            <input class="flag" type="hidden" name="attr_npc_arcana_flag" value="0">
            <button type="roll" name="roll_npc_arcana" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Arcana}} {{mod=@{npc_arcana}}} {{r1=[[1d20+@{npc_arcana}]]}} @{rtype}+@{npc_arcana}]]}}">
                <span class="spacer">, </span>
                <span>Arcana +</span>
                <input type="text" name="attr_npcd_arcana">
            </button>
            <input class="flag" type="hidden" name="attr_npc_athletics_flag" value="0">
            <button type="roll" name="roll_npc_athletics" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Athletics}} {{mod=@{npc_athletics}}} {{r1=[[1d20+@{npc_athletics}]]}} @{rtype}+@{npc_athletics}]]}}">
                <span class="spacer">, </span>
                <span>Athletics +</span>
                <input type="text" name="attr_npcd_athletics">
            </button>
            <input class="flag" type="hidden" name="attr_npc_deception_flag" value="0">
            <button type="roll" name="roll_npc_deception" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Deception}} {{mod=@{npc_deception}}} {{r1=[[1d20+@{npc_deception}]]}} @{rtype}+@{npc_deception}]]}}">
                <span class="spacer">, </span>
                <span>Deception +</span>
                <input type="text" name="attr_npcd_deception">
            </button>
            <input class="flag" type="hidden" name="attr_npc_history_flag" value="0">
            <button type="roll" name="roll_npc_history" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=History}} {{mod=@{npc_history}}} {{r1=[[1d20+@{npc_history}]]}} @{rtype}+@{npc_history}]]}}">
                <span class="spacer">, </span>
                <span>History +</span>
                <input type="text" name="attr_npcd_history">
            </button>
            <input class="flag" type="hidden" name="attr_npc_insight_flag" value="0">
            <button type="roll" name="roll_npc_insight" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Insight}} {{mod=@{npc_insight}}} {{r1=[[1d20+@{npc_insight}]]}} @{rtype}+@{npc_insight}]]}}">
                <span class="spacer">, </span>
                <span>Insight +</span>
                <input type="text" name="attr_npcd_insight">
            </button>
            <input class="flag" type="hidden" name="attr_npc_intimidation_flag" value="0">
            <button type="roll" name="roll_npc_intimidation" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Intimidation}} {{mod=@{npc_intimidation}}} {{r1=[[1d20+@{npc_intimidation}]]}} @{rtype}+@{npc_intimidation}]]}}">
                <span class="spacer">, </span>
                <span>Intimidation +</span>
                <input type="text" name="attr_npcd_intimidation">
            </button>
            <input class="flag" type="hidden" name="attr_npc_investigation_flag" value="0">
            <button type="roll" name="roll_npc_investigation" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Investigation}} {{mod=@{npc_investigation}}} {{r1=[[1d20+@{npc_investigation}]]}} @{rtype}+@{npc_investigation}]]}}">
                <span class="spacer">, </span>
                <span>Investigation +</span>
                <input type="text" name="attr_npcd_investigation">
            </button>
            <input class="flag" type="hidden" name="attr_npc_medicine_flag" value="0">
            <button type="roll" name="roll_npc_medicine" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Medicine}} {{mod=@{npc_medicine}}} {{r1=[[1d20+@{npc_medicine}]]}} @{rtype}+@{npc_medicine}]]}}">
                <span class="spacer">, </span>
                <span>Medicine +</span>
                <input type="text" name="attr_npcd_medicine">
            </button>
            <input class="flag" type="hidden" name="attr_npc_nature_flag" value="0">
            <button type="roll" name="roll_npc_nature" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Nature}} {{mod=@{npc_nature}}} {{r1=[[1d20+@{npc_nature}]]}} @{rtype}+@{npc_nature}]]}}">
                <span class="spacer">, </span>
                <span>Nature +</span>
                <input type="text" name="attr_npcd_nature">
            </button>
            <input class="flag" type="hidden" name="attr_npc_perception_flag" value="0">
            <button type="roll" name="roll_npc_perception" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Perception}} {{mod=@{npc_perception}}} {{r1=[[1d20+@{npc_perception}]]}} @{rtype}+@{npc_perception}]]}}">
                <span class="spacer">, </span>
                <span>Perception +</span>
                <input type="text" name="attr_npcd_perception">
            </button>
            <input class="flag" type="hidden" name="attr_npc_performance_flag" value="0">
            <button type="roll" name="roll_npc_performance" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Performance}} {{mod=@{npc_performance}}} {{r1=[[1d20+@{npc_performance}]]}} @{rtype}+@{npc_performance}]]}}">
                <span class="spacer">, </span>
                <span>Performance +</span>
                <input type="text" name="attr_npcd_performance">
            </button>
            <input class="flag" type="hidden" name="attr_npc_persuasion_flag" value="0">
            <button type="roll" name="roll_npc_persuasion" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Persuasion}} {{mod=@{npc_persuasion}}} {{r1=[[1d20+@{npc_persuasion}]]}} @{rtype}+@{npc_persuasion}]]}}">
                <span class="spacer">, </span>
                <span>Persuasion +</span>
                <input type="text" name="attr_npcd_persuasion">
            </button>
            <input class="flag" type="hidden" name="attr_npc_religion_flag" value="0">
            <button type="roll" name="roll_npc_religion" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Religion}} {{mod=@{npc_religion}}} {{r1=[[1d20+@{npc_religion}]]}} @{rtype}+@{npc_religion}]]}}">
                <span class="spacer">, </span>
                <span>Religion +</span>
                <input type="text" name="attr_npcd_religion">
            </button>
            <input class="flag" type="hidden" name="attr_npc_sleight_of_hand_flag" value="0">
            <button type="roll" name="roll_npc_sleight_of_hand" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Sleight of Hand}} {{mod=@{npc_sleight_of_hand}}} {{r1=[[1d20+@{npc_sleight_of_hand}]]}} @{rtype}+@{npc_sleight_of_hand}]]}}">
                <span class="spacer">, </span>
                <span>Sleight of Hand +</span>
                <input type="text" name="attr_npcd_sleight_of_hand">
            </button>
            <input class="flag" type="hidden" name="attr_npc_stealth_flag" value="0">
            <button type="roll" name="roll_npc_stealth" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Stealth}} {{mod=@{npc_stealth}}} {{r1=[[1d20+@{npc_stealth}]]}} @{rtype}+@{npc_stealth}]]}}">
                <span class="spacer">, </span>
                <span>Stealth +</span>
                <input type="text" name="attr_npcd_stealth">
            </button>
            <input class="flag" type="hidden" name="attr_npc_survival_flag" value="0">
            <button type="roll" name="roll_npc_survival" value="@{wtype}&{template:npc} {{name=@{npc_name}}} {{rname=Survival}} {{mod=@{npc_survival}}} {{r1=[[1d20+@{npc_survival}]]}} @{rtype}+@{npc_survival}]]}}">
                <span class="spacer">, </span>
                <span>Survival +</span>
                <input type="text" name="attr_npcd_survival">
            </button>
        </div>
        <input class="flag" type="hidden" name="attr_npc_vulnerabilities_flag" value="0">
        <div class="row vulnerabilities red">
            <span>Damage Vulnerabilities</span>
            <input type="text" name="attr_npcd_vulnerabilities" style="width: 200px;">
        </div>
        <input class="flag" type="hidden" name="attr_npc_resistances_flag" value="0">
        <div class="row resistances red">
            <span>Damage Resistances</span>
            <input type="text" name="attr_npcd_resistances">
        </div>
        <input class="flag" type="hidden" name="attr_npc_immunities_flag" value="0">
        <div class="row immunities red">
            <span>Damage Immunities</span>
            <input type="text" name="attr_npcd_immunities">
        </div>
        <input class="flag" type="hidden" name="attr_npc_condition_immunities_flag" value="0">
        <div class="row condition_immunities red">
            <span>Condition Immunities</span>
            <input type="text" name="attr_npcd_condition_immunities">
        </div>
        <div class="row red">
            <span>Senses</span>
            <input type="text" name="attr_npcd_senses" style="width: 300px;">
        </div>
        <div class="row red">
            <span>Languages</span>
            <input type="text" name="attr_npcd_languages" style="width: 270px;">
        </div>
        <div class="row red">
            <span>Challenge</span>
            <input class="num" type="text" name="attr_npcd_challenge">
            <input type="text" name="attr_npcd_xp">
        </div>
        <div class="triangle"></div>
        <div class="row traits">
            <fieldset class="repeating_npctrait">
                <div class="trait">
    				<input type="text" name="attr_name" placeholder="False Appearance.">
                	<textarea name="attr_desc" placeholder="If the dragon fails..."></textarea>
				</div>	
            </fieldset>
        </div>
    </div>
    <div class="actions_container"></div>
        <input class="dflag" type="hidden" name="attr_dflag" value="pick">
        <div class="row actions">
            <div class="row actiontitle">
                <span class="title red">Actions</span>
            </div>
            <fieldset class="repeating_npcaction">
                <div class="action">
                    <input class="npc_options-flag" type="checkbox" name="attr_npc_options-flag" checked="checked"><span>y</span>
                    <div class="npc_options">
                        <div class="row">
                            <span>NAME:</span>
                            <input type="text" name="attr_name">
                        </div>
						<div class="row">
							<input type="checkbox" name="attr_attack_flag">
                            <span>ATTACK</span>
                        </div>
                        <input type="hidden" class="attack_options" name="attr_attack_options" value="0">
                        <div class="row attack_option">
                            <span>TYPE:</span>
                        	<select name="attr_attack_type">
                        		<option value="Melee">Melee</option>
                        		<option value="Ranged">Ranged</option>
                        	</select>
                            <span style="margin-left: 15px;">RANGE/REACH:</span>
                            <input type="text" name="attr_attack_range" placeholder="5 ft." style="width: 100px;">
                        </div>
                        <div class="row attack_option">
                            <span>TO HIT:</span>
                            <input type="text" name="attr_attack_tohit" placeholder="5" style="width: 30px;">
                        	<span style="margin-left: 15px;">TARGET:</span>
                        	<input type="text" name="attr_attack_target" placeholder="One target" style="width: 100px;">
                        </div>
                        <input type="hidden" name="attr_damage_flag">
                        <div class="row attack_option">
                        	<span>ON HIT:</span>
                        	<input type="text" name="attr_attack_damage" placeholder="1d10" style="width: 65px;">
                        	<input type="text" name="attr_attack_damagetype" placeholder="slashing" style="width: 100px;">
                            <input type="hidden" name="attr_attack_crit">
                        </div>
                        <div class="row attack_option">
                            <span>ON HIT 2:</span>
                        	<input type="text" name="attr_attack_damage2" placeholder="2d6+5" style="width: 65px;">
                        	<input type="text" name="attr_attack_damagetype2" placeholder="fire" style="width: 100px;">
                            <input type="hidden" name="attr_attack_crit2">
                        </div>
                        <div class="row">
                        	<textarea name="attr_description"></textarea>
                        </div>
                	</div>
                	<div class="display">
                        <button class="pick" type="roll" name="roll_npc_atk" value="@{wtype}&{template:npcatk} @{attack_display_flag} @{damage_flag} {{name=@{npc_name}}} {{rname=[@{name}](~repeating_npcaction_npc_dmg)}} {{rnamec=[@{name}](~repeating_npcaction_npc_crit)}} {{r1=[[1d20+(@{attack_tohit}+0)]]}} @{rtype}+(@{attack_tohit}+0)]]}} {{description=@{description}}}">
                            <div class="row wide">
                                <input class="bold wide" type="text" name="attr_name_display">
                            </div>
                            <input class="attack_options" type="hidden" name="attr_attack_display_flag"  value="0">
                            <div class="row attack attack_option">
                                <input class="italics" type="text" name="attr_attack_type_display" style="width: 140px; text-align: left;"><input type="text" name="attr_attack_tohitrange" style="width: 220px; text-align: left;">
                            </div>
                            <div class="row attack attack_option">
                                <span class="italics" style="font-size: 13px; font-weight: normal; vertical-align: middle;">Hit: </span><input type="text" name="attr_attack_onhit" style="width: 340px; text-align: left;">
                            </div>
                            <input class="description_flag" type="hidden" name="attr_description_flag" value="0">
                            <textarea name="attr_description"></textarea>
                        </button>
                        <button class="dmg" type="roll" name="roll_npc_dmg" value="@{wtype}&{template:npcdmg} @{damage_flag} {{dmg1=[[@{attack_damage}+0]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}+0]]}} {{dmg2type=@{attack_damagetype2}}} {{crit1=[[@{attack_crit}+0]]}} {{crit2=[[@{attack_crit2}+0]]}}"></button>
                        <button class="crit" type="roll" name="roll_npc_crit" value="@{wtype}&{template:npcdmg} @{damage_flag} {{crit=1}} {{dmg1=[[@{attack_damage}+0]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}+0]]}} {{dmg2type=@{attack_damagetype2}}} {{crit1=[[@{attack_crit}+0]]}} {{crit2=[[@{attack_crit2}+0]]}}"></button>
                        <button class="full" type="roll" name="roll_npc_action" value="@{wtype}&{template:npcaction} @{attack_display_flag} @{damage_flag} {{name=@{npc_name}}} {{rname=@{name}}} {{r1=[[1d20+(@{attack_tohit}+0)]]}} @{rtype}+(@{attack_tohit}+0)]]}} {{dmg1=[[@{attack_damage}+0]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}+0]]}} {{dmg2type=@{attack_damagetype2}}} {{crit1=[[@{attack_crit}+0]]}} {{crit2=[[@{attack_crit2}+0]]}} {{description=@{description}}}">
                    		<div class="row wide">
                                <input class="bold wide" type="text" name="attr_name_display">
                    		</div>
                    		<input class="attack_options" type="hidden" name="attr_attack_display_flag"  value="0">
                    		<div class="row attack attack_option">
                	    		<input class="italics" type="text" name="attr_attack_type_display" style="width: 140px; text-align: left;"><input type="text" name="attr_attack_tohitrange" style="width: 220px; text-align: left;">
                		    </div>
                    		<div class="row attack attack_option">
                    			<span class="italics" style="font-size: 13px; font-weight: normal; vertical-align: middle;">Hit: </span><input type="text" name="attr_attack_onhit" style="width: 340px; text-align: left;">
                    		</div>
                    		<input class="description_flag" type="hidden" name="attr_description_flag" value="0">
                    		<textarea name="attr_description"></textarea>
                        </button>
                	</div>
                </div>
            </fieldset>
        </div>
        <input class="legendary_flag" type="hidden" name="attr_legendary_flag">
        <input class="dflag" type="hidden" name="attr_dflag" value="pick">
        <div class="row actions legendary">
            <div class="row actiontitle">
                <span class="title red">Legendary Actions</span>
            </div>
            <div class="row">
                <textarea class="legendaryactions" name="attr_legendary_actions_display"></textarea>
            </div>
            <fieldset class="repeating_npcaction-l">
                <div class="action">
                    <input class="npc_options-flag" type="checkbox" name="attr_npc_options-flag" checked="checked"><span>y</span>
                    <div class="npc_options">
                        <div class="row">
                            <span>NAME:</span>
                            <input type="text" name="attr_name">
                        </div>
    					<div class="row">
							<input type="checkbox" name="attr_attack_flag">
                            <span>ATTACK</span>
                        </div>
                        <input type="hidden" class="attack_options" name="attr_attack_options" value="0">
                        <div class="row attack_option">
                            <span>TYPE:</span>
                        	<select name="attr_attack_type">
                        		<option value="Melee">Melee</option>
                        		<option value="Ranged">Ranged</option>
                        	</select>
                            <span style="margin-left: 15px;">RANGE/REACH:</span>
                            <input type="text" name="attr_attack_range" placeholder="5 ft." style="width: 100px;">
                        </div>
                        <div class="row attack_option">
                            <span>TO HIT:</span>
                            <input type="text" name="attr_attack_tohit" placeholder="5" style="width: 30px;">
                        	<span style="margin-left: 15px;">TARGET:</span>
                        	<input type="text" name="attr_attack_target" placeholder="One target" style="width: 100px;">
                        </div>
                        <input type="hidden" name="attr_damage_flag">
                        <div class="row attack_option">
                        	<span>ON HIT:</span>
                        	<input type="text" name="attr_attack_damage" placeholder="1d10" style="width: 65px;">
                        	<input type="text" name="attr_attack_damagetype" placeholder="slashing" style="width: 100px;">
                            <input type="hidden" name="attr_attack_crit">
                        </div>
                        <div class="row attack_option">
                            <span>ON HIT 2:</span>
                        	<input type="text" name="attr_attack_damage2" placeholder="2d6+5" style="width: 65px;">
                        	<input type="text" name="attr_attack_damagetype2" placeholder="fire" style="width: 100px;">
                            <input type="hidden" name="attr_attack_crit2">
                        </div>
                        <div class="row">
                        	<textarea name="attr_description"></textarea>
                        </div>
                	</div>
                	<div class="display">
                        <button class="pick" type="roll" name="roll_npc_atk" value="@{wtype}&{template:npcatk} @{attack_display_flag} @{damage_flag} {{name=@{npc_name}}} {{rname=[@{name}](~repeating_npcaction-l_npc_dmg)}} {{rnamec=[@{name}](~repeating_npcaction-l_npc_crit)}} {{r1=[[1d20+(@{attack_tohit}+0)]]}} @{rtype}+(@{attack_tohit}+0)]]}} {{description=@{description}}}">
                            <div class="row wide">
                                <input class="bold wide" type="text" name="attr_name_display">
                            </div>
                            <input class="attack_options" type="hidden" name="attr_attack_display_flag"  value="0">
                            <div class="row attack attack_option">
                                <input class="italics" type="text" name="attr_attack_type_display" style="width: 140px; text-align: left;"><input type="text" name="attr_attack_tohitrange" style="width: 220px; text-align: left;">
                            </div>
                            <div class="row attack attack_option">
                                <span class="italics" style="font-size: 13px; font-weight: normal; vertical-align: middle;">Hit: </span><input type="text" name="attr_attack_onhit" style="width: 340px; text-align: left;">
                            </div>
                            <input class="description_flag" type="hidden" name="attr_description_flag" value="0">
                            <textarea name="attr_description"></textarea>
                        </button>
                        <button class="dmg" type="roll" name="roll_npc_dmg" value="@{wtype}&{template:npcdmg} @{damage_flag} {{dmg1=[[@{attack_damage}+0]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}+0]]}} {{dmg2type=@{attack_damagetype2}}} {{crit1=[[@{attack_crit}+0]]}} {{crit2=[[@{attack_crit2}+0]]}}"></button>
                        <button class="crit" type="roll" name="roll_npc_crit" value="@{wtype}&{template:npcdmg} @{damage_flag} {{crit=1}} {{dmg1=[[@{attack_damage}+0]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}+0]]}} {{dmg2type=@{attack_damagetype2}}} {{crit1=[[@{attack_crit}+0]]}} {{crit2=[[@{attack_crit2}+0]]}}"></button>
                        <button class="full" type="roll" name="roll_npc_action" value="@{wtype}&{template:npcaction} @{attack_display_flag} @{damage_flag} {{name=@{npc_name}}} {{rname=@{name}}} {{r1=[[1d20+(@{attack_tohit}+0)]]}} @{rtype}+(@{attack_tohit}+0)]]}} {{dmg1=[[@{attack_damage}+0]]}} {{dmg1type=@{attack_damagetype}}} {{dmg2=[[@{attack_damage2}+0]]}} {{dmg2type=@{attack_damagetype2}}} {{crit1=[[@{attack_crit}+0]]}} {{crit2=[[@{attack_crit2}+0]]}} {{description=@{description}}}">
                    		<div class="row wide">
                                <input class="bold wide" type="text" name="attr_name_display">
                    		</div>
                    		<input class="attack_options" type="hidden" name="attr_attack_display_flag"  value="0">
                    		<div class="row attack attack_option">
                	    		<input class="italics" type="text" name="attr_attack_type_display" style="width: 140px; text-align: left;"><input type="text" name="attr_attack_tohitrange" style="width: 220px; text-align: left;">
                		    </div>
                    		<div class="row attack attack_option">
                    			<span class="italics" style="font-size: 13px; font-weight: normal; vertical-align: middle;">Hit: </span><input type="text" name="attr_attack_onhit" style="width: 340px; text-align: left;">
                    		</div>
                    		<input class="description_flag" type="hidden" name="attr_description_flag" value="0">
                    		<textarea name="attr_description"></textarea>
                        </button>
                	</div>
                </div>
            </fieldset>
        </div>
    </div>
</div>

<div class="container pc">

<input class="tab-button core" type="radio" name="attr_tab" value="core" style="right: 116px; width: 45px;" checked="checked"><span style="right: 116px; width: 45px;">CORE</span>
<input class="tab-button bio" type="radio" name="attr_tab" value="bio" style="right: 83px; width: 30px;"><span style="right: 83px; width: 30px;">BIO</span>
<input class="tab-button spells" type="radio" name="attr_tab" value="spells" style="right: 20px; width: 60px;"><span  style="right: 20px; width: 60px;">SPELLS</span>
<input class="tab-button options" type="radio" name="attr_tab" value="options"><span style="font-family: pictos">y</span>

<div class="page core">
    <div class="header">
        <div class="name-container">
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/5th%20Edition%20OGL%20by%20Roll20/srd5_360.png" style="padding-bottom: 5px;">
            <input type="text" name="attr_character_name" style="width: 100%;">
            <span class="label">CHARACTER NAME</span>
        </div>
        <div class="header-info">
            <div class="top">
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_customclass_flag" value="0">
                    <input class="showing" type="text" name="attr_cust_class" value="@{cust_classname}" disabled="true" style="width: 64px; height: 28px; padding-top: 10px;">
                    <select class="hiding" name="attr_class" style="width: 64px;">
                        <option value="Barbarian">Barbarian</option>
                        <option value="Bard">Bard</option>
                        <option value="Cleric">Cleric</option>
                        <option value="Druid">Druid</option>
                        <option value="Fighter">Fighter</option>
                        <option value="Monk">Monk</option>
                        <option value="Paladin">Paladin</option>
                        <option value="Ranger">Ranger</option>
                        <option value="Rogue">Rogue</option>
                        <option value="Sorcerer">Sorcerer</option>
                        <option value="Warlock">Warlock</option>
                        <option value="Wizard">Wizard</option>
                    </select>
                    <input type="number" name="attr_base_level" value="1" style="margin-left: -6px; width: 28px;">
                    <span class="label">CLASS & LEVEL</span>
                </div>
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_mutliclass1_showingflag" value="0">
                    <input class="hiding" type="text" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="hiding" type="text" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass1_name" value="@{multiclass1}" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass1_level" value="@{multiclass1_lvl}" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                </div>
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_mutliclass2_showingflag" value="0">
                    <input class="hiding" type="text" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="hiding" type="text" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass2_name" value="@{multiclass2}" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass2_level" value="@{multiclass2_lvl}" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                </div>
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_mutliclass3_showingflag" value="0">
                    <input class="hiding" type="text" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="hiding" type="text" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass3_name" value="@{multiclass3}" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass3_level" value="@{multiclass3_lvl}" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_background" style="width: 122px;">
                    <span class="label">BACKGROUND</span>
                </div>
            </div>
            <div class="bottom">
                <div class="hlabel-container">
                    <input type="text" name="attr_race" style="width: 200px;">
                    <span class="label">RACE</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_alignment" style="width: 180px;">
                    <span class="label">ALIGNMENT</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_experience" style="width: 100px;">
                    <span class="label">EXPERIENCE POINTS</span>
                </div>
            </div>
        </div>
    </div>
    <div class="body">
        <div class="col col1">
            <div class="attributes-container" style="margin-top: 10px;">
                <div class="attr-container">
                    <button type="roll" name="roll_strength" value="@{wtype}&{template:simple} {{rname=STRENGTH}} {{mod=[[[[@{strength_mod}]][STR]]]}} {{r1=[[1d20@{halflingluck}+[[@{strength_mod}]][STR]]]}} @{rtype}@{halflingluck}+[[@{strength_mod}]][STR]]]}}">STRENGTH</button>
                    <input class="attr" type="text" name="attr_strength_mod" title="@{strength_mod}" value="(floor((@{strength}-10)/2))" disabled="true">
                    <div class="attr-mod">
                        <input type="text" name="attr_strength" title="@{strength}" value="10">
                    </div>
                </div>
                <div class="attr-container">
                    <button type="roll" name="roll_dexterity" value="@{wtype}&{template:simple} {{rname=DEXTERITY}} {{mod=[[[[@{dexterity_mod}]][DEX]]]}} {{r1=[[1d20@{halflingluck}+[[@{dexterity_mod}]][DEX]]]}} @{rtype}@{halflingluck}+[[@{dexterity_mod}]][DEX]]]}}">DEXTERITY</button>
                    <input class="attr" type="text" name="attr_dexterity_mod" title="@{dexterity_mod}" value="(floor((@{dexterity}-10)/2))" disabled="true">
                    <div class="attr-mod">
                        <input type="text" name="attr_dexterity" title="@{dexterity}" value="10">
                    </div>
                </div>
                <div class="attr-container">
                    <button type="roll" name="roll_constitution" value="@{wtype}&{template:simple} {{rname=CONSTITUTION}} {{mod=[[[[@{constitution_mod}]][CON]]]}} {{r1=[[1d20@{halflingluck}+[[@{constitution_mod}]][CON]]]}} @{rtype}@{halflingluck}+[[@{constitution_mod}]][CON]]]}}">CONSTITUTION</button>
                    <input class="attr" type="text" name="attr_constitution_mod" title="@{constitution_mod}" value="(floor((@{constitution}-10)/2))" disabled="true">
                    <div class="attr-mod">
                        <input type="text" name="attr_constitution" title="@{constitution}" value="10">
                    </div>
                </div>
                <div class="attr-container">
                    <button type="roll" name="roll_intelligence" value="@{wtype}&{template:simple} {{rname=INTELLIGENCE}} {{mod=[[[[@{intelligence_mod}]][INT]]]}} {{r1=[[1d20@{halflingluck}+[[@{intelligence_mod}]][INT]]]}} @{rtype}@{halflingluck}+[[@{intelligence_mod}]][INT]]]}}">INTELLIGENCE</button>
                    <input class="attr" type="text" name="attr_intelligence_mod" title="@{intelligence_mod}" value="(floor((@{intelligence}-10)/2))" disabled="true">
                    <div class="attr-mod">
                        <input type="text" name="attr_intelligence" title="@{intelligence}" value="10">
                    </div>
                </div>
                <div class="attr-container">
                    <button type="roll" name="roll_wisdom" value="@{wtype}&{template:simple} {{rname=WISDOM}} {{mod=[[[[@{wisdom_mod}]][WIS]]]}} {{r1=[[1d20@{halflingluck}+[[@{wisdom_mod}]][WIS]]]}} @{rtype}@{halflingluck}+[[@{wisdom_mod}]][WIS]]]}}">WISDOM</button>
                    <input class="attr" type="text" name="attr_wisdom_mod" title="@{wisdom_mod}" value="(floor((@{wisdom}-10)/2))" disabled="true">
                    <div class="attr-mod">
                        <input type="text" name="attr_wisdom" title="@{wisdom}" value="10">
                    </div>
                </div>
                <div class="attr-container">
                    <button type="roll" name="roll_charisma" value="@{wtype}&{template:simple} {{rname=CHARISMA}} {{mod=[[[[@{charisma_mod}]][CHA]]]}} {{r1=[[1d20@{halflingluck}+[[@{charisma_mod}]][CHA]]]}} @{rtype}@{halflingluck}+[[@{charisma_mod}]][CHA]]]}}">CHARISMA</button>
                    <input class="attr" type="text" name="attr_charisma_mod" title="@{charisma_mod}" value="(floor((@{charisma}-10)/2))" disabled="true">
                    <div class="attr-mod">
                        <input type="text" name="attr_charisma" title="@{charisma}" value="10">
                    </div>
                </div>
            </div>
            <div class="skills-saves-container">
                <div class="insp-prof-container">
                    <div class="value">
                        <input type="checkbox" name="attr_inspiration"><span></span>
                    </div>
                    <div class="label">
                        <span>INSPIRATION</span>
                    </div>
                </div>
                <div class="insp-prof-container">
                    <div class="value">
                        <input type="text" name="attr_pb" title="@{pb}" value="(ceil((@{level})/1e10) + ceil((@{level})/4))" disabled="true" ><span></span>
                    </div>
                    <div class="label">
                        <span>PROFICIENCY BONUS</span>
                    </div>
                </div>
                <div class="saving-throw-container">
                    <div class="saving-throw">
                        <input type="checkbox" name="attr_strength_save_prof" title="@{strength_save_prof}" value="(@{pb})">
                        <input type="text" name="attr_strength_save_bonus" title="@{strength_save_bonus}" value="(@{strength_mod}+@{strength_save_prof})" disabled="true">
                        <button type="roll" name="roll_strength_save" value="@{wtype}&{template:simple} {{rname=STRENGTH SAVE}} {{mod=[[[[@{strength_save_bonus}]][STR+PROF]@{globalsavingthrowbonus}]]}} {{r1=[[1d20@{halflingluck}+[[@{strength_save_bonus}]][STR+PROF]@{globalsavingthrowbonus}]]}} @{rtype}@{halflingluck}+[[@{strength_save_bonus}]][STR+PROF]@{globalsavingthrowbonus}]]}}">Strength</button>
                    </div>
                    <div class="saving-throw">
                        <input type="checkbox" name="attr_dexterity_save_prof" title="@{dexterity_save_prof}" value="(@{pb})">
                        <input type="text" name="attr_dexterity_save_bonus" title="@{dexterity_save_bonus}" value="(@{dexterity_mod}+@{dexterity_save_prof})" disabled="true">
                        <button type="roll" name="roll_dexterity_save" value="@{wtype}&{template:simple} {{rname=DEXTERITY SAVE}} {{mod=[[[[@{dexterity_save_bonus}]][DEX+PROF]@{globalsavingthrowbonus}]]}} {{r1=[[1d20@{halflingluck}+[[@{dexterity_save_bonus}]][DEX+PROF]@{globalsavingthrowbonus}]]}} @{rtype}@{halflingluck}+[[@{dexterity_save_bonus}]][DEX+PROF]@{globalsavingthrowbonus}]]}}">Dexterity</button>
                    </div>
                    <div class="saving-throw">
                        <input type="checkbox" name="attr_constitution_save_prof" title="@{constitution_save_prof}" value="(@{pb})">
                        <input type="text" name="attr_constitution_save_bonus" title="@{constitution_save_bonus}" value="(@{constitution_mod}+@{constitution_save_prof})" disabled="true">
                        <button type="roll" name="roll_constitution_save" value="@{wtype}&{template:simple} {{rname=CONSTITUTION SAVE}} {{mod=[[[[@{constitution_save_bonus}]][CON+PROF]@{globalsavingthrowbonus}]]}} {{r1=[[1d20@{halflingluck}+[[@{constitution_save_bonus}]][CON+PROF]@{globalsavingthrowbonus}]]}} @{rtype}@{halflingluck}+[[@{constitution_save_bonus}]][CON+PROF]@{globalsavingthrowbonus}]]}}">Constitution</button>
                    </div>
                    <div class="saving-throw">
                        <input type="checkbox" name="attr_intelligence_save_prof" title="@{intelligence_save_prof}" value="(@{pb})">
                        <input type="text" name="attr_intelligence_save_bonus" title="@{intelligence_save_bonus}" value="(@{intelligence_mod}+@{intelligence_save_prof})" disabled="true">
                        <button type="roll" name="roll_intelligence_save" value="@{wtype}&{template:simple} {{rname=INTELLIGENCE SAVE}} {{mod=[[[[@{intelligence_save_bonus}]][INT+PROF]@{globalsavingthrowbonus}]]}} {{r1=[[1d20@{halflingluck}+[[@{intelligence_save_bonus}]][INT+PROF]@{globalsavingthrowbonus}]]}} @{rtype}@{halflingluck}+[[@{intelligence_save_bonus}]][INT+PROF]@{globalsavingthrowbonus}]]}}">Intelligence</button>
                    </div>
                    <div class="saving-throw">
                        <input type="checkbox" name="attr_wisdom_save_prof" title="@{wisdom_save_prof}" value="(@{pb})">
                        <input type="text" name="attr_wisdom_save_bonus" title="@{wisdom_save_bonus}" value="(@{wisdom_mod}+@{wisdom_save_prof})" disabled="true">
                        <button type="roll" name="roll_wisdom_save" value="@{wtype}&{template:simple} {{rname=WISDOM SAVE}} {{mod=[[[[@{wisdom_save_bonus}]][WIS+PROF]@{globalsavingthrowbonus}]]}} {{r1=[[1d20@{halflingluck}+[[@{wisdom_save_bonus}]][WIS+PROF]@{globalsavingthrowbonus}]]}} @{rtype}@{halflingluck}+[[@{wisdom_save_bonus}]][WIS+PROF]@{globalsavingthrowbonus}]]}}">Wisdom</button>
                    </div>
                    <div class="saving-throw">
                        <input type="checkbox" name="attr_charisma_save_prof" title="@{charisma_save_prof}" value="(@{pb})">
                        <input type="text" name="attr_charisma_save_bonus" title="@{charisma_save_bonus}" value="(@{charisma_mod}+@{charisma_save_prof})" disabled="true">
                        <button type="roll" name="roll_charisma_save" value="@{wtype}&{template:simple} {{rname=CHARISMA SAVE}} {{mod=[[[[@{charisma_save_bonus}]][CHA+PROF]@{globalsavingthrowbonus}]]}} {{r1=[[1d20@{halflingluck}+[[@{charisma_save_bonus}]][CHA+PROF]@{globalsavingthrowbonus}]]}} @{rtype}@{halflingluck}+[[@{charisma_save_bonus}]][CHA+PROF]@{globalsavingthrowbonus}]]}}">Charisma</button>
                    </div>
                    <div class="label">
                        <span>SAVING THROWS</span>
                    </div>
                </div>
                <div class="skills-container">
                    <div class="skill">
                        <input type="checkbox" name="attr_acrobatics_prof" title="@{acrobatics_prof}" value="(@{pb}*@{acrobatics_type})">
                        <input type="text" name="attr_acrobatics_bonus" title="@{acrobatics_bonus}" value="(@{dexterity_mod}+@{acrobatics_proficiency})" disabled="true">
                        <button type="roll" name="roll_acrobatics" value="@{wtype}&{template:simple} {{rname=ACROBATICS}} {{mod=[[[[@{acrobatics_bonus}]][ACR]]]}} {{r1=[[1d20@{halflingluck}+[[@{acrobatics_bonus}]][ACR]]]}} @{rtype}@{halflingluck}+[[@{acrobatics_bonus}]][ACR]]]}}">Acrobatics <span>(Dex)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_animal_handling_prof" title="@{animal_handling_prof}" value="(@{pb}*@{animal_handling_type})">
                        <input type="text" name="attr_animal_handling_bonus" title="@{animal_handling_bonus}" value="(@{wisdom_mod}+@{animal_handling_proficiency})" disabled="true">
                        <button type="roll" name="roll_animal_handling" value="@{wtype}&{template:simple} {{rname=ANIMAL HANDLING}} {{mod=[[[[@{animal_handling_bonus}]][ANI]]]}} {{r1=[[1d20@{halflingluck}+[[@{animal_handling_bonus}]][ANI]]]}} @{rtype}@{halflingluck}+[[@{animal_handling_bonus}]][ANI]]]}}">Animal Handling <span>(Wis)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_arcana_prof" title="@{arcana_prof}" value="(@{pb}*@{arcana_type})">
                        <input type="text" name="attr_arcana_bonus" title="@{arcana_bonus}" value="(@{intelligence_mod}+@{arcana_proficiency})" disabled="true">
                        <button type="roll" name="roll_arcana" value="@{wtype}&{template:simple} {{rname=ARCANA}} {{mod=[[[[@{arcana_bonus}]][ARC]]]}} {{r1=[[1d20@{halflingluck}+[[@{arcana_bonus}]][ARC]]]}} @{rtype}@{halflingluck}+[[@{arcana_bonus}]][ARC]]]}}">Arcana <span>(Int)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_athletics_prof" title="@{athletics_prof}" value="(@{pb}*@{athletics_type})">
                        <input type="text" name="attr_athletics_bonus" title="@{athletics_bonus}" value="(@{strength_mod}+@{athletics_proficiency})" disabled="true">
                        <button type="roll" name="roll_athletics" value="@{wtype}&{template:simple} {{rname=ATHLETICS}} {{mod=[[[[@{athletics_bonus}]][ATH]]]}} {{r1=[[1d20@{halflingluck}+[[@{athletics_bonus}]][ATH]]]}} @{rtype}@{halflingluck}+[[@{athletics_bonus}]][ATH]]]}}">Athletics <span>(Str)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_deception_prof" title="@{deception_prof}" value="(@{pb}*@{deception_type})">
                        <input type="text" name="attr_deception_bonus" title="@{deception_bonus}" value="(@{charisma_mod}+@{deception_proficiency})" disabled="true">
                        <button type="roll" name="roll_deception" value="@{wtype}&{template:simple} {{rname=DECEPTION}} {{mod=[[[[@{deception_bonus}]][DEC]]]}} {{r1=[[1d20@{halflingluck}+[[@{deception_bonus}]][DEC]]]}} @{rtype}@{halflingluck}+[[@{deception_bonus}]][DEC]]]}}">Deception <span>(Cha)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_history_prof" title="@{history_prof}" value="(@{pb}*@{history_type})">
                        <input type="text" name="attr_history_bonus" title="@{history_bonus}" value="(@{intelligence_mod}+@{history_proficiency})" disabled="true">
                        <button type="roll" name="roll_history" value="@{wtype}&{template:simple} {{rname=HISTORY}} {{mod=[[[[@{history_bonus}]][HIS]]]}} {{r1=[[1d20@{halflingluck}+[[@{history_bonus}]][HIS]]]}} @{rtype}@{halflingluck}+[[@{history_bonus}]][HIS]]]}}">History <span>(Int)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_insight_prof" title="@{insight_prof}" value="(@{pb}*@{insight_type})">
                        <input type="text" name="attr_insight_bonus" title="@{insight_bonus}" value="(@{wisdom_mod}+@{insight_proficiency})" disabled="true">
                        <button type="roll" name="roll_insight" value="@{wtype}&{template:simple} {{rname=INSIGHT}} {{mod=[[[[@{insight_bonus}]][INS]]]}} {{r1=[[1d20@{halflingluck}+[[@{insight_bonus}]][INS]]]}} @{rtype}@{halflingluck}+[[@{insight_bonus}]][INS]]]}}">Insight <span>(Wis)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_intimidation_prof" title="@{intimidation_prof}" value="(@{pb}*@{intimidation_type})">
                        <input type="text" name="attr_intimidation_bonus" title="@{intimidation_bonus}" value="(@{charisma_mod}+@{intimidation_proficiency})" disabled="true">
                        <button type="roll" name="roll_intimidation" value="@{wtype}&{template:simple} {{rname=INTIMIDATION}} {{mod=[[[[@{intimidation_bonus}]][INT]]]}} {{r1=[[1d20@{halflingluck}+[[@{intimidation_bonus}]][INT]]]}} @{rtype}@{halflingluck}+[[@{intimidation_bonus}]][INT]]]}}">Intimidation <span>(Cha)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_investigation_prof" title="@{investigation_prof}" value="(@{pb}*@{investigation_type})">
                        <input type="text" name="attr_investigation_bonus" title="@{investigation_bonus}" value="(@{intelligence_mod}+@{investigation_proficiency})" disabled="true">
                        <button type="roll" name="roll_investigation" value="@{wtype}&{template:simple} {{rname=INVESTIGATION}} {{mod=[[[[@{investigation_bonus}]][INV]]]}} {{r1=[[1d20@{halflingluck}+[[@{investigation_bonus}]][INV]]]}} @{rtype}@{halflingluck}+[[@{investigation_bonus}]][INV]]]}}">Investigation <span>(Int)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_medicine_prof" title="@{medicine_prof}" value="(@{pb}*@{medicine_type})">
                        <input type="text" name="attr_medicine_bonus" title="@{medicine_bonus}" value="(@{wisdom_mod}+@{medicine_proficiency})" disabled="true">
                        <button type="roll" name="roll_medicine" value="@{wtype}&{template:simple} {{rname=MEDICINE}} {{mod=[[[[@{medicine_bonus}]][MED]]]}} {{r1=[[1d20@{halflingluck}+[[@{medicine_bonus}]][MED]]]}} @{rtype}@{halflingluck}+[[@{medicine_bonus}]][MED]]]}}">Medicine <span>(Wis)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_nature_prof" title="@{nature_prof}" value="(@{pb}*@{nature_type})">
                        <input type="text" name="attr_nature_bonus" title="@{nature_bonus}" value="(@{intelligence_mod}+@{nature_proficiency})" disabled="true">
                        <button type="roll" name="roll_nature" value="@{wtype}&{template:simple} {{rname=NATURE}} {{mod=[[[[@{nature_bonus}]][NAT]]]}} {{r1=[[1d20@{halflingluck}+[[@{nature_bonus}]][NAT]]]}} @{rtype}@{halflingluck}+[[@{nature_bonus}]][NAT]]]}}">Nature <span>(Int)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_perception_prof" title="@{perception_prof}" value="(@{pb}*@{perception_type})">
                        <input type="text" name="attr_perception_bonus" title="@{perception_bonus}" value="(@{wisdom_mod}+@{perception_proficiency})" disabled="true">
                        <button type="roll" name="roll_perception" value="@{wtype}&{template:simple} {{rname=PERCEPTION}} {{mod=[[[[@{perception_bonus}]][PER]]]}} {{r1=[[1d20@{halflingluck}+[[@{perception_bonus}]][PER]]]}} @{rtype}@{halflingluck}+[[@{perception_bonus}]][PER]]]}}">Perception <span>(Wis)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_performance_prof" title="@{performance_prof}" value="(@{pb}*@{performance_type})">
                        <input type="text" name="attr_performance_bonus" title="@{performance_bonus}" value="(@{charisma_mod}+@{performance_proficiency})" disabled="true">
                        <button type="roll" name="roll_performance" value="@{wtype}&{template:simple} {{rname=PERFORMANCE}} {{mod=[[[[@{performance_bonus}]][PER]]]}} {{r1=[[1d20@{halflingluck}+[[@{performance_bonus}]][PER]]]}} @{rtype}@{halflingluck}+[[@{performance_bonus}]][PER]]]}}">Performance <span>(Cha)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_persuasion_prof" title="@{persuasion_prof}" value="(@{pb}*@{persuasion_type})">
                        <input type="text" name="attr_persuasion_bonus" title="@{persuasion_bonus}" value="(@{charisma_mod}+@{persuasion_proficiency})" disabled="true">
                        <button type="roll" name="roll_persuasion" value="@{wtype}&{template:simple} {{rname=PERSUASION}} {{mod=[[[[@{persuasion_bonus}]][PER]]]}} {{r1=[[1d20@{halflingluck}+[[@{persuasion_bonus}]][PER]]]}} @{rtype}@{halflingluck}+[[@{persuasion_bonus}]][PER]]]}}">Persuasion <span>(Cha)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_religion_prof" title="@{religion_prof}" value="(@{pb}*@{religion_type})">
                        <input type="text" name="attr_religion_bonus" title="@{religion_bonus}" value="(@{intelligence_mod}+@{religion_proficiency})" disabled="true">
                        <button type="roll" name="roll_religion" value="@{wtype}&{template:simple} {{rname=RELIGION}} {{mod=[[[[@{religion_bonus}]][REL]]]}} {{r1=[[1d20@{halflingluck}+[[@{religion_bonus}]][REL]]]}} @{rtype}@{halflingluck}+[[@{religion_bonus}]][REL]]]}}">Religion <span>(Int)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_sleight_of_hand_prof" title="@{sleight_of_hand_prof}" value="(@{pb}*@{sleight_of_hand_type})">
                        <input type="text" name="attr_sleight_of_hand_bonus" title="@{sleight_of_hand_bonus}" value="(@{dexterity_mod}+@{sleight_of_hand_proficiency})" disabled="true">
                        <button type="roll" name="roll_sleight_of_hand" value="@{wtype}&{template:simple} {{rname=SLEIGHT OF HAND}} {{mod=[[[[@{sleight_of_hand_bonus}]][SLE]]]}} {{r1=[[1d20@{halflingluck}+[[@{sleight_of_hand_bonus}]][SLE]]]}} @{rtype}@{halflingluck}+[[@{sleight_of_hand_bonus}]][SLE]]]}}">Sleight of Hand <span>(Dex)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_stealth_prof" title="@{stealth_prof}" value="(@{pb}*@{stealth_type})">
                        <input type="text" name="attr_stealth_bonus" title="@{stealth_bonus}" value="(@{dexterity_mod}+@{stealth_proficiency})" disabled="true">
                        <button type="roll" name="roll_stealth" value="@{wtype}&{template:simple} {{rname=STEALTH}} {{mod=[[[[@{stealth_bonus}]][STE]]]}} {{r1=[[1d20@{halflingluck}+[[@{stealth_bonus}]][STE]]]}} @{rtype}@{halflingluck}+[[@{stealth_bonus}]][STE]]]}}">Stealth <span>(Dex)</span></button>
                    </div>
                    <div class="skill">
                        <input type="checkbox" name="attr_survival_prof" title="@{survival_prof}" value="(@{pb}*@{survival_type})">
                        <input type="text" name="attr_survival_bonus" title="@{survival_bonus}" value="(@{wisdom_mod}+@{survival_proficiency})" disabled="true">
                        <button type="roll" name="roll_survival" value="@{wtype}&{template:simple} {{rname=SURVIVAL}} {{mod=[[[[@{survival_bonus}]][SUR]]]}} {{r1=[[1d20@{halflingluck}+[[@{survival_bonus}]][SUR]]]}} @{rtype}@{halflingluck}+[[@{survival_bonus}]][SUR]]]}}">Survival <span>(Wis)</span></button>
                    </div>
                    <div class="label">
                        <span>SKILLS</span>
                    </div>
                </div>
            </div>
            <div class="insp-prof-container" style="width: 100%; margin-top: 2px;">
                <div class="value">
                    <input type="text" name="attr_passive_wisdom" title="@{passive_wisdom}" value="(10+@{perception_bonus})" disabled="true" ><span></span>
                </div>
                <div class="label" style="width: 217px;">
                    <span>PASSIVE WISDOM (PERCEPTION)</span>
                </div>
            </div>
            <div class="tool_proficiencies" style="margin-bottom: 10px; min-height: 100px; position: relative;">
                <div class="top">
                    <span class="label" style="width: 95px;">TOOL</span>
                    <span class="label" style="width: 25px;">PRO</span>
                    <span class="label" style="width: 95px;">ATTRIBUTE</span>
                </div>
                 <fieldset class="repeating_tool">
                    <div class="tool">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_toolname_base" style="width: 95px;">
                            </div>
                            <div class="row">
                                <span>PROFICIENCY BONUS:</span>
                                <select name="attr_toolbonus_base">
                                    <option value="(@{pb})" selected="selected">PROFICIENT</option>
                                    <option value="(@{pb}*2)">EXPERTISE</option>
                                    <option value="(floor(@{pb}/2))">JACK OF ALL TRADES</option>
                                </select>
                            </div>
                            <div class="row">
                                <span>ATTRIBUTE:</span>
                                <select name="attr_toolattr_base">
                                    <option value="@{strength_mod}" selected="selected">STRENGTH</option>
                                    <option value="@{dexterity_mod}">DEXTERITY</option>
                                    <option value="@{constitution_mod}">CONSTITUTION</option>
                                    <option value="@{intelligence_mod}">INTELLIGENCE</option>
                                    <option value="@{wisdom_mod}">WISDOM</option>
                                    <option value="@{charisma_mod}">CHARISMA</option>
                                </select>
                            </div>
                        </div>
                        <div class="display">
                            <button type="roll" name="roll_tool" value="@{wtype}&{template:simple} {{rname=@{toolname}}} {{mod=[[[[@{toolbonus}]][TOOL]]]}} {{r1=[[1d20@{halflingluck}+[[@{toolbonus}]][TOOL]]]}} @{rtype}@{halflingluck}+[[@{toolbonus}]][TOOL]]]}}">
                                <input type="text" name="attr_toolname" style="width: 95px;">
                                <input type="text" name="attr_toolbonus" style="width: 30px; text-align: center;">
                                <input type="text" name="attr_toolattr" style="width: 100px;">
                            </button>
                        </div>
                    </div>
                 </fieldset>
                <div class="label" style="position: absolute; bottom: 0px; width: 100%;">
                    <span>TOOL PROFICIENCIES</span>
                </div>
            </div>
            <div class="textbox-container">
                <textarea name="attr_other_proficiencies_and_languages" style="min-height: 91px; height: 91px;"></textarea>
                <div class="label">
                    <span style="margin-top: -10px;">OTHER PROFICIENCIES & LANGUAGES</span>
                </div>
            </div>
        </div>
        <div class="col col2">
            <div class="ac-init-speed-container">
                <div class="ac" style="margin-right: 1px;">
                    <input type="text" name="attr_ac" title="@{ac}">
                    <span class="label">ARMOR CLASS</span>
                </div>
                <div class="init">
                    <input type="text" name="attr_initiative_bonus" title="@{initiative_bonus}" value="(@{dexterity_mod}+@{initmod}+@{jack_of_all_trades})" disabled="true">
                    <button type="roll" name="roll_initiative" value="@{wtype}&{template:simple} {{rname=INITIATIVE}} {{mod=[[@{initiative_bonus}[INIT]]]}} {{r1=[[1d20@{halflingluck}+[[@{initiative_bonus}]][INIT] &{tracker}]]}} {{normal=1}}">INITIATIVE</button>
                </div>
                <div class="speed">
                    <input type="text" name="attr_speed" title="@{speed}">
                    <span class="label">SPEED</span>
                </div>
            </div>
            <div class="hp"  style="height: 76px;">
                <div class="top">
                    <span>Hit Point Maximum</span>
                    <input type="text" name="attr_hp_max" title="@{hp_max}">
                </div>
                <input type="text" name="attr_hp" title="@{hp}">
                <span class="label">CURRENT HIT POINTS</span>
            </div>
            <div class="hp" style="height: 56px;">
                <input type="text" name="attr_hp_temp" title="@{hp_temp}">
                <span class="label">TEMPORARY HIT POINTS</span>
            </div>
            <div class="hdice-dsaves-container" style="width: 242px;">
                <div class="subcontainer" style="height: 64px; width: 117px;">
                    <div class="top">
                        <span>Total</span>
                        <input type="text" name="attr_hit_dice_max" title="@{hit_dice_max}">
                    </div>
                    <input type="text" name="attr_hit_dice" title="@{hit_dice}" style="margin-bottom: -6px;">
                    <button type="roll" name="roll_hit_dice" value="@{wtype}&{template:simple} {{rname=HIT DIE}} {{mod=D@{hitdie_final}+[[@{constitution_mod}[CON]]]}} {{r1=[[1d@{hitdie_final}+[[@{constitution_mod}]][CON]]]}} {{normal=1}}">HIT DICE</button>
                </div>
                <div class="subcontainer" style="height: 64px; width: 117px; float: right;">
                    <div class="row-container">
                        <span class="label">SUCCESSES</span>
                        <input type="checkbox" name="attr_deathsave_succ1">
                        <input type="checkbox" name="attr_deathsave_succ2">
                        <input type="checkbox" name="attr_deathsave_succ3">
                    </div>
                    <div class="row-container">
                        <span class="label">FAILURES</span>
                        <input type="checkbox" name="attr_deathsave_fail1">
                        <input type="checkbox" name="attr_deathsave_fail2">
                        <input type="checkbox" name="attr_deathsave_fail3">
                    </div>
                    <button type="roll" name="roll_death_save" style="margin-top: 6px;" value="@{wtype}&{template:simple} {{rname=DEATH SAVE}} {{mod=@{deathsavemod}}} {{r1=[[1d20@{halflingluck}+@{deathsavemod}[MOD]]]}} {{normal=1}}">DEATH SAVES</button>
                </div>
            </div>
            <input class="dflag" type="hidden" name="attr_dflag" value="pick">
            <div class="attacks" style="position: relative;">
                <div class="top">
                    <span class="label" style="width: 95px;">NAME</span>
                    <span class="label" style="width: 25px;">ATK</span>
                    <span class="label" style="width: 95px;">DAMAGE/TYPE</span>
                </div>
                <fieldset class="repeating_attack">
                    <div class="attack">
                        <input type="hidden" name="attr_updateflag">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_atkname_base">
                            </div>
                            <div class="row">
                                <input type="checkbox" name="attr_atkflag" value="{{attack=1}}" checked="checked">
                                <span>ATTACK:</span>
                                <select name="attr_atkattr_base">
                                    <option value="@{strength_mod}" selected="selected">STR</option>
                                    <option value="@{dexterity_mod}">DEX</option>
                                    <option value="@{constitution_mod}">CON</option>
                                    <option value="@{intelligence_mod}">INT</option>
                                    <option value="@{wisdom_mod}">WIS</option>
                                    <option value="@{charisma_mod}">CHA</option>
                                    <option value="0">-</option>
                                </select>
                                <span>+</span>
                                <input type="text" class="num" name="attr_atkmod" placeholder="0">
                                <span>+</span>
                                <input type="checkbox" name="attr_atkprofflag" value="(@{pb})" checked="checked" style="margin-left: 3px;">
                                <span>PROFICIENT</span>
                            </div>
                            <div class="row">
                                <span style="margin-left: 17px;">RANGE:</span>
                                <input type="text" name="attr_atkrange" placeholder="Self (60-foot cone)" style="width: 170px;">
                            </div>
                            <div class="row">
                                <span style="margin-left: 17px;">MAGIC BONUS:</span>
                                <input type="text" class="num" name="attr_atkmagic" placeholder="0">
                                <span>CRIT RANGE:</span>
                                <input type="text" class="num" name="attr_atkcritrange" value="20" placeholder="20">
                            </div>
                            <div class="row">
                                <input type="checkbox" name="attr_dmgflag" value="{{damage=1}} {{dmg1flag=1}}" checked="checked">
                                <span>DAMAGE:</span>
                                <input type="text" name="attr_dmgbase" placeholder="1d6" style="width: 50px;">
                                <span>+</span>
                                <select name="attr_dmgattr">
                                    <option value="@{strength_mod}" selected="selected">STR</option>
                                    <option value="@{dexterity_mod}">DEX</option>
                                    <option value="@{constitution_mod}">CON</option>
                                    <option value="@{intelligence_mod}">INT</option>
                                    <option value="@{wisdom_mod}">WIS</option>
                                    <option value="@{charisma_mod}">CHA</option>
                                    <option value="0">-</option>
                                </select>
                                <span>+</span>
                                <input type="text" class="num" name="attr_dmgmod" placeholder="0">
                            </div>
                            <div class="row">
                                <span style="margin-left: 17px;">TYPE:</span>
                                <input type="text" name="attr_dmgtype" placeholder="Slashing" style="width: 50px;">
                                <span>CRIT:</span>
                                <input type="text" name="attr_dmgcustcrit" placeholder="1d6" style="width: 80px;">
                            </div>
                            <div class="row">
                                <input type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}">
                                <span>DAMAGE2:</span>
                                <input type="text" name="attr_dmg2base" placeholder="1d6" style="width: 50px;">
                                <span>+</span>
                                <select name="attr_dmg2attr">
                                    <option value="@{strength_mod}" selected="selected">STR</option>
                                    <option value="@{dexterity_mod}">DEX</option>
                                    <option value="@{constitution_mod}">CON</option>
                                    <option value="@{intelligence_mod}">INT</option>
                                    <option value="@{wisdom_mod}">WIS</option>
                                    <option value="@{charisma_mod}">CHA</option>
                                    <option value="0">-</option>
                                </select>
                                <span>+</span>
                                <input type="text" class="num" name="attr_dmg2mod" placeholder="0">
                            </div>
                            <div class="row">
                                <span style="margin-left: 17px;">TYPE:</span>
                                <input type="text" name="attr_dmg2type" placeholder="Slashing" style="width: 50px;">
                                <span>CRIT:</span>
                                <input type="text" name="attr_dmg2custcrit" placeholder="1d6" style="width: 80px;">
                            </div>
                            <div class="row">
                                <input type="checkbox" name="attr_saveflag" value="{{save=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}}  {{savedc=[[@{savedc}]]}}">
                                <span>SAVING THROW:</span>
                                <select name="attr_saveattr">
                                    <option value="Strength" selected="selected">STR</option>
                                    <option value="Dexterity">DEX</option>
                                    <option value="Constitution">CON</option>
                                    <option value="Intelligence">INT</option>
                                    <option value="Wisdom">WIS</option>
                                    <option value="Charisma">CHA</option>
                                </select>
                                <span>VS DC:
                                <select name="attr_savedc">
                                    <option value="(@{spell_save_dc})" selected="selected">SPELL</option>
                                    <option value="(@{strength_mod}+8+@{pb})">STR</option>
                                    <option value="(@{dexterity_mod}+8+@{pb})">DEX</option>
                                    <option value="(@{constitution_mod}+8+@{pb})">CON</option>
                                    <option value="(@{intelligence_mod}+8+@{pb})">INT</option>
                                    <option value="(@{wisdom_mod}+8+@{pb})">WIS</option>
                                    <option value="(@{charisma_mod}+8+@{pb})">CHA</option>
                                </select>
                            </div>
                            <div class="row">
                                <span>SAVE EFFECT:</span>
                                <input type="text" name="attr_saveeffect" placeholder="half damage" style="width: 160px;">
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                                <textarea name="attr_atk_desc" placeholder="Up to 2 creatures within 5 feet"></textarea>
                            </div>
                        </div>
                        <div class="display">
                            <input class="pickbase" type="hidden" name="attr_hidden_pickbase" value="pick">
                            <button class="pick" type="roll" name="roll_attack_pick" value="@{wtype}&{template:atk} {{mod=@{atkbonus}}} {{rname=[@{atkname}](~repeating_attack_attack_dmg)}} {{rnamec=[@{atkname}](~repeating_attack_attack_crit)}} {{r1=[[@{hidden_r1base}@{halflingluck}cs>@{atkcritrange}@{hidden_atkbonus}]]}} @{hidden_r2base}@{halflingluck}cs>@{atkcritrange}@{hidden_atkbonus}]]}} {{range=@{atkrange}}} {{desc=@{atk_desc}}}">
                                <input type="text" name="attr_atkname" style="width: 95px;" value="">
                                <input type="text" name="attr_atkbonus" style="width: 35px; text-align: center;" value="">
                                <input type="text" name="attr_atkdmgtype" style="width: 95px;" value="">
                            </button>
                            <button class="dmg" type="roll" name="roll_attack_dmg" value="@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[@{hidden_dmg1}]]}} {{dmg1type=@{hidden_dmg1type}}} @{dmg2flag} {{dmg2=[[@{hidden_dmg2}]]}}} {{dmg2type=@{hidden_dmg2type}}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg}">
                                <input type="text" name="attr_atkname" style="width: 95px;" value="">
                                <input type="text" name="attr_atkbonus" style="width: 35px; text-align: center;" value="">
                                <input type="text" name="attr_atkdmgtype" style="width: 95px;" value="">
                            </button>
                            <button class="crit" type="roll" name="roll_attack_crit" value="@{wtype}&{template:dmg} {{crit=1}} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[@{hidden_dmg1}]]}} {{dmg1type=@{hidden_dmg1type}}} @{dmg2flag} {{dmg2=[[@{hidden_dmg2}]]}}} {{dmg2type=@{hidden_dmg2type}}} {{crit1=[[@{hidden_crit1}]]}} {{crit2=[[@{hidden_crit2}]]}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg}">
                                <input type="text" name="attr_atkname" style="width: 95px;" value="">
                                <input type="text" name="attr_atkbonus" style="width: 35px; text-align: center;" value="">
                                <input type="text" name="attr_atkdmgtype" style="width: 95px;" value="">
                            </button>
                            <button class="empty" type="roll" name="roll_attack_empty" value"">
                                <input type="text" name="attr_atkname" style="width: 95px;" value="">
                                <input type="text" name="attr_atkbonus" style="width: 35px; text-align: center;" value="">
                                <input type="text" name="attr_atkdmgtype" style="width: 95px;" value="">
                            </button>
                            <button class="full" type="roll" name="roll_attack_full" value="@{wtype}&{template:atkdmg} {{mod=@{atkbonus}}} {{rname=@{atkname}}} {{r1=[[@{hidden_r1base}@{halflingluck}cs>@{atkcritrange}@{hidden_atkbonus}]]}} @{hidden_r2base}@{halflingluck}cs>@{atkcritrange}@{hidden_atkbonus}]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[@{hidden_dmg1}]]}} {{dmg1type=@{hidden_dmg1type}}} @{dmg2flag} {{dmg2=[[@{hidden_dmg2}]]}}} {{dmg2type=@{hidden_dmg2type}}} {{crit1=[[@{hidden_crit1}]]}} {{crit2=[[@{hidden_crit2}]]}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg}">
                                <input type="text" name="attr_atkname" style="width: 95px;" value="">
                                <input type="text" name="attr_atkbonus" style="width: 35px; text-align: center;" value="">
                                <input type="text" name="attr_atkdmgtype" style="width: 95px;" value="">
                            </button>
                        </div>
                    </div>
                    <input type="hidden" name="attr_hidden_r1base">
                    <input type="hidden" name="attr_hidden_r2base">
                    <input type="hidden" name="attr_hidden_atkbonus">
                    <input type="hidden" name="attr_hidden_dmg1">
                    <input type="hidden" name="attr_hidden_dmg2">
                    <input type="hidden" name="attr_hidden_dmg1type">
                    <input type="hidden" name="attr_hidden_dmg2type">
                    <input type="hidden" name="attr_hidden_crit1">
                    <input type="hidden" name="attr_hidden_crit2">
                    <input type="hidden" name="attr_hldmg">
                    <input type="hidden" name="attr_itemid">
                    <input type="hidden" name="attr_spellid">
                </fieldset>
                <span class="label" style="margin-top: 0px; position: absolute; bottom: 0px;">ATTACKS & SPELLCASTING</span>
            </div>
            <div class="equipment">
                <div class="money">
                    <div class="coin">
                        <span class="label">CP</span>
                        <input type="text" name="attr_cp" title="@{cp}">
                    </div>
                    <div class="coin">
                        <span class="label">SP</span>
                        <input type="text" name="attr_sp" title="@{sp}">
                    </div>
                    <div class="coin">
                        <span class="label">EP</span>
                        <input type="text" name="attr_ep" title="@{ep}">
                    </div>
                    <div class="coin">
                        <span class="label">GP</span>
                        <input type="text" name="attr_gp" title="@{gp}">
                    </div>
                    <div class="coin">
                        <span class="label">PP</span>
                        <input type="text" name="attr_pp" title="@{pp}">
                    </div>
                </div>
                <input type="hidden" class="inventoryflag" name="attr_inventoryflag" value="complex">
                <textarea class="simple" name="attr_equipment"></textarea>
                <div class="complex">
                    <input type="hidden" class="warningflag" name="attr_armorwarningflag">
                    <div class="warning">
                        <span>
                            <input type="checkbox" name="attr_armorwarning" value="hide">
                            WARNING - MULTIPLE SETS OF ARMOR OR SHIELDS HAVE BEEN ADDED AND AC IS NOT CORRECTLY CALCULATED
                        </span>
                    </div>
                    <div class="header" style="height: auto;">
                        <span class="pictos" style="width: 25px; font-size: 15px;">*</span>
                        <span style="width: 100px; text-align: left;">ITEM NAME</SPAN>
                        <span style="width: 25px;"><img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/5th%20Edition%20OGL%20by%20Roll20/weight_lbs.png" style="width: 15px; margin-bottom: -3px;"></span>
                    </div>
                    <fieldset class="repeating_inventory">
                        <div class="item compendium-drop-target">
                            <input class="weight" type="text" name="attr_itemcount" value="1">
                            <input class="name" type="text" name="attr_itemname" accept="Name">
                            <input class="weight" type="text" name="attr_itemweight" accept="Weight">
                            <input class="inventorysubflag" type="checkbox" name="attr_inventorysubflag"><span>i</span>
                            <div class="subitem">
                                <span class="label">PROP:</span>
                                <input class="subfield" type="text" name="attr_itemproperties" accept="Properties">
                                <span class="label">MODS:</span>
                                <input class="subfield" type="text" name="attr_itemmodifiers" accept="Modifiers">
                                <textarea class="subtextarea" name="attr_itemcontent" accept="Content"></textarea>
                            </div>
                            <input type="hidden" name="attr_itemtype" accept="Item Type">
                            <input type="hidden" name="attr_itemdamage" accept="Damage">
                            <input type="hidden" name="attr_itemdamagetype" accept="Damage Type">
                            <input type="hidden" name="attr_itemrange" accept="Range">
                            <input type="hidden" name="attr_itemac" accept="AC">
                            <input type="hidden" name="attr_itemattackid">
                        </div>
                    </fieldset>
                    <div class="weighttotal">
                        <span class="label">TOTAL WEIGHT</span>
                        <input type="text" name="attr_weighttotal" value="0">
                    </div>
                </div>
                <span class="label" style="margin-top: 0px; position: absolute; bottom: 0px;">EQUIPMENT</span>
            </div>
        </div>
        <div class="col col3">
            <div class="textbox">
                <textarea name="attr_personality_traits" style="min-height: 50px; height: 50px;"></textarea>
                <span class="label">PERSONALITY TRAITS</span>
            </div>
            <div class="textbox">
                <textarea name="attr_ideals"></textarea>
                <span class="label">IDEALS</span>
            </div>
            <div class="textbox">
                <textarea name="attr_bonds"></textarea>
                <span class="label">BONDS</span>
            </div>
            <div class="textbox">
                <textarea name="attr_flaws" style="min-height: 46px; height: 46px;"></textarea>
                <span class="label">FLAWS</span>
            </div>
            <div class="resources">
                <div class="hdice-dsaves-container" style="width: 246px; margin-top: 10px;">
                    <div class="subcontainer" style="height: 64px; width: 119px;">
                        <div class="top">
                            <span>Total</span>
                            <input type="text" name="attr_class_resource_max" title="@{class_resource_max}">
                        </div>
                        <input type="text" name="attr_class_resource" title="@{class_resource}" style="margin-bottom: -6px;">
                        <input type="text" class="label" name="attr_class_resource_name" title="@{class_resource_name}" placeholder="CLASS RESOURCE">
                    </div>
                    <div class="subcontainer" style="height: 64px; width: 119px; float: right;">
                        <div class="top">
                            <span>Total</span>
                            <input type="text" name="attr_other_resource_max" title="@{other_resource_max}">
                        </div>
                        <input type="text" name="attr_other_resource" title="@{other_resource}" style="margin-bottom: -6px;">
                        <input type="text" class="label" name="attr_other_resource_name" title="@{other_resource_name}" placeholder="OTHER RESOURCE">
                    </div>
                </div>
                <fieldset class="repeating_resource">
                    <div class="hdice-dsaves-container" style="width: 246px; margin-top: 10px;">
                        <div class="subcontainer" style="height: 64px; width: 119px;">
                            <div class="top">
                                <span>Total</span>
                                <input type="text" name="attr_resource_left_max" title="@{repeating_resource_left_max}">
                            </div>
                            <input type="text" name="attr_resource_left" title="@{repeating_resource_left}" style="margin-bottom: -6px;">
                            <input type="text" class="label" name="attr_resource_left_name" title="@{repeating_resource_left_name}" placeholder="OTHER RESOURCE">
                        </div>
                        <div class="subcontainer" style="height: 64px; width: 119px;">
                            <div class="top">
                                <span>Total</span>
                                <input type="text" name="attr_resource_right_max" title="@{repeating_resource_right_max}">
                            </div>
                            <input type="text" name="attr_resource_right" title="@{repeating_resource_right}" style="margin-bottom: -6px;">
                            <input type="text" class="label" name="attr_resource_right_name" title="@{repeating_resource_right_name}" placeholder="OTHER RESOURCE">
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="textbox" style="">
                <textarea name="attr_features_and_traits" style="min-height: 480px; height: 480px;"></textarea>
                <span class="label">FEATURES & TRAITS</span>
            </div>
        </div>
        
    </div>
</div>
    
<div class="page bio">
    <div class="header">
        <div class="name-container">
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/5th%20Edition%20OGL%20by%20Roll20/srd5_360.png" style="padding-bottom: 5px;">
            <input type="text" name="attr_character_name" style="width: 100%;">
            <span class="label">CHARACTER NAME</span>
        </div>
        <div class="header-info">
            <div class="top" style="position: relative; top: 10px;">
                <div class="hlabel-container">
                    <input type="text" name="attr_age" style="width: 120px;">
                    <span class="label">AGE</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_size" style="width: 120px;">
                    <span class="label">SIZE</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_height" style="width: 120px;">
                    <span class="label">HEIGHT</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_weight" style="width: 120px;">
                    <span class="label">WEIGHT</span>
                </div>
            </div>
            <div class="bottom">
                <div class="hlabel-container">
                    <input type="text" name="attr_eyes" style="width: 160px;">
                    <span class="label">EYES</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_skin" style="width: 160px;">
                    <span class="label">SKIN</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_hair" style="width: 160px;">
                    <span class="label">HAIR</span>
                </div>
            </div>
        </div>
    </div>
    <div class="body">
        <div class="col col1">
            <div class="textbox">
                <textarea name="attr_character_appearance" style="min-height: 300px; height: 300px;"></textarea>
                <span class="label">CHARACTER APPEARANCE</span>
            </div>
            <div class="textbox">
                <textarea name="attr_character_backstory" style="min-height: 623px; height: 623px;"></textarea>
                <span class="label">CHARACTER BACKSTORY</span>
            </div>
        </div>
        <div class="col2-3">
            <div class="textbox">
                <textarea name="attr_allies_and_organizations" style="min-height: 288px; height: 300px;"></textarea>
                <span class="label">ALLIES & ORGANIZATIONS</span>
            </div>
            <div class="textbox">
                <textarea name="attr_additional_feature_and_traits" style="min-height: 289px; height: 300px;"></textarea>
                <span class="label">ADDITIONAL FEATURES & TRAITS</span>
            </div>
            <div class="textbox">
                <textarea name="attr_treasure" style="min-height: 300px; height: 300px;"></textarea>
                <span class="label">TREASURE</span>
            </div>
        </div>
    </div>
</div>

<div class="page spells">
    <div class="header">
        <div class="name-container">
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/5th%20Edition%20OGL%20by%20Roll20/srd5_360.png" style="padding-bottom: 5px;">
            <input type="text" name="attr_character_name" style="width: 100%;">
            <span class="label">CHARACTER NAME</span>
        </div>
        <div class="header-info">
            <div class="part">
                <select name="attr_spellcasting_ability">
                    <option value="0*">NONE</option>
                    <option value="@{strength_mod}+">STRENGTH</option>
                    <option value="@{dexterity_mod}+">DEXTERITY</option>
                    <option value="@{constitution_mod}+">CONSTITUTION</option>
                    <option value="@{intelligence_mod}+">INTELLIGENCE</option>
                    <option value="@{wisdom_mod}+">WISDOM</option>
                    <option value="@{charisma_mod}+">CHARISMA</option>
                </select>
                <span class="label">SPELLCASTING ABILITY</span>
            </div>
            <div class="part">
                <input type="text" name="attr_spell_save_dc" value="(@{spellcasting_ability}(8+@{pb}))" disabled="true">
                <span class="label">SPELL SAVE DC</span>
            </div>
            <div class="part">
                <input type="text" name="attr_spell_attack_bonus" value="(@{spellcasting_ability}@{pb})" disabled="true">
                <span class="label">SPELL ATTACK BONUS</span>
            </div>
        </div>
    </div>
    <div class="body">
        <div class="col col1">
        
            <div class="spell-level">
                <div class="level">
                    <span class="label">0</span>
                </div>
                <div class="cantrips">
                    <span class="label">CANTRIPS</span>
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-cantrip">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="Abjuration">Abjuration</option>
                                    <option value="Conjuration">Conjuration</option>
                                    <option value="Divination">Divination</option>
                                    <option value="Enchantment">Enchantment</option>
                                    <option value="Evocation">Evocation</option>
                                    <option value="Illusion">Illusion</option>
                                    <option value="Necromancy">Necromancy</option>
                                    <option value="Transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 3px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
            <div class="spell-level">
                <div class="level">
                    <span class="label">1</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl1_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl1_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-1">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
            <div class="spell-level">
                <div class="level">
                    <span class="label">2</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl2_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl2_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-2">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
        </div>
        <div class="col col2">
        
            <div class="spell-level">
                <div class="level">
                    <span class="label">3</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl3_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl3_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-3">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
            <div class="spell-level">
                <div class="level">
                    <span class="label">4</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl4_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl4_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-4">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
            <div class="spell-level">
                <div class="level">
                    <span class="label">5</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl5_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl5_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-5">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
        </div>
        <div class="col col3">
        
            <div class="spell-level">
                <div class="level">
                    <span class="label">6</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl6_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl6_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-6">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
            <div class="spell-level">
                <div class="level">
                    <span class="label">7</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl7_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl7_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-7">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
            <div class="spell-level">
                <div class="level">
                    <span class="label">8</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl8_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl8_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-8">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
            <div class="spell-level">
                <div class="level">
                    <span class="label">9</span>
                </div>
                <div class="total">
                    <input type="number" name="attr_lvl9_slots_total">
                </div>
                <div class="expended">
                    <input type="number" name="attr_lvl9_slots_expended" value="0">
                </div>
            </div>
            <div class="spell-container">
                <fieldset class="repeating_spell-9">
                    <div class="spell compendium-drop-target">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <div class="row">
                                <span>NAME:</span>
                                <input type="text" name="attr_spellname_base" accept="Name">
                                <input type="checkbox" name="attr_spellprepared" value="1" checked="checked">
                                <span>PREP</span>
                            </div>
                            <div class="row">
                                <span>SCHOOL:</span>
                                <select name="attr_spellschool" accept="School">
                                    <option value="abjuration">Abjuration</option>
                                    <option value="conjuration">Conjuration</option>
                                    <option value="divination">Divination</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="evocation">Evocation</option>
                                    <option value="illusion">Illusion</option>
                                    <option value="necromancy">Necromancy</option>
                                    <option value="transmutation">Transmutation</option>
                                </select>
                                <input type="hidden" name="attr_spellritualflag" accept="Ritual">
                                <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                <span>RITUAL</span>
                            </div>
                            <div class="row">
                                <span>CASTING TIME:</span>
                                <input type="text" name="attr_spellcastingtime" accept="Casting Time" style="width: 161px">
                            </div>
                            <div class="row">
                                <span>RANGE:</span>
                                <input type="text" name="attr_spellrange" accept="Range" style="width: 194px">
                            </div>
                            <div class="row">
                                <span>TARGET:</span>
                                <input type="text" name="attr_spelltarget" accept="Target" style="width: 189px">
                            </div>
                            <input type="hidden" name="attr_spellcomp" accept="Components">
                            <div class="row">
                                <span>COMPONENTS:</span>
                                <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                <span>V</span>
                                <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                <span>S</span>
                                <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                <span>M</span>
                                <input type="text" name="attr_spellcomp_materials" accept="Material" style="margin-left: 17px; width: 215px;" placeholder="ruby dust worth 50gp">
                            </div>
                            <div class="row">
                                <input type="hidden" name="attr_spellconcentrationflag" accept="Concentration">
                                <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                <span>CONCENTRATION</span>
                            </div>
                            <div class="row">
                                <span>DURATION:</span>
                                <input type="text" name="attr_spellduration" accept="Duration" style="width: 178px;">
                            </div>
                            <div class="row">
                                <span>OUTPUT:</span>
                                <select name="attr_spelloutput">
                                    <option value="SPELLCARD">SPELLCARD</option>
                                    <option value="ATTACK">ATTACK</option>
                                </select>
                            </div>
                            <input type="hidden" class="spellattackinfoflag" name="attr_spellattackinfoflag">
                            <div class="spellattackinfo">
                                <div class="row">
                                    <span>SPELL ATTACK:</span>
                                    <select name="attr_spellattack" accept="Spell Attack">
                                        <option value="None">None</option>
                                        <option value="Melee">Melee</option>
                                        <option value="Melee">Ranged</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <span>DAMAGE:</span>
                                    <input type="text" name="attr_spelldamage" accept="Damage" style="width: 50px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype" accept="Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>DAMAGE2:</span>
                                    <input type="text" name="attr_spelldamage2" accept="Secondary Damage" style="width: 45px;">
                                    <span>TYPE:</span>
                                    <input type="text" name="attr_spelldamagetype2" accept="Secondary Damage Type" style="width: 103px;">
                                </div>
                                <div class="row">
                                    <span>HEALING:</span>
                                    <input type="text" name="attr_spellhealing" accept="Healing" style="width: 45px;">
                                </div>
                                <div class="row">
                                    <input type="checkbox" name="attr_spelldmgmod" value="Yes" accept="Add Casting Modifier">
                                    <span>ADD ABILITY MOD TO DAMAGE OR HEALING</span>
                                </div>
                                <div class="row">
                                    <span>SAVING THROW:</span>
                                    <select name="attr_spellsave" accept="Save">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="Strength">STR</option>
                                        <option value="Dexterity">DEX</option>
                                        <option value="Constitution">CON</option>
                                        <option value="Intelligence">INT</option>
                                        <option value="Wisdom">WIS</option>
                                        <option value="Charisma">CHA</option>
                                    </select>
                                    <span>EFFECT:</span>
                                    <input type="text" name="attr_spellsavesuccess" accept="Save Success" style="width: 78px;" placeholder="Half damage">
                                </div>
                                <div class="row">
                                    <span>HIGHER LVL CAST DMG:</span>
                                    <input type="text" name="attr_spellhldie" placeholder="1" accept="Higher Spell Slot Dice" style="width: 15px; text-align: right;">
                                    <select name="attr_spellhldietype" accept="Higher Spell Slot Die">
                                        <option value="" selected="selected">NONE</option>
                                        <option value="d4">d4</option>
                                        <option value="d6">d6</option>
                                        <option value="d8">d8</option>
                                        <option value="d10">d10</option>
                                        <option value="d12">d12</option>
                                        <option value="d20">d20</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <span>DESCRIPTION:</span>
                            </div>
                            <input type="hidden" name="attr_spellcontent" accept="Content">
                            <div class="row">
                                <textarea name="attr_spelldescription"></textarea>
                            </div>
                            <div class="row">
                                <span>AT HIGHER LEVELS:</span>
                            </div>
                            <div class="row">
                                <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                            </div>
                            <input type="hidden" name="attr_spellattackid">
                            <input type="hidden" name="attr_spelllevel" accept="Level">
                            <input type="hidden" name="attr_spellhldie" accept="Higher Spell Slot Dice">
                            <input type="hidden" name="attr_spellhldietype" accept="Higher Spell Slot Die">
                            <input type="hidden" name="attr_spell_updateflag">
                        </div>
                        <div class="display">
                            <input type="hidden" name="attr_rollcontent" value="@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}}  {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}">
                            <button class="spellcard" type="roll" name="roll_spell" value="@{rollcontent}">
                                <input type="hidden" name="attr_prep" value=""><span class="prep"></span>
                                <input type="text" name="attr_spellname" style="width: 225px; margin-left: 13px;" value="">
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            
        </div>
    </div>
</div>

<div class="page options">
    <div class="header">
        <div class="name-container">
            <img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/5th%20Edition%20OGL%20by%20Roll20/srd5_360.png" style="padding-bottom: 5px;">
            <input type="text" name="attr_character_name" style="width: 100%;">
            <span class="label">CHARACTER NAME</span>
        </div>
        <div class="header-info">
            <div class="top">
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_customclass_flag" value="0">
                    <input class="showing" type="text" name="attr_cust_class" value="@{cust_classname}" disabled="true" style="width: 64px; height: 28px; padding-top: 10px;">
                    <select class="hiding" name="attr_class" style="width: 64px;">
                        <option value="Barbarian">Barbarian</option>
                        <option value="Bard">Bard</option>
                        <option value="Cleric">Cleric</option>
                        <option value="Druid">Druid</option>
                        <option value="Fighter">Fighter</option>
                        <option value="Monk">Monk</option>
                        <option value="Paladin">Paladin</option>
                        <option value="Ranger">Ranger</option>
                        <option value="Rogue">Rogue</option>
                        <option value="Sorcerer">Sorcerer</option>
                        <option value="Warlock">Warlock</option>
                        <option value="Wizard">Wizard</option>
                    </select>
                    <input type="number" name="attr_base_level" value="1" style="margin-left: -6px; width: 28px;">
                    <span class="label">CLASS & LEVEL</span>
                </div>
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_mutliclass1_showingflag" value="0">
                    <input class="hiding" type="text" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="hiding" type="text" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass1_name" value="@{multiclass1}" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass1_level" value="@{multiclass1_lvl}" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                </div>
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_mutliclass2_showingflag" value="0">
                    <input class="hiding" type="text" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="hiding" type="text" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass2_name" value="@{multiclass2}" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass2_level" value="@{multiclass2_lvl}" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                </div>
                <div class="hlabel-container">
                    <input class="flag" type="hidden" name="attr_mutliclass3_showingflag" value="0">
                    <input class="hiding" type="text" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="hiding" type="text" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass3_name" value="@{multiclass3}" disabled="true" style="width: 64px; margin-bottom: 30px;">
                    <input class="showing" type="text" name="attr_multiclass3_level" value="@{multiclass3_lvl}" disabled="true" style="margin-left: -6px; width: 28px; margin-bottom: 30px;">
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_background" style="width: 122px;">
                    <span class="label">BACKGROUND</span>
                </div>
            </div>
            <div class="bottom">
                <div class="hlabel-container">
                    <input type="text" name="attr_race" style="width: 200px;">
                    <span class="label">RACE</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_alignment" style="width: 180px;">
                    <span class="label">ALIGNMENT</span>
                </div>
                <div class="hlabel-container">
                    <input type="text" name="attr_experience" style="width: 100px;">
                    <span class="label">EXPERIENCE POINTS</span>
                </div>
            </div>
        </div>
    </div>
    <div class="body">
        <div class="col col1">
            <div class="class_options">
                <div class="row">
                    <span>HIT DIE:</span>
                    <select name="attr_hitdietype">
                        <option value="4">D4</option>
                        <option value="6">D6</option>
                        <option value="8">D8</option>
                        <option value="10">D10</option>
                        <option value="12">D12</option>
                    </select>
                </div>
                <div class="row">
                    <span>INITIATIVE MODIFIER:</span>
                    <input type="text" class="num" name="attr_initmod" placeholder="0" value="0">
                </div>
                <div class="row">
                    <span>GLOBAL SAVING THROW MODIFIER:</span>
                    <input type="text" class="num" name="attr_globalsavemod" placeholder="0" value="0">
                </div>
                <div class="row">
                    <span>DEATH SAVE MODIFIER:</span>
                    <input type="text" class="num" name="attr_deathsavemod" placeholder="0" value="0">
                </div>
                <div class="row">
                    <span>MAGIC CASTER LEVEL:</span>
                    <input type="text" class="num" name="attr_caster_level">
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_halflingluck_flag" value="1">
                    <span>HALFLING LUCK</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_arcane_fighter" value="1">
                    <span>ARCANE FIGHTER</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_arcane_rogue" value="1">
                    <span>ARCANE ROGUE</span>
                </div>
                <div class="row title">
                    <span>CLASS OPTIONS (<input type="text" name="attr_class_label" value="@{class}" disabled="true">)</span>
                </div>
            </div>
            <div class="class_options">
                <div class="row">
                    <input type="checkbox" name="attr_multiclass1_flag" value="1">
                    <span>2ND CLASS:</span>
                    <select name="attr_multiclass1" style="width: 64px;">
                        <option value="Barbarian">Barbarian</option>
                        <option value="Bard">Bard</option>
                        <option value="Cleric">Cleric</option>
                        <option value="Druid">Druid</option>
                        <option value="Fighter">Fighter</option>
                        <option value="Monk">Monk</option>
                        <option value="Paladin">Paladin</option>
                        <option value="Ranger">Ranger</option>
                        <option value="Rogue">Rogue</option>
                        <option value="Sorcerer">Sorcerer</option>
                        <option value="Warlock">Warlock</option>
                        <option value="Wizard">Wizard</option>
                    </select>
                    <span>LEVEL:</span>
                    <input type="text" name="attr_multiclass1_lvl" value="1" style="width: 28px; text-align: center;">
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_multiclass2_flag" value="1">
                    <span>3RD CLASS:</span>
                    <select name="attr_multiclass2" style="width: 64px;">
                        <option value="Barbarian">Barbarian</option>
                        <option value="Bard">Bard</option>
                        <option value="Cleric">Cleric</option>
                        <option value="Druid">Druid</option>
                        <option value="Fighter">Fighter</option>
                        <option value="Monk">Monk</option>
                        <option value="Paladin">Paladin</option>
                        <option value="Ranger">Ranger</option>
                        <option value="Rogue">Rogue</option>
                        <option value="Sorcerer">Sorcerer</option>
                        <option value="Warlock">Warlock</option>
                        <option value="Wizard">Wizard</option>
                    </select>
                    <span>LEVEL:</span>
                    <input type="text" name="attr_multiclass2_lvl" value="1" style="width: 28px; text-align: center;">
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_multiclass3_flag" value="1">
                    <span>4TH CLASS:</span>
                    <select name="attr_multiclass3" style="width: 64px;">
                        <option value="Barbarian">Barbarian</option>
                        <option value="Bard">Bard</option>
                        <option value="Cleric">Cleric</option>
                        <option value="Druid">Druid</option>
                        <option value="Fighter">Fighter</option>
                        <option value="Monk">Monk</option>
                        <option value="Paladin">Paladin</option>
                        <option value="Ranger">Ranger</option>
                        <option value="Rogue">Rogue</option>
                        <option value="Sorcerer">Sorcerer</option>
                        <option value="Warlock">Warlock</option>
                        <option value="Wizard">Wizard</option>
                    </select>
                    <span>LEVEL:</span>
                    <input type="text" name="attr_multiclass3_lvl" value="1" style="width: 28px; text-align: center;">
                </div>
                <div class="row title">
                    <span>MULTICLASS OPTIONS</span>
                </div>
            </div>
            <div class="class_options">
                <div class="row">
                    <input type="checkbox" name="attr_custom_class" value="1">
                    <span>USE CUSTOM CLASS</span>
                </div>
                <div class="row">
                    <span>CLASS NAME:</span>
                    <input type="text" name="attr_cust_classname">
                </div>
                <div class="row">
                    <span>HIT DIE:</span>
                    <select name="attr_cust_hitdietype">
                        <option value="4">D4</option>
                        <option value="6">D6</option>
                        <option value="8">D8</option>
                        <option value="10">D10</option>
                        <option value="12">D12</option>
                    </select>
                </div>
                <div class="row">
                    <span>SPELLCASTING ABILITY:</span>
                    <select name="attr_cust_spellcasting_ability">
                        <option value="0*">NONE</option>
                        <option value="@{strength_mod}+">STRENGTH</option>
                        <option value="@{dexterity_mod}+">DEXTERITY</option>
                        <option value="@{constitution_mod}+">CONSTITUTION</option>
                        <option value="@{intelligence_mod}+">INTELLIGENCE</option>
                        <option value="@{wisdom_mod}+">WISDOM</option>
                        <option value="@{charisma_mod}+">CHARISMA</option>
                    </select>
                </div>
                <div class="row">
                    <span>SPELL SLOTS:</span>
                    <select name="attr_cust_spellslots">
                        <option value="none">NONE</option>
                        <option value="full">FULL (Cleric, Druid, Wizard)</option>
                        <option value="half">HALF (Paladin, Ranger)</option>
                        <option value="third">THIRD (Arcane Fighter/Rogue)</option>
                    </select>
                </div>
                <div class="row">
                    <span>SAVES</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_cust_strength_save_prof" value="(@{pb})">
                    <span>Strength</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_cust_dexterity_save_prof" value="(@{pb})">
                    <span>Dexterity</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_cust_constitution_save_prof" value="(@{pb})">
                    <span>Constitution</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_cust_intelligence_save_prof" value="(@{pb})">
                    <span>Intelligence</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_cust_wisdom_save_prof" value="(@{pb})">
                    <span>Wisdom</span>
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_cust_charisma_save_prof" value="(@{pb})">
                    <span>Charisma</span>
                </div>
                <div class="row title">
                    <span>CUSTOM CLASS OPTIONS</span>
                </div>
            </div>
            
        </div>
        <div class="col col2">
            <div class="skill_options" style="width: 234px;">
                <div class="row skill">
                    <select name="attr_acrobatics_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Acrobatics <span>(Dex)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_animal_handling_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Animal Handling <span>(Wis)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_arcana_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Arcana <span>(Int)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_athletics_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Athletics <span>(Str)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_deception_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Deception <span>(Cha)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_history_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>History <span>(Int)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_insight_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Insight <span>(Wis)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_intimidation_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Intimidation <span>(Cha)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_investigation_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Investigation <span>(Int)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_medicine_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Medicine <span>(Wis)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_nature_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Nature <span>(Int)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_perception_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Perception <span>(Wis)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_performance_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Performance <span>(Cha)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_persuasion_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Persuasion <span>(Cha)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_religion_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Religion <span>(Int)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_sleight_of_hand_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Sleight of Hand <span>(Dex)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_stealth_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Stealth <span>(Dex)</span></span>
                </div>
                <div class="row skill">
                    <select name="attr_survival_type"><option value="1" selected="selected">Normal</option><option value="2">Expertise</option></select>
                    <span>Survival <span>(Wis)</span></span>
                </div>
                <div class="row" style="margin-top:10px;">
                    <input type="checkbox" name="attr_jack_of_all_trades" value="(floor(@{pb}/2))">
                    <span>JACK OF ALL TRADES</span>
                </div>
                <div class="row title">
                    <span>SKILL OPTIONS</span>
                </div>
            </div>
        </div>
        <div class="col col3">
            <div class="general_options">
                <div class="version">
                    <span>v</span>
                    <input type="text" name="attr_version" value="1.2">
                </div>
                <div class="row">
                    <input type="checkbox" name="attr_npc" value="1">
                    <span>NPC</span>
                </div>
                <div class="row">
                    <span>ROLL QUERIES:</span>
                    <select name="attr_rtype">
                        <option value="{{always=1}} {{r2=[[1d20">Always Roll Advantage</option>
                        <option value="{{query=1}} ?{Advantage?|Normal Roll,&#123&#123normal=1&#125&#125 &#123&#123r2=[[0d20|Advantage,&#123&#123advantage=1&#125&#125 &#123&#123r2=[[1d20|Disadvantage,&#123&#123disadvantage=1&#125&#125 &#123&#123r2=[[1d20}">Query Advantage</option>
                        <option value="{{normal=1}} {{r2=[[0d20">Never Roll Advantage</option>
                    </select>
                </div>
                <div class="row">
                    <span>WHISPER ROLLS TO GM:</span>
                    <select name="attr_wtype">
                        <option value="">Never Whisper Rolls</option>
                        <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }">Query Whisper</option>
                        <option value="/w gm ">Always Whisper Rolls</option>
                    </select>
                </div>
                <div class="row">
                    <span>AUTO DAMAGE ROLL:</span>
                    <select class="dtype" name="attr_dtype">
                        <option value="pick">Don't Auto Roll Damage</option>
                        <option value="full">Auto Roll Damage & Crit</option>
                    </select>
                </div>
                <div class="row">
                    <span>INVENTORY:</span>
                    <select name="attr_simpleinventory">
                        <option value="complex">Compendium Compatible</option>
                        <option value="simple">Simple</option>
                    </select>
                </div>
                <div class="row title">
                    <span>GENERAL OPTIONS</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer" style="font-size: 10px; color: rgb(165, 165, 165);">
    <span>
        Portions of this sheet utilize content from the System Reference Document 5.0 under the OGL License. View OGL License and Copyright Notice. https://wiki.roll20.net/SRD_5.0_OGL_License
    </span>
</div>

<!-- HIDDEN FIELDS -->
<input type="hidden" name="attr_level" value="1">
<input type="hidden" name="attr_acrobatics_proficiency" value="(((@{acrobatics_prof} + @{jack_of_all_trades}) + abs(@{acrobatics_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_animal_handling_proficiency" value="(((@{animal_handling_prof} + @{jack_of_all_trades}) + abs(@{animal_handling_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_arcana_proficiency" value="(((@{arcana_prof} + @{jack_of_all_trades}) + abs(@{arcana_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_athletics_proficiency" value="(((@{athletics_prof} + @{jack_of_all_trades}) + abs(@{athletics_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_deception_proficiency" value="(((@{deception_prof} + @{jack_of_all_trades}) + abs(@{deception_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_history_proficiency" value="(((@{history_prof} + @{jack_of_all_trades}) + abs(@{history_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_insight_proficiency" value="(((@{insight_prof} + @{jack_of_all_trades}) + abs(@{insight_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_intimidation_proficiency" value="(((@{intimidation_prof} + @{jack_of_all_trades}) + abs(@{intimidation_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_investigation_proficiency" value="(((@{investigation_prof} + @{jack_of_all_trades}) + abs(@{investigation_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_medicine_proficiency" value="(((@{medicine_prof} + @{jack_of_all_trades}) + abs(@{medicine_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_nature_proficiency" value="(((@{nature_prof} + @{jack_of_all_trades}) + abs(@{nature_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_perception_proficiency" value="(((@{perception_prof} + @{jack_of_all_trades}) + abs(@{perception_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_performance_proficiency" value="(((@{performance_prof} + @{jack_of_all_trades}) + abs(@{performance_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_persuasion_proficiency" value="(((@{persuasion_prof} + @{jack_of_all_trades}) + abs(@{persuasion_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_religion_proficiency" value="(((@{religion_prof} + @{jack_of_all_trades}) + abs(@{religion_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_sleight_of_hand_proficiency" value="(((@{sleight_of_hand_prof} + @{jack_of_all_trades}) + abs(@{sleight_of_hand_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_stealth_proficiency" value="(((@{stealth_prof} + @{jack_of_all_trades}) + abs(@{stealth_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_survival_proficiency" value="(((@{survival_prof} + @{jack_of_all_trades}) + abs(@{survival_prof} - @{jack_of_all_trades})) / 2)" disabled="true">
<input type="hidden" name="attr_hitdie_final" value="">
<input type="hidden" name="attr_globalsavingthrowbonus" value="">
<input type="hidden" name="attr_halflingluck" value="">

</div>

<!-- ROLL TEMPLATES -->
<div class="rolltemplates">
    
    <rolltemplate class="sheet-rolltemplate-simple">
        <div class="container">
            <div class="result">
                {{#always}}
                    <div class="adv">
                        <span>{{r1}}</span>
                    </div>
                    <div class="advspacer"></div>
                    <div class="adv">
                        <span>{{r2}}</span>
                    </div>
                {{/always}}
                {{#normal}}
                    <div class="solo">
                        <span>{{r1}}</span>
                    </div>
                {{/normal}}
                {{#advantage}}
                    {{#rollLess() r1 r2}}
                        <div class="adv">
                            <span class="grey">{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span class="grey">{{r2}}</span>
                        </div>
                    {{/rollGreater() r1 r2}}
                {{/advantage}}
                {{#disadvantage}}
                    {{#rollLess() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span class="grey">{{r2}}</span>
                        </div>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <div class="adv">
                            <span class="grey">{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollGreater() r1 r2}}
                {{/disadvantage}}
            </div>
            <div class="label">
                <span>{{rname}}{{#mod}} <span>({{mod}})</span>{{/mod}}</span>
            </div>
        </div>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-atk">
        <div class="container">
            <div class="result">
                {{#always}}
                    <div class="adv">
                        <span>{{r1}}</span>
                    </div>
                    <div class="advspacer"></div>
                    <div class="adv">
                        <span>{{r2}}</span>
                    </div>
                {{/always}}
                {{#normal}}
                    <div class="solo">
                        <span>{{r1}}</span>
                    </div>
                {{/normal}}
                {{#advantage}}
                    {{#rollLess() r1 r2}}
                        <div class="adv">
                            <span class="grey">{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span class="grey">{{r2}}</span>
                        </div>
                    {{/rollGreater() r1 r2}}
                {{/advantage}}
                {{#disadvantage}}
                    {{#rollLess() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span class="grey">{{r2}}</span>
                        </div>
                    {{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}
                        <div class="adv">
                            <span class="grey">{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/rollGreater() r1 r2}}
                {{/disadvantage}}
            </div>
            {{#range}}
                <div class="sublabel">
                    <span>{{range}}</span>
                </div>
            {{/range}}
            <div class="label">
                {{#normal}}
                    {{#rollWasCrit() r1}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}
                    {{#^rollWasCrit() r1}}<span>{{rname}} <span>({{mod}})</span></span>{{/^rollWasCrit() r1}}
                {{/normal}}
                {{#always}}
                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                    {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span>{{rname}} <span>({{mod}})</span></span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
                {{/always}}
                {{#advantage}}
                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                    {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span>{{rname}} <span>({{mod}})</span></span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
                {{/advantage}}
                {{#disadvantage}}
                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollTotal() r1 r2}}{{#^rollWasCrit() r1}}<span>{{rname}} <span>({{mod}})</span></span>{{/^rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                    {{#rollLess() r1 r2}}<span>{{rname}} <span>({{mod}})</span></span>{{/rollLess() r1 r2}}
                    {{#rollGreater() r1 r2}}<span>{{rname}} <span>({{mod}})</span></span>{{/rollGreater() r1 r2}}
                {{/disadvantage}}
            </div>
    	</div>
        {{#desc}}
            <div class="desc">
                <span>{{desc}}</span>
            </div>
        {{/desc}}
    </rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-dmg">
        {{#save}}
            {{#attack}}
                <div class="desc save">
            {{/attack}}
            {{^attack}}
                <div class="atk save">
            {{/attack}}
                <div class="savedc">
                    <span>DC{{savedc}}</span>
                </div>
                {{#savedesc}}
                    <div class="sublabel">
                        <span>{{savedesc}}</span>
                    </div>
                {{/savedesc}}
                <div class="label">
                    <span>{{saveattr}} Save</span>
                </div>
            </div>
        {{/save}}
        {{^attack}}
            {{#desc}}
                <div class="desc">
                    <span>{{desc}}</span>
                </div>
            {{/desc}}
        {{/attack}}
        {{#hldmg}}
            {{#^rollTotal() hldmg 0}}
                <div class="desc">
                    <span>{{hldmg}}</span>
                    <span class="sublabel">{{dmg1type}}</span>
                    <div class="label">
                        <span>Higher Level Cast</span>
                    </div>
                </div>
            {{/^rollTotal() hldmg 0}}
        {{/hldmg}}
        <div class="container damagetemplate">
            <div class="result">
    	        {{#dmg1flag}}
		            {{^dmg2flag}}
		            	<div class="solo">
		                    <span class="damage">{{dmg1}}{{#crit}} + {{crit1}}{{/crit}}</span>
		                    <span class="sublabel">{{dmg1type}}</span>
		                </div>
		            {{/dmg2flag}}
		        {{/dmg1flag}}
		        {{#dmg2flag}}
		        	{{^dmg1flag}}
		            	<div class="solo">
		                    <span class="damage">{{dmg2}}{{#crit}} + {{crit2}}{{/crit}}</span>
		                    <span class="sublabel">{{dmg2type}}</span>
		                </div>
		            {{/dmg1flag}}
		        {{/dmg2flag}}
		        {{#dmg1flag}}
		            {{#dmg2flag}}
		                <div class="adv">
		                    <span class="damage">{{dmg1}}{{#crit}} + {{crit1}}{{/crit}}</span>
		                    <span class="sublabel">{{dmg1type}}</span>
		                </div>
		                <div class="advspacer"></div>
		                <div class="adv">
		                    <span class="damage">{{dmg2}}{{#crit}} + {{crit2}}{{/crit}}</span>
		                    <span class="sublabel">{{dmg2type}}</span>
		                </div>
		            {{/dmg2flag}}
		        {{/dmg1flag}}
		    </div>
		    {{^attack}}
		        {{#range}}
		            <div class="sublabel" style="color: black;">
		                <span>{{range}}</span>
		            </div>
		        {{/range}}
                <div class="label">
    	            <span>{{rname}}</span>
		        </div>
		    {{/attack}}
		</div>
    </rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-atkdmg">
        {{#attack}}
            <div class="container atk">
                <div class="result">
                    {{#always}}
                        <div class="adv">
                            <span>{{r1}}</span>
                        </div>
                        <div class="advspacer"></div>
                        <div class="adv">
                            <span>{{r2}}</span>
                        </div>
                    {{/always}}
                    {{#normal}}
                        <div class="solo">
                            <span>{{r1}}</span>
                        </div>
                    {{/normal}}
                    {{#advantage}}
                        {{#rollLess() r1 r2}}
                            <div class="adv">
                                <span class="grey">{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}</span>
                            </div>
                        {{/rollLess() r1 r2}}
                        {{#rollTotal() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}</span>
                            </div>
                        {{/rollTotal() r1 r2}}
                        {{#rollGreater() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span class="grey">{{r2}}</span>
                            </div>
                        {{/rollGreater() r1 r2}}
                    {{/advantage}}
                    {{#disadvantage}}
                        {{#rollLess() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span class="grey">{{r2}}</span>
                            </div>
                        {{/rollLess() r1 r2}}
                        {{#rollTotal() r1 r2}}
                            <div class="adv">
                                <span>{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}</span>
                            </div>
                        {{/rollTotal() r1 r2}}
                        {{#rollGreater() r1 r2}}
                            <div class="adv">
                                <span class="grey">{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}</span>
                            </div>
                        {{/rollGreater() r1 r2}}
                    {{/disadvantage}}
                </div>
	            {{#range}}
	                <div class="sublabel">
	                    <span>{{range}}</span>
	                </div>
	            {{/range}}
	            <div class="label">
	                <span>{{rname}}{{#attack}} <span>({{mod}})</span>{{/attack}}</span>
	            </div>
        	</div>
        {{/attack}}
        {{#save}}
            {{#attack}}
                <div class="container desc save">
            {{/attack}}
            {{^attack}}
                <div class="container atk save">
            {{/attack}}
                <div class="savedc">
                    <span>DC{{savedc}}</span>
                </div>
                {{#savedesc}}
                    <div class="sublabel">
                        <span>{{savedesc}}</span>
                    </div>
                {{/savedesc}}
                <div class="label">
                    <span>{{saveattr}} Save</span>
                </div>
            </div>
        {{/save}}
        {{#desc}}
            <div class="desc">
                <span>{{desc}}</span>
            </div>
        {{/desc}}
        {{#hldmg}}
            {{#^rollTotal() hldmg 0}}
                <div class="desc">
                    <span>{{hldmg}}</span>
                    <span class="sublabel">{{dmg1type}}</span>
                    <div class="label">
                        <span>Higher Level Cast</span>
                    </div>
                </div>
            {{/^rollTotal() hldmg 0}}
        {{/hldmg}}
        {{#damage}}
            <div class="container damagetemplate">
                <div class="result">
                    {{#dmg1flag}}
                    	{{^dmg2flag}}
	                    	<div class="solo">
	                            <span class="damage">
	                            	{{dmg1}}
	                            	{{#attack}}
	                            		{{#normal}}
	                            			{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
	                            		{{/normal}}
                                        {{#always}}
                                			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/always}}
	                            		{{#advantage}}
	                            			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/advantage}}
	                            		{{#disadvantage}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            		{{/disadvantage}}
	                            	{{/attack}}
	                            </span>
                                <span class="sublabel">{{dmg1type}}</span>
	                        </div>
                        {{/dmg2flag}}
                    {{/dmg1flag}}
                    {{#dmg2flag}}
                    	{{^dmg1flag}}
	                    	<div class="solo">
	                            <span class="damage">
	                            	{{dmg2}}
	                            	{{#attack}}
	                            		{{#normal}}
	                            			{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
	                            		{{/normal}}
                                        {{#always}}
                                			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/always}}
	                            		{{#advantage}}
	                            			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/advantage}}
	                            		{{#disadvantage}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            		{{/disadvantage}}
	                            	{{/attack}}
	                            </span>
                                <span class="sublabel">{{dmg2type}}</span>
	                        </div>
                        {{/dmg1flag}}
                    {{/dmg2flag}}
                    {{#dmg1flag}}
                        {{#dmg2flag}}
                            <div class="adv">
	                            <span class="damage">
	                            	{{dmg1}}
	                            	{{#attack}}
	                            		{{#normal}}
	                            			{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
	                            		{{/normal}}
                                        {{#always}}
                                			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/always}}
	                            		{{#advantage}}
	                            			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/advantage}}
	                            		{{#disadvantage}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            		{{/disadvantage}}
	                            	{{/attack}}
	                            </span>
                                <span class="sublabel">{{dmg1type}}</span>
	                        </div>
	                        <div class="advspacer"></div>
	                        <div class="adv">
	                            <span>
	                            	{{dmg2}}
	                            	{{#attack}}
	                            		{{#normal}}
	                            			{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
	                            		{{/normal}}
                                        {{#always}}
                                			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/always}}
	                            		{{#advantage}}
	                            			{{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            			{{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
	                            		{{/advantage}}
	                            		{{#disadvantage}}
	                            			{{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
	                            		{{/disadvantage}}
	                            	{{/attack}}
	                            </span>
                                <span class="sublabel">{{dmg2type}}</span>
	                        </div>
                        {{/dmg2flag}}
                    {{/dmg1flag}}
                </div>
                {{^attack}}
	                {{#range}}
		                <div class="sublabel">
		                    <span>{{range}}</span>
		                </div>
		            {{/range}}
                    <div class="label">
                        <span>{{rname}}</span>
	                </div>
		        {{/attack}}
            </div>
        {{/damage}}
    </rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-spell">
        <div class="container">
            <div class="title row">
                <span>{{name}}</span>
            </div>
            <div class="italics row">
                <span>{{level}}{{#ritual}} (ritual){{/ritual}}</span>
            </div>
            <div class="spacer"></div>
            {{#castingtime}}
            <div class="row">
                <span class="bold">Casting Time: </span><span>{{castingtime}}<span>
            </div>
            {{/castingtime}}
            {{#range}}
            <div class="row">
                <span class="bold">Range: </span><span>{{range}}<span>
            </div>
            {{/range}}
            {{#target}}
            <div class="row">
                <span class="bold">Target: </span><span>{{target}}<span>
            </div>
            {{/target}}
            <div class="row">
                <span class="bold">Components: </span>
                <span>
                    {{#v}}V{{#s}}, {{/s}}{{^s}}{{#m}}, {{/m}}{{/s}}{{/v}}
                    {{#s}}S{{#m}}, {{/m}}{{/s}}
                    {{#m}}M {{#material}}({{material}}){{/material}}{{/m}}
                <span>
            </div>
            {{#duration}}
            <div class="row">
                <span class="bold">Duration: </span><span>{{#concentration}}Concentration {{/concentration}}{{duration}}<span>
            </div>
            {{/duration}}
            <div class="spacer"></div>
            {{#description}}
            <div class="row">
                <span class="description">{{description}}<span>
            </div>
            {{/description}}
            {{#athigherlevels}}
            <div class="row">
                <span class="bold italics">At Higher Levels. </span><span class="description">{{athigherlevels}}<span>
            </div>
            {{/athigherlevels}}
        </div>
    </rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-npc">
		<div class="row header">
	        <span>{{rname}}</span>
	    </div>
	    <div class="row subheader">
	        <span class="italics">{{name}}</span>
	    </div>
		<div class="arrow-right"></div>
		<div class="row">
			{{#normal}}
				<span class="italics">{{rname}}: </span><span>{{r1}}</span>
			{{/normal}}
			{{#always}}
				<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
			{{/always}}
			{{#advantage}}
				{{#rollLess() r1 r2}}
					<span class="italics">{{rname}}: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollLess() r1 r2}}
				{{#rollTotal() r1 r2}}
					<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollTotal() r1 r2}}
				{{#rollGreater() r1 r2}}
					<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
				{{/rollGreater() r1 r2}}
			{{/advantage}}
			{{#disadvantage}}
				{{#rollLess() r1 r2}}
					<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
				{{/rollLess() r1 r2}}
				{{#rollTotal() r1 r2}}
					<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollTotal() r1 r2}}
				{{#rollGreater() r1 r2}}
					<span class="italics">{{rname}}: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollGreater() r1 r2}}
			{{/disadvantage}}
		</div>
	</rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-npcatk">
    	<div class="row header">
            {{#normal}}
                {{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}
                {{#^rollWasCrit() r1}}{{rname}}{{/^rollWasCrit() r1}}
            {{/normal}}
            {{#always}}
                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}{{rnamec}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}{{rname}}{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
            {{/always}}
            {{#advantage}}
                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}{{rnamec}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}{{rname}}{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
            {{/advantage}}
            {{#disadvantage}}
                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}{{rnamec}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollTotal() r1 r2}}{{#^rollWasCrit() r1}}{{rname}}{{/^rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollLess() r1 r2}}{{rname}}{{/rollLess() r1 r2}}
                {{#rollGreater() r1 r2}}{{rnamec}}{{/rollGreater() r1 r2}}
            {{/disadvantage}}
	    </div>
	    <div class="row subheader">
	        <span class="italics">{{name}}</span>
	    </div>
		<div class="arrow-right"></div>
		<div class="row">
            {{#normal}}
                {{#rollWasCrit() r1}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r1}}
                {{#^rollWasCrit() r1}}<span class="italics">{{rname}}: </span>{{/^rollWasCrit() r1}}
            {{/normal}}
            {{#always}}
                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span class="italics">{{rname}}: </span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
            {{/always}}
            {{#advantage}}
                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span class="italics">{{rname}}: </span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
            {{/advantage}}
            {{#disadvantage}}
                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="italics">{{rnamec}}: </span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollTotal() r1 r2}}{{#^rollWasCrit() r1}}<span class="italics">{{rname}}: </span>{{/^rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                {{#rollLess() r1 r2}}<span class="italics">{{rname}}: </span>{{/rollLess() r1 r2}}
                {{#rollGreater() r1 r2}}<span class="italics">{{rnamec}}: </span>{{/rollGreater() r1 r2}}
            {{/disadvantage}}
			{{#normal}}
				<span>{{r1}}</span>
			{{/normal}}
			{{#always}}
				<span>{{r1}}</span><span> | </span><span>{{r2}}</span>
			{{/always}}
			{{#advantage}}
				{{#rollLess() r1 r2}}
					<span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollLess() r1 r2}}
				{{#rollTotal() r1 r2}}
					<span>{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollTotal() r1 r2}}
				{{#rollGreater() r1 r2}}
					<span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
				{{/rollGreater() r1 r2}}
			{{/advantage}}
			{{#disadvantage}}
				{{#rollLess() r1 r2}}
					<span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
				{{/rollLess() r1 r2}}
				{{#rollTotal() r1 r2}}
					<span>{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollTotal() r1 r2}}
				{{#rollGreater() r1 r2}}
					<span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
				{{/rollGreater() r1 r2}}
			{{/disadvantage}}
		</div>
        {{#description}}
            <div class="row">
                <span class="desc">{{description}}</span>
            </div>
    	{{/description}}
	</rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-npcdmg">    
        <div class="container dmgcontainer damagetemplate">
            <span class="italics">Damage: </span>
            <span>
                {{#dmg1flag}}
                    {{dmg1}}{{#crit}} + {{crit1}}{{/crit}}{{dmg1type}}
                {{/dmg1flag}}
                {{#dmg1flag}}{{#dmg2flag}}+{{/dmg2flag}}{{/dmg1flag}}
                {{#dmg2flag}}
                    {{dmg2}}{{#crit}} + {{crit2}}{{/crit}}{{dmg2type}}
                {{/dmg2flag}}
            </span>
        </div>
    </rolltemplate> 
    
    <rolltemplate class="sheet-rolltemplate-npcaction">
        <div class="container">
	        <div class="row header">
		        <span>{{rname}}</span>
		    </div>
		    <div class="row subheader">
		        <span class="italics">{{name}}</span>
		    </div>
			<div class="arrow-right"></div>
			{{#attack}}
				<div class="row">
					{{#normal}}
						<span class="italics">Attack: </span><span>{{r1}}</span>
					{{/normal}}
					{{#always}}
						<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
					{{/always}}
					{{#advantage}}
						{{#rollLess() r1 r2}}
							<span class="italics">{{rname}}: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
						{{/rollLess() r1 r2}}
						{{#rollTotal() r1 r2}}
							<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
						{{/rollTotal() r1 r2}}
						{{#rollGreater() r1 r2}}
							<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
						{{/rollGreater() r1 r2}}
					{{/advantage}}
					{{#disadvantage}}
						{{#rollLess() r1 r2}}
							<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span class="grey">{{r2}}</span>
						{{/rollLess() r1 r2}}
						{{#rollTotal() r1 r2}}
							<span class="italics">{{rname}}: </span><span>{{r1}}</span><span> | </span><span>{{r2}}</span>
						{{/rollTotal() r1 r2}}
						{{#rollGreater() r1 r2}}
							<span class="italics">{{rname}}: </span><span class="grey">{{r1}}</span><span> | </span><span>{{r2}}</span>
						{{/rollGreater() r1 r2}}
					{{/disadvantage}}
				</div>
			{{/attack}}
			{{#description}}
				<span class="desc">{{description}}</span>
			{{/description}}
			</div>
        	{{#damage}}
				<div class="container dmgcontainer damagetemplate">
					<span class="italics">Damage: </span>
                    <span>
                        {{#dmg1flag}}
                            {{dmg1}} 
                            {{#normal}}
    					        {{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}
					        {{/normal}}
                            {{#always}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/always}}
                            {{#advantage}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/advantage}}
                            {{#disadvantage}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                            {{/disadvantage}}
                            {{dmg1type}}
                        {{/dmg1flag}}
                        {{#dmg1flag}}{{#dmg2flag}}+{{/dmg2flag}}{{/dmg1flag}}
                        {{#dmg2flag}}
                            {{dmg2}} 
                            {{#normal}}
                                {{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}
                            {{/normal}}
                            {{#always}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/always}}
                            {{#advantage}}
                                {{#rollLess() r1 r2}}{{#rollWasCrit() r2}} + {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                            {{/advantage}}
                            {{#disadvantage}}
                                {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}} + {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                            {{/disadvantage}}
                            {{dmg2type}}
                        {{/dmg2flag}}
                    </span>
				</div>
			{{/damage}}
	</rolltemplate>

</div>

<!-- WORKERS -->
<script type="text/worker">

    on("sheet:opened", function() {
        versioning();
    });

    on("change:npc", function() {
        getAttrs(["npc"], function(v) {
            if(v.npc && v.npc === "1") {
                setAttrs({
                    npc_toggle: 1
                });
            }
            else {
                setAttrs({
                    npc_toggle: 0
                });
            };
        });
    });

    on("change:class change:cust_classname change:cust_hitdietype change:cust_spellcasting_ability change:cust_spellslots change:cust_strength_save_prof change:cust_dexterity_save_prof change:cust_constitution_save_prof change:cust_intelligence_save_prof change:cust_wisdom_save_prof change:cust_charisma_save_prof", function() {
        updateClass();
    });
    
    on("change:custom_class", function() {
        getAttrs(["custom_class"], function(v) {
            if(v.custom_class && v.custom_class === "1") {
                setAttrs({
                    customclass_flag: 1
                });
            }
            else {
                setAttrs({
                    customclass_flag: 0
                });
            };
        });
        updateClass();
    });
        
    on("change:base_level change:multiclass1 change:multiclass1_lvl change:multiclass2 change:multiclass2_lvl change:multiclass3 change:multiclass3_lvl change:arcane_fighter change:arcane_rogue", function() {
        setlevel();
    });
    
    on("change:multiclass1_flag", function() {
        setlevel();
        getAttrs(["multiclass1_flag"], function(v) {
            if(v.multiclass1_flag && v.multiclass1_flag === "1") {
                setAttrs({
                    mutliclass1_showingflag: 1
                });
            }
            else {
                setAttrs({
                    mutliclass1_showingflag: 0
                });
            };
        });
    });
    
    on("change:multiclass2_flag", function() {
        setlevel();
        getAttrs(["multiclass2_flag"], function(v) {
            if(v.multiclass2_flag && v.multiclass2_flag === "1") {
                setAttrs({
                    mutliclass2_showingflag: 1
                });
            }
            else {
                setAttrs({
                    mutliclass2_showingflag: 0
                });
            };
        });
    });
    
    on("change:multiclass3_flag", function() {
        setlevel();
        getAttrs(["multiclass3_flag"], function(v) {
            if(v.multiclass3_flag && v.multiclass3_flag === "1") {
                setAttrs({
                    mutliclass3_showingflag: 1
                });
            }
            else {
                setAttrs({
                    mutliclass3_showingflag: 0
                });
            };
        });
    });
    
    on("change:repeating_tool:toolname_base change:repeating_tool:toolbonus_base change:repeating_tool:toolattr_base", function() {
        updateTool();
    });
    
    on("change:repeating_attack:atkflag change:repeating_attack:atkname_base change:repeating_attack:atkattr_base change:repeating_attack:atkmod change:repeating_attack:atkmagic change:repeating_attack:atkprofflag change:repeating_attack:dmgflag change:repeating_attack:dmgbase change:repeating_attack:dmgattr change:repeating_attack:dmgmod change:repeating_attack:dmgtype change:repeating_attack:dmg2flag change:repeating_attack:dmg2base change:repeating_attack:dmg2attr change:repeating_attack:dmg2mod change:repeating_attack:dmg2type change:repeating_attack:saveflag change:repeating_attack:savedc change:repeating_attack:updateflag change:repeating_attack:dmgcustcrit change:repeating_attack:dmg2custcrit", function() {
        updateAttack();
    });
    
    on("change:dtype", function() {
        getAttrs(["dtype"], function(v) {
            setAttrs({
                dflag: v.dtype
            });
            var updatepickbase = v.dtype;
            getSectionIDs("repeating_attack", function(idarray) {
                _.each(idarray, function(currentID) {
                    getAttrs(["repeating_attack_" + currentID + "_atkflag", "repeating_attack_" + currentID + "_dmgflag"], function(v) {
                        update = {};
                        if(updatepickbase === "full") {
                            update["repeating_attack_" + currentID + "_hidden_pickbase"] = "full";
                        }
                        else {
                            if(!v["repeating_attack_" + currentID + "_atkflag"] || v["repeating_attack_" + currentID + "_atkflag"] != 0) {
                                update["repeating_attack_" + currentID + "_hidden_pickbase"] = "pick";
                            }
                            else if(!v["repeating_attack_" + currentID + "_dmgflag"] || v["repeating_attack_" + currentID + "_dmgflag"] != 0) {
                                update["repeating_attack_" + currentID + "_hidden_pickbase"] = "dmg";
                            }
                            else {
                                update["repeating_attack_" + currentID + "_hidden_pickbase"] = "empty";
                            }
                        }
                        setAttrs(update);
                    });
                });
            });
        });
    });
    
    on("change:repeating_spell-cantrip:spellname_base change:repeating_spell-1:spellname_base change:repeating_spell-1:spellprepared change:repeating_spell-2:spellname_base change:repeating_spell-2:spellprepared change:repeating_spell-3:spellname_base change:repeating_spell-3:spellprepared change:repeating_spell-4:spellname_base change:repeating_spell-4:spellprepared change:repeating_spell-5:spellname_base change:repeating_spell-5:spellprepared change:repeating_spell-6:spellname_base change:repeating_spell-6:spellprepared change:repeating_spell-7:spellname_base change:repeating_spell-7:spellprepared change:repeating_spell-8:spellname_base change:repeating_spell-8:spellprepared change:repeating_spell-9:spellname_base change:repeating_spell-9:spellprepared change:repeating_spell-cantrip:spellrange change:repeating_spell-1:spellrange change:repeating_spell-2:spellrange change:repeating_spell-3:spellrange change:repeating_spell-4:spellrange change:repeating_spell-5:spellrange change:repeating_spell-6:spellrange change:repeating_spell-7:spellrange change:repeating_spell-8:spellrange change:repeating_spell-9:spellrange change:repeating_spell-cantrip:spelltarget change:repeating_spell-1:spelltarget change:repeating_spell-2:spelltarget change:repeating_spell-3:spelltarget change:repeating_spell-4:spelltarget change:repeating_spell-5:spelltarget change:repeating_spell-6:spelltarget change:repeating_spell-7:spelltarget change:repeating_spell-8:spelltarget change:repeating_spell-9:spelltarget change:repeating_spell-cantrip:spelldamage change:repeating_spell-1:spelldamage change:repeating_spell-2:spelldamage change:repeating_spell-3:spelldamage change:repeating_spell-4:spelldamage change:repeating_spell-5:spelldamage change:repeating_spell-6:spelldamage change:repeating_spell-7:spelldamage change:repeating_spell-8:spelldamage change:repeating_spell-9:spelldamage change:repeating_spell-cantrip:spelldamagetype change:repeating_spell-1:spelldamagetype change:repeating_spell-2:spelldamagetype change:repeating_spell-3:spelldamagetype change:repeating_spell-4:spelldamagetype change:repeating_spell-5:spelldamagetype change:repeating_spell-6:spelldamagetype change:repeating_spell-7:spelldamagetype change:repeating_spell-8:spelldamagetype change:repeating_spell-9:spelldamagetype change:repeating_spell-cantrip:spelldamage2 change:repeating_spell-1:spelldamage2 change:repeating_spell-2:spelldamage2 change:repeating_spell-3:spelldamage2 change:repeating_spell-4:spelldamage2 change:repeating_spell-5:spelldamage2 change:repeating_spell-6:spelldamage2 change:repeating_spell-7:spelldamage2 change:repeating_spell-8:spelldamage2 change:repeating_spell-9:spelldamage2 change:repeating_spell-cantrip:spelldamagetype2 change:repeating_spell-1:spelldamagetype2 change:repeating_spell-2:spelldamagetype2 change:repeating_spell-3:spelldamagetype2 change:repeating_spell-4:spelldamagetype2 change:repeating_spell-5:spelldamagetype2 change:repeating_spell-6:spelldamagetype2 change:repeating_spell-7:spelldamagetype2 change:repeating_spell-8:spelldamagetype2 change:repeating_spell-9:spelldamagetype2 change:repeating_spell-cantrip:spellhealing change:repeating_spell-1:spellhealing change:repeating_spell-2:spellhealing change:repeating_spell-3:spellhealing change:repeating_spell-4:spellhealing change:repeating_spell-5:spellhealing change:repeating_spell-6:spellhealing change:repeating_spell-7:spellhealing change:repeating_spell-8:spellhealing change:repeating_spell-9:spellhealing change:repeating_spell-cantrip:spelldmgmod change:repeating_spell-1:spelldmgmod change:repeating_spell-2:spelldmgmod change:repeating_spell-3:spelldmgmod change:repeating_spell-4:spelldmgmod change:repeating_spell-5:spelldmgmod change:repeating_spell-6:spelldmgmod change:repeating_spell-7:spelldmgmod change:repeating_spell-8:spelldmgmod change:repeating_spell-9:spelldmgmod change:repeating_spell-cantrip:spellsave change:repeating_spell-1:spellsave change:repeating_spell-2:spellsave change:repeating_spell-3:spellsave change:repeating_spell-4:spellsave change:repeating_spell-5:spellsave change:repeating_spell-6:spellsave change:repeating_spell-7:spellsave change:repeating_spell-8:spellsave change:repeating_spell-9:spellsave change:repeating_spell-cantrip:spellsavesuccess change:repeating_spell-1:spellsavesuccess change:repeating_spell-2:spellsavesuccess change:repeating_spell-3:spellsavesuccess change:repeating_spell-4:spellsavesuccess change:repeating_spell-5:spellsavesuccess change:repeating_spell-6:spellsavesuccess change:repeating_spell-7:spellsavesuccess change:repeating_spell-8:spellsavesuccess change:repeating_spell-9:spellsavesuccess change:repeating_spell-cantrip:spellhldie change:repeating_spell-1:spellhldie change:repeating_spell-2:spellhldie change:repeating_spell-3:spellhldie change:repeating_spell-4:spellhldie change:repeating_spell-5:spellhldie change:repeating_spell-6:spellhldie change:repeating_spell-7:spellhldie change:repeating_spell-8:spellhldie change:repeating_spell-9:spellhldie change:repeating_spell-cantrip:spellhldietype change:repeating_spell-1:spellhldietype change:repeating_spell-2:spellhldietype change:repeating_spell-3:spellhldietype change:repeating_spell-4:spellhldietype change:repeating_spell-5:spellhldietype change:repeating_spell-6:spellhldietype change:repeating_spell-7:spellhldietype change:repeating_spell-8:spellhldietype change:repeating_spell-9:spellhldietype change:repeating_spell-cantrip:spell_updateflag change:repeating_spell-1:spell_updateflag change:repeating_spell-2:spell_updateflag change:repeating_spell-3:spell_updateflag change:repeating_spell-4:spell_updateflag change:repeating_spell-5:spell_updateflag change:repeating_spell-6:spell_updateflag change:repeating_spell-7:spell_updateflag change:repeating_spell-8:spell_updateflag change:repeating_spell-9:spell_updateflag change:repeating_spell-cantrip:spellattack change:repeating_spell-1:spellattack change:repeating_spell-2:spellattack change:repeating_spell-3:spellattack change:repeating_spell-4:spellattack change:repeating_spell-5:spellattack change:repeating_spell-6:spellattack change:repeating_spell-7:spellattack change:repeating_spell-8:spellattack change:repeating_spell-9:spellattack", function() {
        updateSpell();
    });
    
    on("change:npc_name change:npc_type change:npc_ac change:npc_actype change:hp_max change:npc_hpformula change:npc_speed change:strength change:dexterity change:constitution change:intelligence change:wisdom change:charisma change:npc_str_save change:npc_dex_save change:npc_con_save change:npc_int_save change:npc_wis_save change:npc_cha_save change:npc_acrobatics change:npc_animal_handling change:npc_arcana change:npc_athletics change:npc_deception change:npc_history change:npc_insight change:npc_intimidation change:npc_investigation change:npc_medicine change:npc_nature change:npc_perception change:npc_performance change:npc_persuasion change:npc_religion change:npc_sleight_of_hand change:npc_stealth change:npc_survival change:npc_vulnerabilities change:npc_resistances change:npc_immunities change:npc_condition_immunities change:npc_senses change:npc_languages change:npc_challenge change:npc_xp change:npc_legendary_actions", function() {
        updateNPC();
    });

    on("change:repeating_spell-cantrip:spellritualflag change:repeating_spell-1:spellritualflag change:repeating_spell-2:spellritualflag change:repeating_spell-3:spellritualflag change:repeating_spell-4:spellritualflag change:repeating_spell-5:spellritualflag change:repeating_spell-6:spellritualflag change:repeating_spell-7:spellritualflag change:repeating_spell-8:spellritualflag change:repeating_spell-9:spellritualflag", function() {
        getAttrs(["repeating_spell_spellritualflag"], function(v) {
            flag = v.repeating_spell_spellritualflag === "Yes" ? "{{ritual=1}}" : "0";
            setAttrs({
                repeating_spell_spellritual: flag
            });
        });
    });

    on("change:repeating_spell-cantrip:spellconcentrationflag change:repeating_spell-1:spellconcentrationflag change:repeating_spell-2:spellconcentrationflag change:repeating_spell-3:spellconcentrationflag change:repeating_spell-4:spellconcentrationflag change:repeating_spell-5:spellconcentrationflag change:repeating_spell-6:spellconcentrationflag change:repeating_spell-7:spellconcentrationflag change:repeating_spell-8:spellconcentrationflag change:repeating_spell-9:spellconcentrationflag", function() {
        getAttrs(["repeating_spell_spellconcentrationflag"], function(v) {
            flag = v.repeating_spell_spellconcentrationflag === "Yes" ? "{{concentration=1}}" : "0";
            setAttrs({
                repeating_spell_spellconcentration: flag
            });
        });
    });
    
    on("change:repeating_spell-cantrip:spellcomp change:repeating_spell-1:spellcomp change:repeating_spell-2:spellcomp change:repeating_spell-3:spellcomp change:repeating_spell-4:spellcomp change:repeating_spell-5:spellcomp change:repeating_spell-6:spellcomp change:repeating_spell-7:spellcomp change:repeating_spell-8:spellcomp change:repeating_spell-9:spellcomp", function() {
        getAttrs(["repeating_spell_spellcomp"], function(v) {
            spellv = v.repeating_spell_spellcomp.indexOf("V") > -1 ? "{{v=1}}" : "0"
            spells = v.repeating_spell_spellcomp.indexOf("S") > -1 ? "{{s=1}}" : "0"
            spellm = v.repeating_spell_spellcomp.indexOf("M") > -1 ? "{{m=1}}" : "0"
            setAttrs({
                repeating_spell_spellcomp_v: spellv,
                repeating_spell_spellcomp_s: spells,
                repeating_spell_spellcomp_m: spellm
            });
        });
    });

    on("change:repeating_spell-cantrip:spellcontent change:repeating_spell-1:spellcontent change:repeating_spell-2:spellcontent change:repeating_spell-3:spellcontent change:repeating_spell-4:spellcontent change:repeating_spell-5:spellcontent change:repeating_spell-6:spellcontent change:repeating_spell-7:spellcontent change:repeating_spell-8:spellcontent change:repeating_spell-9:spellcontent", function() {
        getAttrs(["repeating_spell_spellcontent"], function(v) {
            content = v.repeating_spell_spellcontent.split("At Higher Levels:");
            if(content.length > 1) {
                spelldesc = content[0].trim();
                spellhigherlvl = content[1].trim();
            }
            else {
                spelldesc = v.repeating_spell_spellcontent;
                spellhigherlvl = "";
            }
            setAttrs({
                repeating_spell_spelldescription: spelldesc,
                repeating_spell_spellathigherlevels: spellhigherlvl
            });
        });
    });

    // on("change:repeating_spell-cantrip:spellhealing change:repeating_spell-1:spellhealing change:repeating_spell-2:spellhealing change:repeating_spell-3:spellhealing change:repeating_spell-4:spellhealing change:repeating_spell-5:spellhealing change:repeating_spell-6:spellhealing change:repeating_spell-7:spellhealing change:repeating_spell-8:spellhealing change:repeating_spell-9:spellhealing", function() {
    //     getAttrs(["repeating_spell_spellhealing","repeating_spell_spelldamage","repeating_spell_spelldamage2","repeating_spell_spelldmgmod"], function(v) {
    //         if(v.repeating_spell_spellhealing && v.repeating_spell_spellhealing != "") {
    //             update = {};
    //             // castingbonus = v.repeating_spell_spelldmgmod && v.repeating_spell_spelldmgmod === "Yes" ? " + @{spellcasting_ability}" : "";
    //             if(!v.repeating_spell_spelldamage || v.repeating_spell_spelldamage === "") {
    //                 update["repeating_spell_spelldamage"] = v.repeating_spell_spellhealing;
    //             }
    //             else if(!v.repeating_spell_spelldamage2 || v.repeating_spell_spelldamage2 === "") {
    //                 update["repeating_spell_spelldamage2"] = v.repeating_spell_spellhealing;
    //             }
    //             update["repeating_spell_spellhealing"] = "";
    //             setAttrs(update);
    //         }
    //     });
    // });

    on("change:repeating_spell-cantrip:spelloutput change:repeating_spell-1:spelloutput change:repeating_spell-2:spelloutput change:repeating_spell-3:spelloutput change:repeating_spell-4:spelloutput change:repeating_spell-5:spelloutput change:repeating_spell-6:spelloutput change:repeating_spell-7:spelloutput change:repeating_spell-8:spelloutput change:repeating_spell-9:spelloutput", function() {
        getAttrs(["repeating_spell_spellattackid","repeating_spell_spelloutput","character_name","repeating_spell_pickbase"], function(v) {
            if(v.repeating_spell_spelloutput === "ATTACK") {
                setAttrs({repeating_spell_spellattackinfoflag:"show"});
                if(!v.repeating_spell_spellattackid) {
                    addspellattack();
                } 
                else {
                    getSectionIDs("repeating_attack", function(idarray) {
                        var existingid = _.find(idarray, function(thisid) { 
                            return (thisid.toLowerCase() === v.repeating_spell_spellattackid.toLowerCase() ) 
                        });
                        if(!existingid) {
                            addspellattack();
                        }
                        else {
                            getAttrs(["repeating_attack_" + v.repeating_spell_spellattackid + "_hidden_pickbase"], function(x) {
                                pbase = x["repeating_attack_" + v.repeating_spell_spellattackid + "_hidden_pickbase"];
                                setAttrs({
                                    repeating_spell_rollcontent: "%{" + v.character_name + "|repeating_attack_" + v.repeating_spell_spellattackid + "_attack_" + pbase + "}"
                                });
                            });
                        }
                    });
                };
                
            }
            else {
                setAttrs({
                    repeating_spell_rollcontent: "@{wtype}&{template:spell} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname_base}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} @{spellritual} @{spellconcentration}",
                    repeating_spell_spellattackinfoflag: "hide"
                });
            }
        });
    });

    on("change:repeating_spell-cantrip:spelldamage change:repeating_spell-1:spelldamage change:repeating_spell-2:spelldamage change:repeating_spell-3:spelldamage change:repeating_spell-4:spelldamage change:repeating_spell-5:spelldamage change:repeating_spell-6:spelldamage change:repeating_spell-7:spelldamage change:repeating_spell-8:spelldamage change:repeating_spell-9:spelldamage change:repeating_spell-cantrip:spellhealing change:repeating_spell-1:spellhealing change:repeating_spell-2:spellhealing change:repeating_spell-3:spellhealing change:repeating_spell-4:spellhealing change:repeating_spell-5:spellhealing change:repeating_spell-6:spellhealing change:repeating_spell-7:spellhealing change:repeating_spell-8:spellhealing change:repeating_spell-9:spellhealing", function() {
        getAttrs(["repeating_spell_spelldamage","repeating_spell_spellhealing"], function(v) {
            if((v.repeating_spell_spelldamage && v.repeating_spell_spelldamage != "") || (v.repeating_spell_spellhealing && v.repeating_spell_spellhealing != "")) {
                setAttrs({
                    repeating_spell_spelloutput: "ATTACK"
                });
            }
        });
    });

    // on("change:repeating_spell-cantrip:spelldmgmod change:repeating_spell-1:spelldmgmod change:repeating_spell-2:spelldmgmod change:repeating_spell-3:spelldmgmod change:repeating_spell-4:spelldmgmod change:repeating_spell-5:spelldmgmod change:repeating_spell-6:spelldmgmod change:repeating_spell-7:spelldmgmod change:repeating_spell-8:spelldmgmod change:repeating_spell-9:spelldmgmod", function() {
    //     getAttrs(["repeating_spell_spelldmgmod","repeating_spell_spelldamage","repeating_spell_spelldamage2","repeating_spell_spellhealing"], function(v) {
    //         if(v.repeating_spell_spelldmgmod && v.repeating_spell_spelldmgmod != "" && (!v.repeating_spell_spellhealing) || v.repeating_spell_spellhealing ==="") {
    //             update = {};
    //             castingbonus = v.repeating_spell_spelldmgmod && v.repeating_spell_spelldmgmod === "Yes" ? " + @{spellcasting_ability}" : ""
    //             if(v.repeating_spell_spelldamage && v.repeating_spell_spelldamage != "") {
    //                 update["repeating_spell_spelldamage"] = v.repeating_spell_spelldamage + castingbonus;
    //             }
    //             else if(v.repeating_spell_spelldamage2 && v.repeating_spell_spelldamage2 != "") {
    //                 update["repeating_spell_spelldamage2"] = v.repeating_spell_spelldamage2 + castingbonus;
    //             }
    //             setAttrs(update);
    //         }
    //     });
    // });

    on("change:repeating_attack:hidden_pickbase", function(eventinfo) {
        getAttrs(["repeating_attack_hidden_pickbase"], function(x) {
            getSectionIDs("repeating_spell", function(idarray) {
                attackid = eventinfo.sourceAttribute.substring(17, 37);
                _.each(idarray, function(currentID) {
                    getAttrs(["repeating_spell-cantrip_" + currentID + "_spelloutput","repeating_spell-cantrip_" + currentID + "_spellattackid","repeating_spell-1_" + currentID + "_spelloutput","repeating_spell-1_" + currentID + "_spellattackid","repeating_spell-2_" + currentID + "_spelloutput","repeating_spell-2_" + currentID + "_spellattackid","repeating_spell-3_" + currentID + "_spelloutput","repeating_spell-3_" + currentID + "_spellattackid","repeating_spell-4_" + currentID + "_spelloutput","repeating_spell-4_" + currentID + "_spellattackid","repeating_spell-5_" + currentID + "_spelloutput","repeating_spell-5_" + currentID + "_spellattackid","repeating_spell-6_" + currentID + "_spelloutput","repeating_spell-6_" + currentID + "_spellattackid","repeating_spell-7_" + currentID + "_spelloutput","repeating_spell-7_" + currentID + "_spellattackid","repeating_spell-8_" + currentID + "_spelloutput","repeating_spell-8_" + currentID + "_spellattackid","repeating_spell-9_" + currentID + "_spelloutput","repeating_spell-9_" + currentID + "_spellattackid","character_name"], function(v) {
                        lvl = Object.keys(v)[0].match(/repeating_spell-(.*?)-/);
                        if(lvl && v["repeating_spell-" + lvl[1] + currentID + "_spellattackid"] && v["repeating_spell-" + lvl[1] + currentID + "_spellattackid"].toLowerCase() === attackid && v["repeating_spell-" + lvl[1] + currentID + "_spelloutput"] === "ATTACK") {
                            update = {};
                            update["repeating_spell-" + lvl[1] + currentID + "_rollcontent"] = "%{" + v.character_name + "|repeating_attack_" + attackid + "_attack_" + x.repeating_attack_hidden_pickbase + "}";
                            setAttrs(update);
                        }
                    });
                });
            });
        })

    });

    on("change:repeating_npcaction:name change:repeating_npcaction:attack_flag change:repeating_npcaction:attack_type change:repeating_npcaction:attack_range change:repeating_npcaction:attack_target change:repeating_npcaction:attack_tohit change:repeating_npcaction:attack_damage change:repeating_npcaction:attack_damagetype change:repeating_npcaction:attack_damage2 change:repeating_npcaction:attack_damagetype2 change:repeating_npcaction:description change:repeating_npcaction-l:name change:repeating_npcaction-l:attack_flag change:repeating_npcaction-l:attack_type change:repeating_npcaction-l:attack_range change:repeating_npcaction-l:attack_target change:repeating_npcaction-l:attack_tohit change:repeating_npcaction-l:attack_damage change:repeating_npcaction-l:attack_damagetype change:repeating_npcaction-l:attack_damage2 change:repeating_npcaction-l:attack_damagetype2 change:repeating_npcaction-l:description", function() {
        updateNPCaction();
    });

    on("change:npc_challenge", function() {
        getAttrs(["npc_challenge"], function(v) {
            var xp = 0;
            switch(v.npc_challenge) {
                case "0":
                    xp = "10";
                    break;
                case "1/8":
                    xp = "25";
                    break;
                case "1/4":
                    xp = "50";
                    break;
                case "1/2":
                    xp = "100";
                    break;
                case "1":
                    xp = "200";
                    break;
                case "2":
                    xp = "450";
                    break;
                case "3":
                    xp = "700";
                    break;
                case "4":
                    xp = "1,100";
                    break;
                case "5":
                    xp = "1,800";
                    break;
                case "6":
                    xp = "2,300";
                    break;
                case "7":
                    xp = "2,900";
                    break;
                case "8":
                    xp = "3,900";
                    break;
                case "9":
                    xp = "5,000";
                    break;
                case "10":
                    xp = "5,900";
                    break;
                case "11":
                    xp = "7,200";
                    break;
                case "12":
                    xp = "8,400";
                    break;
                case "13":
                    xp = "10,000";
                    break;
                case "14":
                    xp = "11,500";
                    break;
                case "15":
                    xp = "13,000";
                    break;
                case "16":
                    xp = "15,000";
                    break;
                case "17":
                    xp = "18,000";
                    break;
                case "18":
                    xp = "20,000";
                    break;
                case "19":
                    xp = "22,000";
                    break;
                case "20":
                    xp = "25,000";
                    break;
                case "21":
                    xp = "33,000";
                    break;
                case "22":
                    xp = "41,000";
                    break;
                case "23":
                    xp = "50,000";
                    break;
                case "24":
                    xp = "62,000";
                    break;
                case "30":
                    xp = "155,000";
                    break;
            }
            setAttrs({npc_xp: xp + " XP"});
        });
    });

    on("change:simpleinventory", function() {
        getAttrs(["simpleinventory"], function(v) {
            setAttrs({
               inventoryflag: v.simpleinventory
            });
        });
    });

    on("change:repeating_inventory:itemweight change:repeating_inventory:itemcount change:cp change:sp change:ep change:gp change:pp", function() {
        updateitemweight();
    });

    on("change:repeating_inventory:itemtype", function(eventinfo) {
        id = eventinfo.sourceAttribute.substring(20, 40);
        getAttrs(["repeating_inventory_itemtype","repeating_inventory_itemname"], function(v) {
            if(v.repeating_inventory_itemtype) {
                updateglobalsave();
                if(v.repeating_inventory_itemtype.indexOf("Weapon") > -1) {
                    existingattacks = [];
                    getSectionIDs("repeating_attack", function(idarray) {
                        if(idarray.length > 0) {
                            _.each(idarray, function(currentID, i) {
                                getAttrs(["repeating_attack_" + currentID + "_atkname_base"], function(x) {
                                    if(v["repeating_attack_" + currentID + "_atkname_base"] && v["repeating_attack_" + currentID + "_atkname_base"] != "") {
                                        existingattacks.push(x["repeating_attack_" + currentID + "_atkname_base"].toLowerCase());
                                    }
                                    if(i === idarray.length - 1 && v.repeating_inventory_itemname) {
                                        if(existingattacks.indexOf(v.repeating_inventory_itemname.toLowerCase()) === -1) {
                                            additemattack(id);
                                        }
                                    }
                                });
                            })
                        }
                        else {
                            additemattack(id);
                        }
                    });
                }
                else {
                    updateac();
                }
            }
            else {
                updateac();
                updateitemweight();
                updateglobalsave();
            }
        });
    });

    on("remove:repeating_spell-cantrip remove:repeating_spell-1 remove:repeating_spell-2 remove:repeating_spell-3 remove:repeating_spell-4 remove:repeating_spell-5 remove:repeating_spell-6 remove:repeating_spell-7 remove:repeating_spell-8 remove:repeating_spell-9", function(eventinfo) {
        // console.log(eventinfo);
        // id = eventinfo.sourceAttribute.substring(18, 38);
        // console.log(id);
        // getSectionIDs("repeating_attack", function(idarray) {
        //     _.each(idarray, function(currentID, i) {
        //         getAttrs(["repeating_attack_" + currentID + "_itemid"], function(v) {
        //             console.log(currentID);
        //             console.log(v["repeating_attack_" + currentID + "_itemid"]);
        //             console.log(id.toLowerCase());
        //             console.log(v["repeating_attack_" + currentID + "_itemid"] === id.toLowerCase());
        //             if(v["repeating_attack_" + currentID + "_itemid"] === id.toLowerCase()) {
        //                 removeRepeatingRow("repeating_attack_" + currentID);
        //             }
        //         });
        //     });
        // });
    });

    on("remove:repeating_inventory", function(eventinfo) {
        // id = eventinfo.sourceAttribute.substring(20, 40);
        // getSectionIDs("repeating_attack", function(idarray) {
        //     _.each(idarray, function(currentID, i) {
        //         getAttrs(["repeating_attack_" + currentID + "_itemid"], function(v) {
        //             console.log(currentID);
        //             console.log(v["repeating_attack_" + currentID + "_itemid"]);
        //             console.log(id.toLowerCase());
        //             console.log(v["repeating_attack_" + currentID + "_itemid"] === id.toLowerCase());
        //             if(v["repeating_attack_" + currentID + "_itemid"] === id.toLowerCase()) {
        //                 removeRepeatingRow("repeating_attack_" + currentID);
        //             }
        //         });
        //     });
        // });
        updateac();
        updateitemweight();
        updateglobalsave();
    });

    on("change:dexterity", function() {
        updateac();
    });

    on("change:armorwarning", function() {
        getAttrs(["armorwarning"], function(v) {
            if(v.armorwarning === "hide") {
                setAttrs({armorwarningflag: "0"});
            }
        });
    });

    var npc_exception_actions = ["Web (Recharge 5-6)"];
    on("change:npc_typebase", function() {
        getAttrs(["npc_typebase","npc_sizebase","npc_alignmentbase","npc_acbase","npc_hpbase","npc_savingthrowsbase","npc_sensesbase","npc_passiveperceptionbase","npc_skillsbase","npc_content"], function(v) {
            if(v.npc_typebase && v.npc_typebase != "") {
                update = {};
                update["npc_typebase"] = "";
                update["npc_options-flag"] = "0";
                update["npc_type"] = v.npc_sizebase + " " + v.npc_typebase.toLowerCase() + ", " + v.npc_alignmentbase;
                if(v.npc_acbase.indexOf("(") > -1) {
                    update["npc_ac"] = v.npc_acbase.split(" (")[0];
                    update["npc_actype"] = v.npc_acbase.split(" (")[1].slice(0, -1);
                }
                else {
                    update["npc_ac"] = v.npc_acbase;
                    update["npc_actype"] = "";
                }
                if(v.npc_hpbase.indexOf("(") > -1) {
                    update["hp_max"] = v.npc_hpbase.split(" (")[0];
                    update["npc_hpformula"] = v.npc_hpbase.split(" (")[1].slice(0, -1);
                }
                else {
                    update["hp_max"] = v.npc_hpbase;
                    update["npc_hpformula"] = "";
                }
                update["npc_senses"] = v.npc_sensesbase + ", passive Perception " + v.npc_passiveperceptionbase;
                if(v.npc_savingthrowsbase && v.npc_savingthrowsbase != "") {
                    savearray = v.npc_savingthrowsbase.split(", ");
                    _.each(savearray, function(save) {
                        kv = save.split(" +");
                        update["npc_" + kv[0].toLowerCase() + "_save"] = parseInt(kv[1], 10);
                    });
                }
                if(v.npc_skillsbase && v.npc_skillsbase != "") {
                    skillarray = v.npc_skillsbase.split(", ");
                    _.each(skillarray, function(skill) {
                        kv = skill.split(" +");
                        update["npc_" + kv[0].toLowerCase()] = parseInt(kv[1], 10);
                    });
                }
                var contentarray = v.npc_content;
                if(contentarray && contentarray.indexOf("Legendary Actions") > -1) {
                    temp = contentarray.split(/Legendary Actions\n/)
                    var legendaryactionsarray = temp[1];
                    contentarray = temp[0];
                }
                if(contentarray && contentarray.indexOf("Actions") > -1) {
                    temp = contentarray.split(/Actions\n/)
                    var actionsarray = temp[1];
                    contentarray = temp[0];
                }
                if(contentarray && contentarray.indexOf("Traits") > -1) {
                    temp = contentarray.split(/Traits\n/)
                    var traitsarray = temp[1];
                    contentarray = temp[0];
                }
                if(traitsarray) {
                    traitsarray = traitsarray.split("**");
                    traitsarray.shift();
                    var traitsobj = {};
                    traitsarray.forEach(function(val, i) {
                        if (i % 2 === 1) return;
                        traitsobj[val] = traitsarray[i + 1];
                    });
                    _.each(traitsobj, function(desc, name) {
                        newrowid = generateRowID();
                        update["repeating_npctrait_" + newrowid + "_name"] = name + ".";
                        if(desc.substring(0,2) === ": ") {
                            desc = desc.substring(2);
                        }
                        update["repeating_npctrait_" + newrowid + "_desc"] = desc.trim();
                    });
                }
                if(actionsarray) {
                    actionsarray = actionsarray.split("**");
                    actionsarray.shift();
                    var actionsobj = {};
                    actionsarray.forEach(function(val, i) {
                        if (i % 2 === 1) return;
                        actionsobj[val] = actionsarray[i + 1];
                    });
                    _.each(actionsobj, function(desc, name) {
                        newrowid = generateRowID();
                        update["repeating_npcaction_" + newrowid + "_npc_options-flag"] = "0";
                        update["repeating_npcaction_" + newrowid + "_name"] = name;
                        if(desc.substring(0,2) === ": ") {
                            desc = desc.substring(2);
                        }
                        if(desc.indexOf("Weapon Attack:") > -1) {
                            update["repeating_npcaction_" + newrowid + "_attack_flag"] = "on";
                            update["repeating_npcaction_" + newrowid + "_attack_display_flag"] = "{{attack=1}}";
                            update["repeating_npcaction_" + newrowid + "_attack_options"] = "{{attack=1}}";
                            attacktype = desc.split(" Weapon Attack:")[0];
                            update["repeating_npcaction_" + newrowid + "_attack_type"] = attacktype;
                            if(attacktype === "Melee") {
                                update["repeating_npcaction_" + newrowid + "_attack_range"] = (desc.match(/reach (.*?),/) || ["",""])[1];
                            }
                            else {
                                update["repeating_npcaction_" + newrowid + "_attack_range"] = (desc.match(/range (.*?),/) || ["",""])[1];
                            }
                            update["repeating_npcaction_" + newrowid + "_attack_tohit"] = (desc.match(/\+(.*) to hit/) || ["",""])[1];
                            update["repeating_npcaction_" + newrowid + "_attack_target"] = (desc.match(/\.,(?!.*\.,)(.*)\. Hit:/) || ["",""])[1];
                            if(desc.toLowerCase().indexOf("damage") > -1 && npc_exception_actions.indexOf(name) === -1) {
                                update["repeating_npcaction_" + newrowid + "_attack_damage"] = (desc.match(/\(([^)]+)\)/) || ["",""])[1];
                                update["repeating_npcaction_" + newrowid + "_attack_damagetype"] = (desc.match(/\) (.*?) damage/) || ["",""])[1];
                                if((desc.match(/\(/g) || []).length > 1) {
                                    update["repeating_npcaction_" + newrowid + "_attack_damage2"] = (desc.match(/\((?!.*\()([^)]+)\)/) || ["",""])[1];
                                    update["repeating_npcaction_" + newrowid + "_attack_damagetype2"] = (desc.match(/\)(?!.*\)) (.*?) damage/) || ["",""])[1];
                                }
                                ctest1 = desc.split("damage.")[1];
                                ctest2 = desc.split("damage, ")[1];
                                if(ctest1 && ctest1.length > 0) {
                                    update["repeating_npcaction_" + newrowid + "_description"] = ctest1.trim();
                                }
                                else if(ctest2 && ctest2.length > 0) {
                                    update["repeating_npcaction_" + newrowid + "_description"] = ctest2.trim();
                                }
                            }
                            else {
                                update["repeating_npcaction_" + newrowid + "_description"] = desc.split("Hit:")[1].trim();
                            }
                        }
                        else {
                            update["repeating_npcaction_" + newrowid + "_description"] = desc;
                        }

                    });
                }
                if(legendaryactionsarray) {
                    update["npc_legendary_actions"] = (legendaryactionsarray.match(/\d+/) || [""])[0];
                    legendaryactionsarray = legendaryactionsarray.split("**");
                    legendaryactionsarray.shift();
                    var actionsobj = {};
                    legendaryactionsarray.forEach(function(val, i) {
                        if (i % 2 === 1) return;
                        actionsobj[val] = legendaryactionsarray[i + 1];
                    });
                    _.each(actionsobj, function(desc, name) {
                        newrowid = generateRowID();
                        update["repeating_npcaction-l_" + newrowid + "_npc_options-flag"] = "0";
                        update["repeating_npcaction-l_" + newrowid + "_name"] = name;
                        if(desc.substring(0,2) === ": ") {
                            desc = desc.substring(2);
                        }
                        if(desc.indexOf("Weapon Attack:") > -1) {
                            update["repeating_npcaction-l_" + newrowid + "_attack_flag"] = "on";
                            update["repeating_npcaction-l_" + newrowid + "_attack_display_flag"] = "{{attack=1}}";
                            update["repeating_npcaction-l_" + newrowid + "_attack_options"] = "{{attack=1}}";
                            attacktype = desc.split(" Weapon Attack:")[0];
                            update["repeating_npcaction-l_" + newrowid + "_attack_type"] = attacktype;
                            if(attacktype === "Melee") {
                                update["repeating_npcaction-l_" + newrowid + "_attack_range"] = (desc.match(/reach (.*?),/) || ["",""])[1];
                            }
                            else {
                                update["repeating_npcaction-l_" + newrowid + "_attack_range"] = (desc.match(/range (.*?),/) || ["",""])[1];
                            }
                            update["repeating_npcaction-l_" + newrowid + "_attack_tohit"] = (desc.match(/\+(.*) to hit/) || ["",""])[1];
                            update["repeating_npcaction-l_" + newrowid + "_attack_target"] = (desc.match(/\.,(?!.*\.,)(.*)\. Hit:/) || ["",""])[1];
                            update["repeating_npcaction-l_" + newrowid + "_attack_damage"] = (desc.match(/\(([^)]+)\)/) || ["",""])[1];
                            update["repeating_npcaction-l_" + newrowid + "_attack_damagetype"] = (desc.match(/\) (.*?) damage/) || ["",""])[1];
                            if((desc.match(/\(/g) || []).length > 1) {
                                update["repeating_npcaction-l_" + newrowid + "_attack_damage2"] = (desc.match(/\((?!.*\()([^)]+)\)/) || ["",""])[1];
                                update["repeating_npcaction-l_" + newrowid + "_attack_damagetype2"] = (desc.match(/\)(?!.*\)) (.*?) damage/) || ["",""])[1];
                            }
                        }
                        else {
                            update["repeating_npcaction-l_" + newrowid + "_description"] = desc;
                        }

                    });
                }

                setAttrs(update);
            }
        });
    });

    on("change:spellcasting_ability change:strength change:dexterity change:constitution change:intelligence change:wisdom change:charisma", function() {
        getSectionIDs("repeating_attack", function(idarray) {
            _.each(idarray, function(currentID, i) {
                getAttrs(["repeating_attack_" + currentID + "_updateflag"], function(v) {
                    update = {};
                    toggle = v["repeating_attack_" + currentID + "_updateflag"] === true ? false : true;
                    update["repeating_attack_" + currentID + "_updateflag"] = toggle;
                    setAttrs(update);
                });
            });
        });
    });

    on("change:globalsavemod", function() {
        getAttrs(["globalsavemod"], function(v) {
            bonus = v.globalsavemod && v.globalsavemod != "" ? "+@{globalsavemod}[UNIV]" : "";
            setAttrs({globalsavingthrowbonus: bonus});
        });
    });

    on("change:halflingluck_flag", function() {
        getAttrs(["halflingluck_flag"], function(v) {
            toggle = v.halflingluck_flag && v.halflingluck_flag === "1" ? "ro<1" : "";
            setAttrs({halflingluck: toggle});
        });
    });

    var updateitemweight = function() {
        var wtotal = 0;
        getAttrs(["cp","sp","ep","gp","pp"], function(v) {
            cp = isNaN(parseInt(v.cp, 10)) === false ? parseInt(v.cp, 10) : 0;
            sp = isNaN(parseInt(v.sp, 10)) === false ? parseInt(v.sp, 10) : 0;
            ep = isNaN(parseInt(v.ep, 10)) === false ? parseInt(v.ep, 10) : 0;
            gp = isNaN(parseInt(v.gp, 10)) === false ? parseInt(v.gp, 10) : 0;
            pp = isNaN(parseInt(v.pp, 10)) === false ? parseInt(v.pp, 10) : 0;
            wtotal = wtotal + ((cp + sp + ep + gp + pp) / 50);
            getSectionIDs("repeating_inventory", function(idarray) {
                if(idarray.length > 0) {
                    _.each(idarray, function(currentID, i) {
                        getAttrs(["repeating_inventory_" + currentID + "_itemweight", "repeating_inventory_" + currentID + "_itemcount"], function(v) {
                            if(v["repeating_inventory_" + currentID + "_itemweight"] && isNaN(parseInt(v["repeating_inventory_" + currentID + "_itemweight"], 10)) === false) {
                                count = v["repeating_inventory_" + currentID + "_itemcount"] && isNaN(parseFloat(v["repeating_inventory_" + currentID + "_itemcount"])) === false ? parseFloat(v["repeating_inventory_" + currentID + "_itemcount"]) : 1;
                                wtotal = wtotal + (parseFloat(v["repeating_inventory_" + currentID + "_itemweight"]) * count);
                            }
                            if(i === idarray.length - 1) {
                                setAttrs({weighttotal: wtotal});
                            }
                        });
                    });
                }
                else {
                    setAttrs({weighttotal: wtotal});
                }
                
            });
        });

    }

    var updateac = function() {
        var itemtypes = [];
        getSectionIDs("repeating_inventory", function(idarray) {
            if(idarray.length > 0) {
                _.each(idarray, function(currentID, i) {
                    getAttrs(["repeating_inventory_" + currentID + "_itemtype"], function(x) {
                        if(x["repeating_inventory_" + currentID + "_itemtype"]) {
                            itemtypes.push(x["repeating_inventory_" + currentID + "_itemtype"].toLowerCase());
                        }
                        if(i === idarray.length - 1) {
                            armorcount = itemtypes.filter(function(item){ return item.indexOf("armor") > -1 }).length
                            shieldcount = itemtypes.filter(function(item){ return item.indexOf("shield") > -1 }).length
                            if(armorcount > 1 || shieldcount > 1) {
                                setAttrs({
                                    armorwarningflag: "show",
                                    armorwarning: "0"
                                });
                            }
                            else {
                                setac(itemtypes);
                            }
                        }
                    });
                })
            }
            else {
                getAttrs(["dexterity"], function(v) {
                    setAttrs({ac: 10 + ((parseInt(v.dexterity, 10) - 10) / 2)})
                });
            }
            
        });
    }

    var setac = function (itemtypes) {
        var actotal = 0;
        getSectionIDs("repeating_inventory", function(idarray) {
            _.each(idarray, function(currentID, i) {
                getAttrs(["repeating_inventory_" + currentID + "_itemac","repeating_inventory_" + currentID + "_itemmodifiers","dexterity"], function(v) {
                    var dexmod = (parseInt(v.dexterity, 10) - 10) / 2;
                    if(v["repeating_inventory_" + currentID + "_itemac"] && isNaN(parseInt(v["repeating_inventory_" + currentID + "_itemac"], 10)) === false) {
                        actotal = actotal + parseInt(v["repeating_inventory_" + currentID + "_itemac"], 10);
                    }
                    if(v["repeating_inventory_" + currentID + "_itemmodifiers"] && v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().indexOf("ac +") > -1) {
                        newac = v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().split("ac")[1].match(/\d/);
                        actotal = actotal + parseInt(newac[0], 10);
                    }
                    if(i === idarray.length - 1) {
                        if(itemtypes.indexOf("light armor") > -1) {
                            actotal = actotal + dexmod;
                        }
                        else if(itemtypes.indexOf("medium armor") > -1) {
                            actotal = actotal + Math.min(dexmod, 2);
                        }
                        else if(itemtypes.indexOf("heavy armor") > -1) {
                            actotal = actotal;
                        }
                        else {
                            actotal = actotal + 10 + dexmod;
                        }
                        setAttrs({ac: actotal});
                    }
                });
            })
        });
    }

    var updateglobalsave = function() {
        var savetotal = 0;
        getSectionIDs("repeating_inventory", function(idarray) {
            _.each(idarray, function(currentID, i) {
                getAttrs(["repeating_inventory_" + currentID + "_itemmodifiers"], function(v) {
                    if(v["repeating_inventory_" + currentID + "_itemmodifiers"] && v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().indexOf("saving throws +") > -1) {
                        newmod = v["repeating_inventory_" + currentID + "_itemmodifiers"].toLowerCase().split("saving throws")[1].match(/\d/);
                        savetotal = savetotal + parseInt(newmod[0], 10);
                    }
                    if(i === idarray.length - 1) {
                        setAttrs({globalsavemod: savetotal});
                    }
                });
            })
        });
    }

    var additemattack = function(id) {
        getAttrs(["repeating_inventory_itemname","repeating_inventory_itemproperties","repeating_inventory_itemmodifiers","repeating_inventory_itemdamage","repeating_inventory_itemdamage2","repeating_inventory_itemdamagetype","repeating_inventory_itemrange","repeating_inventory_itemtype"], function(v) {
            var newrowid = generateRowID();
            var newrowattrs = {};
            newrowattrs["repeating_inventory_itemattackid"] = newrowid;
            newrowattrs["repeating_attack_" + newrowid + "_itemid"] = id;
            newrowattrs["repeating_attack_" + newrowid + "_options-flag"] = "0";
            if(v.repeating_inventory_itemname && v.repeating_inventory_itemname != "") {
                newrowattrs["repeating_attack_" + newrowid + "_atkname_base"] = v.repeating_inventory_itemname;
            }
            if(v.repeating_inventory_itemdamage && v.repeating_inventory_itemdamage != "") {
                newrowattrs["repeating_attack_" + newrowid + "_dmgbase"] = v.repeating_inventory_itemdamage;
            }
            if(v.repeating_inventory_itemdamagetype && v.repeating_inventory_itemdamagetype != "") {
                newrowattrs["repeating_attack_" + newrowid + "_dmgtype"] = v.repeating_inventory_itemdamagetype;
            }
            if(v.repeating_inventory_itemrange && v.repeating_inventory_itemrange != "") {
                newrowattrs["repeating_attack_" + newrowid + "_atkrange"] = v.repeating_inventory_itemrange;
            }
            if(v.repeating_inventory_itemtype.indexOf("Melee") > -1) {
                newrowattrs["repeating_attack_" + newrowid + "_atkattr_base"] = "@{strength_mod}";
                newrowattrs["repeating_attack_" + newrowid + "_dmgattr"] = "@{strength_mod}";
            }
            else {
                newrowattrs["repeating_attack_" + newrowid + "_atkattr_base"] = "@{dexterity_mod}";
                newrowattrs["repeating_attack_" + newrowid + "_dmgattr"] = "@{dexterity_mod}";
            }
            if(v.repeating_inventory_itemmodifiers.indexOf("Attacks") > -1 && v.repeating_inventory_itemmodifiers.indexOf("Damage")) {
                newrowattrs["repeating_attack_" + newrowid + "_atkmagic"] = v.repeating_inventory_itemmodifiers.replace( /(^.+\D)(\d+)(\D.+$)/i,'$2').substring(0,1);
            }
            setAttrs(newrowattrs);
        });
    }

    var addspellattack = function() {
        getAttrs(["repeating_spell_spelloutput","repeating_spell_spellname_base","repeating_spell_spellrange","repeating_spell_spellattack","spellcasting_ability","repeating_spell_spelldamage","repeating_spell_spelldamagetype","repeating_spell_spelldamage2","repeating_spell_spelldamagetype2","repeating_spell_spellsave","repeating_spell_spellsavesuccess","repeating_spell_spellattackid","character_name","repeating_spell_spellhldie","repeating_spell_spellhldietype","repeating_spell_spelldmgmod","repeating_spell_spellhealing","repeating_spell_spelllevel"], function(v) {
            var newrowid = generateRowID();
            var newrowattrs = {};
            var cname = v.character_name
            newrowattrs["repeating_spell_spellattackid"] = newrowid;
            newrowattrs["repeating_spell_rollcontent"] = "%{" + v.character_name + "|repeating_attack_" + newrowid + "_attack_full}";
            newrowattrs["repeating_attack_" + newrowid + "_options-flag"] = "0";
            newrowattrs["repeating_attack_" + newrowid + "_atkname_base"] = v.repeating_spell_spellname_base;
            if(v.repeating_spell_spellrange && v.repeating_spell_spellrange != "") {
                newrowattrs["repeating_attack_" + newrowid + "_atkrange"] = v.repeating_spell_spellrange;
            }
            if(!v.repeating_spell_spellattack || v.repeating_spell_spellattack === "None") {
                newrowattrs["repeating_attack_" + newrowid + "_atkflag"] = "0";
            }
            else {
                newrowattrs["repeating_attack_" + newrowid + "_atkattr_base"] = v.spellcasting_ability.slice(0, -1);
            }
            if(v.repeating_spell_spelldamage && v.repeating_spell_spelldamage != "") {
                newrowattrs["repeating_attack_" + newrowid + "_dmgbase"] = v.repeating_spell_spelldamage;
                newrowattrs["repeating_attack_" + newrowid + "_dmgtype"] = v.repeating_spell_spelldamagetype;
                if(v.repeating_spell_spelldmgmod && v.repeating_spell_spelldmgmod === "Yes") {
                    newrowattrs["repeating_attack_" + newrowid + "_dmgattr"] = v.spellcasting_ability.slice(0, -1);
                }
                else {
                    newrowattrs["repeating_attack_" + newrowid + "_dmgattr"] = "0";
                }
            }
            else {
                newrowattrs["repeating_attack_" + newrowid + "_dmgflag"] = "0";
            }
            if(v.repeating_spell_spelldamage2 && v.repeating_spell_spelldamage2 != "") {
                newrowattrs["repeating_attack_" + newrowid + "_dmg2flag"] = "{{damage=1}} {{dmg2flag=1}}";
                newrowattrs["repeating_attack_" + newrowid + "_dmg2base"] = v.repeating_spell_spelldamage2;
                newrowattrs["repeating_attack_" + newrowid + "_dmg2attr"] = "0";
                newrowattrs["repeating_attack_" + newrowid + "_dmg2type"] = v.repeating_spell_spelldamagetype2;
            }
            if(v.repeating_spell_spellsave && v.repeating_spell_spellsave != "") {
                newrowattrs["repeating_attack_" + newrowid + "_saveflag"] = "{{save=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}}  {{savedc=[[@{savedc}]]}}";
                newrowattrs["repeating_attack_" + newrowid + "_saveattr"] = v.repeating_spell_spellsave;
                newrowattrs["repeating_attack_" + newrowid + "_saveeffect"] = v.repeating_spell_spellsavesuccess;
            }
            if(v.repeating_spell_spellhldie && v.repeating_spell_spellhldie != "" && v.repeating_spell_spellhldietype && v.repeating_spell_spellhldietype != "") {
                query = "?{Cast at what level?";
                for(i = 0; i < 10-v.repeating_spell_spelllevel; i++) {
                    query = query + "|Level " + (parseInt(i, 10) + parseInt(v.repeating_spell_spelllevel, 10)) + "," + i;
                }
                query = query + "}";
                newrowattrs["repeating_attack_" + newrowid + "_hldmg"] = "{{hldmg=[[(" + v.repeating_spell_spellhldie + "*" + query + ")" + v.repeating_spell_spellhldietype + "]]}}";
            }
            if(v.repeating_spell_spellhealing && v.repeating_spell_spellhealing != "") {
                if(!v.repeating_spell_spelldamage || v.repeating_spell_spelldamage === "") {
                    newrowattrs["repeating_attack_" + newrowid + "_dmgflag"] = "{{damage=1}} {{dmg1flag=1}}";
                    newrowattrs["repeating_attack_" + newrowid + "_dmgbase"] = v.repeating_spell_spellhealing;
                    newrowattrs["repeating_attack_" + newrowid + "_dmgtype"] = "Healing";
                    if(v.repeating_spell_spelldmgmod && v.repeating_spell_spelldmgmod === "Yes") {
                        newrowattrs["repeating_attack_" + newrowid + "_dmgattr"] = v.spellcasting_ability.slice(0, -1);
                    }
                    else {
                        newrowattrs["repeating_attack_" + newrowid + "_dmgattr"] = "0";
                    }
                } 
                else if(!v.repeating_spell_spelldamage2 || v.repeating_spell_spelldamage2 === "") {
                    newrowattrs["repeating_attack_" + newrowid + "_dmg2flag"] = "{{damage=1}} {{dmg2flag=1}}";
                    newrowattrs["repeating_attack_" + newrowid + "_dmg2base"] = v.repeating_spell_spellhealing;
                    newrowattrs["repeating_attack_" + newrowid + "_dmg2type"] = "Healing";
                    if(v.repeating_spell_spelldmgmod && v.repeating_spell_spelldmgmod === "Yes") {
                        newrowattrs["repeating_attack_" + newrowid + "_dmg2attr"] = v.spellcasting_ability.slice(0, -1);
                    }
                    else {
                        newrowattrs["repeating_attack_" + newrowid + "_dmg2attr"] = "0";
                    }
                }
            }
            setAttrs(newrowattrs);
        });
    }

    var setlevel = function() {
       getAttrs(["base_level","multiclass1_flag","multiclass2_flag","multiclass3_flag","multiclass1_lvl","multiclass2_lvl","multiclass3_lvl","class","multiclass1","multiclass2","multiclass3", "arcane_fighter", "arcane_rogue", "custom_class", "cust_spellslots"], function(v) {
            var multiclass = false;
            var casterlevel = 0;
            var m1casterlevel = 0;
            var m2casterlevel = 0;
            var m3casterlevel = 0;
            var m1hitdie = "";
            var m2hitdie = "";
            var m3hitdie = "";
            var d10class = ["Fighter","Paladin","Ranger"];
            var d8class = ["Bard","Cleric","Druid","Monk","Rogue","Warlock"];
            var d6class = ["Sorcerer","Wizard"];
            var charclass = v.custom_class && v.custom_class != "0" ? v.cust_spellslots : v.class;
            var full = ["Bard","Cleric","Druid","Sorcerer","Wizard","full"];
            var half = ["Paladin","Ranger","half"];
            var finallevel = (v.base_level && v.base_level > 0) ? parseInt(v.base_level,10) : 1;
            
            if(v.multiclass1_flag && v.multiclass1_flag === "1") {
                finallevel = finallevel + parseInt(v.multiclass1_lvl,10); 
                multiclass = true;
                if(full.indexOf(v.multiclass1) != -1) {
                    m1casterlevel = parseInt(v.multiclass1_lvl,10)
                }
                else if(half.indexOf(v.multiclass1) != -1) {
                    m1casterlevel = Math.floor(parseInt(v.multiclass1_lvl,10)/2)
                }
                else if((v.multiclass1 === "Fighter" && v.arcane_fighter === "1") || (v.multiclass1 === "Rogue" && v.arcane_rogue === "1")) {
                    m1casterlevel = Math.floor(parseInt(v.multiclass1_lvl,10)/3)
                }
                if(v.multiclass1 === "Barbarian") {m1hd = "12"}
                else if (d10class.indexOf(v.multiclass1) != -1) {m1hd = "10"}
                else if (d8class.indexOf(v.multiclass1) != -1) {m1hd = "8"}
                else if (d6class.indexOf(v.multiclass1) != -1) {m1hd = "6"};
                m1hitdie = "|" + v.multiclass1 + "," + m1hd;
            };
            if(v.multiclass2_flag && v.multiclass2_flag === "1") {
                finallevel = finallevel + parseInt(v.multiclass2_lvl,10); 
                multiclass = true;
                if(full.indexOf(v.multiclass2) != -1) {
                    m2casterlevel = parseInt(v.multiclass2_lvl,10)
                }
                else if(half.indexOf(v.multiclass2) != -1) {
                    m2casterlevel = Math.floor(parseInt(v.multiclass2_lvl,10)/2)
                }
                else if((v.multiclass2 === "Fighter" && v.arcane_fighter === "1") || (v.multiclass2 === "Rogue" && v.arcane_rogue === "1")) {
                    m2casterlevel = Math.floor(parseInt(v.multiclass2_lvl,10)/3)
                }
                if(v.multiclass2 === "Barbarian") {m2hd = "12"}
                else if (d10class.indexOf(v.multiclass2) != -1) {m2hd = "10"}
                else if (d8class.indexOf(v.multiclass2) != -1) {m2hd = "8"}
                else if (d6class.indexOf(v.multiclass2) != -1) {m2hd = "6"};
                m2hitdie = "|" + v.multiclass2 + "," + m2hd;
            };
            if(v.multiclass3_flag && v.multiclass3_flag === "1") {
                finallevel = finallevel + parseInt(v.multiclass3_lvl,10); 
                multiclass = true;
                if(full.indexOf(v.multiclass3) != -1) {
                    m3casterlevel = parseInt(v.multiclass3_lvl,10)
                }
                else if(half.indexOf(v.multiclass3) != -1) {
                    m3casterlevel = Math.floor(parseInt(v.multiclass3_lvl,10)/2)
                }
                else if((v.multiclass3 === "Fighter" && v.arcane_fighter === "1") || (v.multiclass3 === "Rogue" && v.arcane_rogue === "1")) {
                    m3casterlevel = Math.floor(parseInt(v.multiclass3_lvl,10)/3)
                }
                if(v.multiclass3 === "Barbarian") {m3hd = "12"}
                else if (d10class.indexOf(v.multiclass3) != -1) {m3hd = "10"}
                else if (d8class.indexOf(v.multiclass3) != -1) {m3hd = "8"}
                else if (d6class.indexOf(v.multiclass3) != -1) {m3hd = "6"};
                m3hitdie = "|" + v.multiclass3 + "," + m3hd;
            };
            
            if(multiclass === false) {
                if(full.indexOf(charclass) != -1) {
                    casterlevel = finallevel
                }
                else if(half.indexOf(charclass) != -1) {
                    casterlevel = finallevel === 1 ? 0 : Math.ceil(finallevel/2)
                }
                else if((charclass === "Fighter" && v.arcane_fighter === "1") || (charclass === "Rogue" && v.arcane_rogue === "1") || (charclass === "third")) {
                    casterlevel = finallevel < 3 ? 0 : Math.ceil(finallevel/3)
                }
                hitdie_final = "@{hitdietype}"
            }
            else {
                if(full.indexOf(charclass) != -1) {
                    casterlevel = parseInt(v.base_level,10)
                }
                else if(half.indexOf(charclass) != -1) {
                    casterlevel = Math.floor(parseInt(v.base_level,10)/2)
                }
                else if((charclass === "Fighter" && v.arcane_fighter === "1") || (charclass === "Rogue" && v.arcane_rogue === "1") || (charclass === "third")) {
                    casterlevel = Math.floor(parseInt(v.base_level,10)/3)
                }
                casterlevel = casterlevel + m1casterlevel + m2casterlevel + m3casterlevel
                hitdie_final = "?{Hit Die Class|" + charclass + ",@{hitdietype}" + m1hitdie + m2hitdie + m3hitdie + "}"
            }
            
            setAttrs({
               level: finallevel,
               caster_level: casterlevel,
               hitdie_final: hitdie_final
            });
            
            updateSpellSlots(casterlevel);
        });
    }
    
    var updateClass = function() {
        getAttrs(["class","base_level","custom_class","cust_classname","cust_hitdietype","cust_spellcasting_ability","cust_strength_save_prof","cust_dexterity_save_prof","cust_constitution_save_prof","cust_intelligence_save_prof","cust_wisdom_save_prof","cust_charisma_save_prof","strength_save_prof","dexterity_save_prof","constitution_save_prof","intelligence_save_prof","wisdom_save_prof","charisma_save_prof"], function(v) {
            if(v.custom_class && v.custom_class != "0") {
                setAttrs({
                    hitdietype: v.cust_hitdietype,
                    spellcasting_ability: v.cust_spellcasting_ability,
                    strength_save_prof: v.cust_strength_save_prof,
                    dexterity_save_prof: v.cust_dexterity_save_prof,
                    constitution_save_prof: v.cust_constitution_save_prof,
                    intelligence_save_prof: v.cust_intelligence_save_prof,
                    wisdom_save_prof: v.cust_wisdom_save_prof,
                    charisma_save_prof: v.cust_charisma_save_prof
                });
            }
            else {
                update = {};
                switch(v.class) {
                    case "Barbarian":
                        update["hitdietype"] = 12;
                        update["spellcasting_ability"] = "0*";
                        if(!v.strength_save_prof || v.strength_save_prof != "(@{pb})" || !v.constitution_save_prof || v.constitution_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = "(@{pb})";
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = "(@{pb})";
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = 0;
                            update["charisma_save_prof"] = 0;
                        }
                        break;
                    case "Bard":
                        update["hitdietype"] = 8;
                        update["spellcasting_ability"] = "@{charisma_mod}+";
                        if(!v.dexterity_save_prof || v.dexterity_save_prof != "(@{pb})" || !v.charisma_save_prof || v.charisma_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = "(@{pb})";
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = 0;
                            update["charisma_save_prof"] = "(@{pb})";
                        }
                        break;
                    case "Cleric":
                        update["hitdietype"] = 8;
                        update["spellcasting_ability"] = "@{wisdom_mod}+";
                        if(!v.wisdom_save_prof || v.wisdom_save_prof != "(@{pb})" || !v.charisma_save_prof || v.charisma_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = "(@{pb})";
                            update["charisma_save_prof"] = "(@{pb})";
                        }
                        break;
                    case "Druid":
                        update["hitdietype"] = 8;
                        update["spellcasting_ability"] = "@{wisdom_mod}+";
                        if(!v.wisdom_save_prof || v.wisdom_save_prof != "(@{pb})" || !v.intelligence_save_prof || v.intelligence_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = "(@{pb})";
                            update["wisdom_save_prof"] = "(@{pb})";
                            update["charisma_save_prof"] = 0;
                        }
                        break;
                    case "Fighter":
                        update["hitdietype"] = 10;
                        update["spellcasting_ability"] = "0*";
                        if(!v.strength_save_prof || v.strength_save_prof != "(@{pb})" || !v.constitution_save_prof || v.constitution_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = "(@{pb})";
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = "(@{pb})";
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = 0;
                            update["charisma_save_prof"] = 0;
                        }
                        break;
                    case "Monk":
                        update["hitdietype"] = 8;
                        update["spellcasting_ability"] = "0*";
                        if(!v.strength_save_prof || v.strength_save_prof != "(@{pb})" || !v.dexterity_save_prof || v.dexterity_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = "(@{pb})";
                            update["dexterity_save_prof"] = "(@{pb})";
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = 0;
                            update["charisma_save_prof"] = 0;
                        }
                        break;
                    case "Paladin":
                        update["hitdietype"] = 10;
                        update["spellcasting_ability"] = "@{wisdom_mod}+";
                        if(!v.wisdom_save_prof || v.wisdom_save_prof != "(@{pb})" || !v.charisma_save_prof || v.charisma_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = "(@{pb})";
                            update["charisma_save_prof"] = "(@{pb})";
                        }
                        break;
                    case "Ranger":
                        update["hitdietype"] = 10;
                        update["spellcasting_ability"] = "@{wisdom_mod}+";
                        if(!v.strength_save_prof || v.strength_save_prof != "(@{pb})" || !v.dexterity_save_prof || v.dexterity_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = "(@{pb})";
                            update["dexterity_save_prof"] = "(@{pb})";
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = 0;
                            update["charisma_save_prof"] = 0;
                        }
                        break;
                    case "Rogue":
                        update["hitdietype"] = 8;
                        update["spellcasting_ability"] = "0*";
                        if(!v.intelligence_save_prof || v.intelligence_save_prof != "(@{pb})" || !v.dexterity_save_prof || v.dexterity_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = "(@{pb})";
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = "(@{pb})";
                            update["wisdom_save_prof"] = 0;
                            update["charisma_save_prof"] = 0;
                        }
                        break;
                    case "Sorcerer":
                        update["hitdietype"] = 6;
                        update["spellcasting_ability"] = "@{charisma_mod}+";
                        if(!v.constitution_save_prof || v.constitution_save_prof != "(@{pb})" || !v.charisma_save_prof || v.charisma_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = "(@{pb})";
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = 0;
                            update["charisma_save_prof"] = "(@{pb})";
                        }
                        break;
                    case "Warlock":
                        update["hitdietype"] = 8;
                        update["spellcasting_ability"] = "@{charisma_mod}+";
                        if(!v.wisdom_save_prof || v.wisdom_save_prof != "(@{pb})" || !v.charisma_save_prof || v.charisma_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = 0;
                            update["wisdom_save_prof"] = "(@{pb})";
                            update["charisma_save_prof"] = "(@{pb})";
                        }
                        break;
                    case "Wizard":
                        update["hitdietype"] = 6;
                        update["spellcasting_ability"] = "@{intelligence_mod}+";
                        if(!v.wisdom_save_prof || v.wisdom_save_prof != "(@{pb})" || !v.intelligence_save_prof || v.intelligence_save_prof != "(@{pb})") {
                            update["strength_save_prof"] = 0;
                            update["dexterity_save_prof"] = 0;
                            update["constitution_save_prof"] = 0;
                            update["intelligence_save_prof"] = "(@{pb})";
                            update["wisdom_save_prof"] = "(@{pb})";
                            update["charisma_save_prof"] = 0;
                        }
                        break;
                }
                setAttrs(update);
            };
        });
        setlevel();
    };
    
    var updateTool = function() {
        getAttrs(["repeating_tool_toolname_base","repeating_tool_toolbonus_base","level","repeating_tool_toolattr_base","strength","dexterity","constitution","intelligence","wisdom","charisma"], function(v) {
            pb = (Math.ceil((v.level)/1e10) + Math.ceil((v.level)/4))
            if(v.repeating_tool_toolbonus_base === "(@{pb})") {bonus = pb}
            else if(v.repeating_tool_toolbonus_base === "(@{pb}*2)") {bonus = pb*2}
            else if(v.repeating_tool_toolbonus_base === "(floor(@{pb}/2))") {bonus = Math.floor(pb/2)};
            attr = v.repeating_tool_toolattr_base.substring(0, v.repeating_tool_toolattr_base.length - 5).substr(2).toUpperCase();
            bonus = bonus + Math.floor((parseInt(v[attr.toLowerCase()],10) - 10) / 2);
            setAttrs({
                repeating_tool_toolname: v.repeating_tool_toolname_base,
                repeating_tool_toolbonus: bonus,
                repeating_tool_toolattr: attr
            });
        });
    };
    
    var updateAttack = function() {
        getAttrs(["level","repeating_attack_atkflag","repeating_attack_atkname_base","repeating_attack_atkattr_base","repeating_attack_atkmod","repeating_attack_atkprofflag","repeating_attack_atkmagic","repeating_attack_dmgflag","repeating_attack_dmgbase","repeating_attack_dmgattr","repeating_attack_dmgmod","repeating_attack_dmgtype","repeating_attack_dmg2flag","repeating_attack_dmg2base","repeating_attack_dmg2attr","repeating_attack_dmg2mod","repeating_attack_dmg2type","strength","dexterity","constitution","intelligence","wisdom","charisma","spellcasting_ability","repeating_attack_dmgcustcrit","repeating_attack_dmg2custcrit","repeating_attack_saveflag","repeating_attack_savedc","dflag","repeating_attack_hldmg"], function(v) {
            var hbonus = "";
            var hdmg1 = "";
            var hdmg2 = "";
            var dmg = "";
            var dmg2 = "";
            if(v.repeating_attack_atkattr_base === "0") {atkattr_base = 0} else {atkattr_base = Math.floor((v[v.repeating_attack_atkattr_base.substring(0, v.repeating_attack_atkattr_base.length - 5).substr(2)] - 10) / 2 );};
            if(v.repeating_attack_dmgattr === "0") {dmgattr = 0} else {dmgattr = Math.floor((v[v.repeating_attack_dmgattr.substring(0, v.repeating_attack_dmgattr.length - 5).substr(2)] - 10) / 2 );};
            if(v.repeating_attack_dmg2attr === "0") {dmg2attr = 0} else {dmg2attr = Math.floor((v[v.repeating_attack_dmg2attr.substring(0, v.repeating_attack_dmg2attr.length - 5).substr(2)] - 10) / 2 );};
            var dmgbase = v.repeating_attack_dmgbase && v.repeating_attack_dmgbase != "" ? v.repeating_attack_dmgbase : 0;
            var dmg2base = v.repeating_attack_dmg2base && v.repeating_attack_dmg2base != "" ? v.repeating_attack_dmg2base : 0;
            var dmgmod = v.repeating_attack_dmgmod && isNaN(parseInt(v.repeating_attack_dmgmod,10)) === false ? parseInt(v.repeating_attack_dmgmod,10) : 0;
            var dmg2mod = v.repeating_attack_dmg2mod && isNaN(parseInt(v.repeating_attack_dmg2mod,10)) === false ? parseInt(v.repeating_attack_dmg2mod,10) : 0;
            var dmgtype = v.repeating_attack_dmgtype ? v.repeating_attack_dmgtype + " " : "";
            var dmg2type = v.repeating_attack_dmg2type ? v.repeating_attack_dmg2type + " " : "";
            var pb = v.repeating_attack_atkprofflag && v.repeating_attack_atkprofflag != 0 ? (Math.ceil((v.level)/1e10) + Math.ceil((v.level)/4)) : 0;
            var atkmod = v.repeating_attack_atkmod && v.repeating_attack_atkmod != "" ? parseInt(v.repeating_attack_atkmod,10) : 0;
            var atkmag = v.repeating_attack_atkmagic && v.repeating_attack_atkmagic != "" ? parseInt(v.repeating_attack_atkmagic,10) : 0;
            var dmgmag = isNaN(atkmag) === false && atkmag != 0 && ((v.repeating_attack_dmgflag && v.repeating_attack_dmgflag != 0) || (v.repeating_attack_dmg2flag && v.repeating_attack_dmg2flag != 0)) ? "+ " + atkmag + " Magic Bonus" : "";
            var name = v.repeating_attack_atkname_base ? v.repeating_attack_atkname_base : "-";
            if(v.repeating_attack_atkflag && v.repeating_attack_atkflag != 0) {
                bonus_mod = atkattr_base + atkmod + pb + atkmag
                plus_minus = bonus_mod > -1 ? "+" : ""
                bonus = plus_minus + bonus_mod;
            }
            else if(v.repeating_attack_saveflag && v.repeating_attack_saveflag != 0) {
                savedcattr = v.repeating_attack_savedc.indexOf("spell") > -1 ? v.spellcasting_ability : v.repeating_attack_savedc;
                savedcattr = savedcattr.replace(/^[^{]*{/,"").replace(/\_.*$/,"");
                tempdc = isNaN(Math.floor((parseInt(v[savedcattr], 10) - 10) / 2) + 8 + pb) === false ? (Math.floor((parseInt(v[savedcattr], 10) - 10) / 2) + 8 + pb) : "0";
                bonus = "DC" + tempdc;
            }
            else {
                bonus = "-";
            }
            if(v.repeating_attack_dmgflag && v.repeating_attack_dmgflag != 0) {
                if(dmgbase === 0 && (dmgattr + dmgmod === 0)){
                    dmg = 0;
                }
                if(dmgbase != 0) {
                    dmg = dmgbase;
                }
                if(dmgbase != 0 && (dmgattr + dmgmod != 0)){
                    dmg = dmgattr + dmgmod > 0 ? dmg + "+" : dmg;
                }
                if(dmgattr + dmgmod != 0) {
                    dmg = dmg + (dmgattr + dmgmod);
                }
                dmg = dmg + " " + dmgtype;
            }
            else {
                dmg = "";
            };
            if(v.repeating_attack_dmg2flag && v.repeating_attack_dmg2flag != 0) {
                if(dmg2base === 0 && (dmg2attr + dmg2mod === 0)){
                    dmg2 = 0;
                }
                if(dmg2base != 0) {
                    dmg2 = dmg2base;
                }
                if(dmg2base != 0 && (dmg2attr + dmg2mod != 0)){
                    dmg2 = dmg2attr + dmg2mod > 0 ? dmg2 + "+" : dmg2;
                }
                if(dmg2attr + dmg2mod != 0) {
                    dmg2 = dmg2 + (dmg2attr + dmg2mod);
                }
                dmg2 = dmg2 + " " + dmg2type;
            }
            else {
                dmg2 = "";
            };
            dmgspacer = v.repeating_attack_dmgflag && v.repeating_attack_dmgflag != 0 && v.repeating_attack_dmg2flag && v.repeating_attack_dmg2flag != 0 ? "+ " : "";
            crit1 = v.repeating_attack_dmgcustcrit && v.repeating_attack_dmgcustcrit != "" ? v.repeating_attack_dmgcustcrit : dmgbase;
            crit2 = v.repeating_attack_dmg2custcrit && v.repeating_attack_dmg2custcrit != "" ? v.repeating_attack_dmg2custcrit : dmg2base;
            r1 = v.repeating_attack_atkflag && v.repeating_attack_atkflag != 0 ? "1d20" : "0d20";
            r2 = v.repeating_attack_atkflag && v.repeating_attack_atkflag != 0 ? "@{rtype}" : "{{r2=[[0d20";
            if(v.repeating_attack_atkflag && v.repeating_attack_atkflag != 0) {
                if(atkmag != 0) {hbonus = " + " + atkmag + "[MAGIC]" + hbonus};
                if(pb != 0) {hbonus = " + " + pb + "[PROF]" + hbonus};
                if(atkmod != 0) {hbonus = " + " + atkmod + "[MOD]" + hbonus};
                if(atkattr_base != 0) {hbonus = " + " + atkattr_base + "[" + v.repeating_attack_atkattr_base.substring(2, 5).toUpperCase() + "]" + hbonus};
            }
            else {
                hbonus = "";
            }
            if(v.repeating_attack_dmgflag && v.repeating_attack_dmgflag != 0) {
                if(atkmag != 0) {hdmg1 = " + " + atkmag + "[MAGIC]" + hdmg1};
                if(dmgmod != 0) {hdmg1 = " + " + dmgmod + "[MOD]" + hdmg1};
                if(dmgattr != 0) {hdmg1 = " + " + dmgattr + "[" + v.repeating_attack_dmgattr.substring(2, 5).toUpperCase() + "]" + hdmg1};
                hdmg1 = dmgbase + hdmg1;
            }
            else {
                hdmg1 = "0";
            }
            if(v.repeating_attack_dmg2flag && v.repeating_attack_dmg2flag != 0) {
                if(dmg2mod != 0) {hdmg2 = " + " + dmg2mod + "[MOD]" + hdmg2};
                if(dmg2attr != 0) {hdmg2 = " + " + dmg2attr + "[" + v.repeating_attack_dmg2attr.substring(2, 5).toUpperCase() + "]" + hdmg2};
                hdmg2 = dmg2base + hdmg2;
            }
            else {
                hdmg2 = "0";
            }
            if(v.dflag === "full") {
                pickbase = "full";
            }
            else if(v.repeating_attack_atkflag && v.repeating_attack_atkflag != 0) {
                pickbase = "pick";
            }
            else if(v.repeating_attack_dmgflag && v.repeating_attack_dmgflag != 0) {
                pickbase = "dmg";
            }
            else {
                pickbase = "empty";
            }
            
            setAttrs({
                repeating_attack_atkname: name,
                repeating_attack_atkbonus: bonus,
                repeating_attack_atkdmgtype: dmg + dmgspacer + dmg2 + dmgmag + " ",
                repeating_attack_hidden_r1base: r1,
                repeating_attack_hidden_r2base: r2,
                repeating_attack_hidden_atkbonus: hbonus,
                repeating_attack_hidden_dmg1: hdmg1,
                repeating_attack_hidden_dmg2: hdmg2,
                repeating_attack_hidden_dmg1type: dmgtype,
                repeating_attack_hidden_dmg2type: dmg2type,
                repeating_attack_hidden_crit1: crit1 + "[CRIT]",
                repeating_attack_hidden_crit2: crit2 + "[CRIT]",
                repeating_attack_hidden_pickbase: pickbase
            });
        });
    };
    
    var updateSpell = function(spellid, category) {
        var cat = category ? "-" + category : "";
        var repid = spellid ? spellid + "_" : "";
        getAttrs(["repeating_spell" + cat + "_" + repid + "spellname_base","repeating_spell" + cat + "_" + repid + "spellprepared","repeating_spell" + cat + "_" + repid + "spellrange","repeating_spell" + cat + "_" + repid + "spelltarget","repeating_spell" + cat + "_" + repid + "spellattack","repeating_spell" + cat + "_" + repid + "spelldamage","repeating_spell" + cat + "_" + repid + "spelldamagetype","repeating_spell" + cat + "_" + repid + "spelldamage2","repeating_spell" + cat + "_" + repid + "spelldamagetype2","repeating_spell" + cat + "_" + repid + "spellhealing","repeating_spell" + cat + "_" + repid + "spelldmgmod","repeating_spell" + cat + "_" + repid + "spellsave","repeating_spell" + cat + "_" + repid + "spellsavesuccess","repeating_spell" + cat + "_" + repid + "spellhldie","repeating_spell" + cat + "_" + repid + "spellhldietype","repeating_spell" + cat + "_" + repid + "spellattackid","character_name","repeating_spell" + cat + "_" + repid + "spelloutput","repeating_spell" + cat + "_" + repid + "spelllevel","spellcasting_ability"], function(v) {
            var update = {};
            update["repeating_spell" + cat + "_" + repid + "spellname"] = v["repeating_spell" + cat + "_" + repid + "spellname_base"] ? v["repeating_spell" + cat + "_" + repid + "spellname_base"] : "";
            update["repeating_spell" + cat + "_" + repid + "prep"] = v["repeating_spell" + cat + "_" + repid + "spellprepared"] ? v["repeating_spell" + cat + "_" + repid + "spellprepared"] : 1;
            update["repeating_spell" + cat + "_" + repid + "spellattackinfoflag"] = v["repeating_spell" + cat + "_" + repid + "spelloutput"] && v["repeating_spell" + cat + "_" + repid + "spelloutput"] === "ATTACK" ? "show" : "hide";
            if(v["repeating_spell" + cat + "_" + repid + "spellattackid"] && v["repeating_spell" + cat + "_" + repid + "spellattackid"] != "") {
                atkid = v["repeating_spell" + cat + "_" + repid + "spellattackid"];
                update["repeating_spell" + cat + "_" + repid + "rollcontent"] = "%{" + v.character_name + "|repeating_attack_" + atkid + "_attack_full}";
                update["repeating_attack_" + atkid + "_options-flag"] = "0";
                update["repeating_attack_" + atkid + "_atkname_base"] = v["repeating_spell" + cat + "_" + repid + "spellname_base"];
                if(v["repeating_spell" + cat + "_" + repid + "spellrange"] && v["repeating_spell" + cat + "_" + repid + "spellrange"] != "") {
                    update["repeating_attack_" + atkid + "_atkrange"] = v["repeating_spell" + cat + "_" + repid + "spellrange"];
                }
                if(!v["repeating_spell" + cat + "_" + repid + "spellattack"] || v["repeating_spell" + cat + "_" + repid + "spellattack"] === "None") {
                    update["repeating_attack_" + atkid + "_atkflag"] = "0";
                }
                else {
                    update["repeating_attack_" + atkid + "_atkattr_base"] = v.spellcasting_ability.slice(0, -1);
                }
                if(v["repeating_spell" + cat + "_" + repid + "spelldamage"] && v["repeating_spell" + cat + "_" + repid + "spelldamage"] != "") {
                    update["repeating_attack_" + atkid + "_dmgbase"] = v["repeating_spell" + cat + "_" + repid + "spelldamage"];
                    update["repeating_attack_" + atkid + "_dmgtype"] = v["repeating_spell" + cat + "_" + repid + "spelldamagetype"];
                    if(v["repeating_spell" + cat + "_" + repid + "spelldmgmod"] && v["repeating_spell" + cat + "_" + repid + "spelldmgmod"] === "Yes") {
                        update["repeating_attack_" + atkid + "_dmgattr"] = v.spellcasting_ability.slice(0, -1);
                    }
                    else {
                        update["repeating_attack_" + atkid + "_dmgattr"] = "0";
                    }
                }
                else {
                    update["repeating_attack_" + atkid + "_dmgflag"] = "0";
                }
                if(v["repeating_spell" + cat + "_" + repid + "spelldamage2"] && v["repeating_spell" + cat + "_" + repid + "spelldamage2"] != "") {
                    update["repeating_attack_" + atkid + "_dmg2flag"] = "{{damage=1}} {{dmg2flag=1}}";
                    update["repeating_attack_" + atkid + "_dmg2base"] = v["repeating_spell" + cat + "_" + repid + "spelldamage2"];
                    update["repeating_attack_" + atkid + "_dmg2attr"] = "0";
                    update["repeating_attack_" + atkid + "_dmg2type"] = v["repeating_spell" + cat + "_" + repid + "spelldamagetype2"];
                }
                if(v["repeating_spell" + cat + "_" + repid + "spellsave"] && v["repeating_spell" + cat + "_" + repid + "spellsave"] != "") {
                    update["repeating_attack_" + atkid + "_saveflag"] = "{{save=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}}  {{savedc=[[@{savedc}]]}}";
                    update["repeating_attack_" + atkid + "_saveattr"] = v["repeating_spell" + cat + "_" + repid + "spellsave"];
                    update["repeating_attack_" + atkid + "_saveeffect"] = v["repeating_spell" + cat + "_" + repid + "spellsavesuccess"];
                }
                if(v["repeating_spell" + cat + "_" + repid + "spellhldie"] && v["repeating_spell" + cat + "_" + repid + "spellhldie"] != "" && v["repeating_spell" + cat + "_" + repid + "spellhldietype"] && v["repeating_spell" + cat + "_" + repid + "spellhldietype"] != "") {
                    query = "?{Cast at what level?";
                    for(i = 0; i < 10-v["repeating_spell" + cat + "_" + repid + "spelllevel"]; i++) {
                        query = query + "|Level " + (parseInt(i, 10) + parseInt(v["repeating_spell" + cat + "_" + repid + "spelllevel"], 10)) + "," + i;
                    }
                    query = query + "}";
                    update["repeating_attack_" + atkid + "_hldmg"] = "{{hldmg=[[(" + v["repeating_spell" + cat + "_" + repid + "spellhldie"] + "*" + query + ")" + v["repeating_spell" + cat + "_" + repid + "spellhldietype"] + "]]}}";
                }
                if(v["repeating_spell" + cat + "_" + repid + "spellhealing"] && v["repeating_spell" + cat + "_" + repid + "spellhealing"] != "") {
                    if(!v["repeating_spell" + cat + "_" + repid + "spelldamage"] || v["repeating_spell" + cat + "_" + repid + "spelldamage"] === "") {
                        update["repeating_attack_" + atkid + "_dmgflag"] = "{{damage=1}} {{dmg1flag=1}}";
                        update["repeating_attack_" + atkid + "_dmgbase"] = v["repeating_spell" + cat + "_" + repid + "spellhealing"];
                        update["repeating_attack_" + atkid + "_dmgtype"] = "Healing";
                        if(v["repeating_spell" + cat + "_" + repid + "spelldmgmod"] && v["repeating_spell" + cat + "_" + repid + "spelldmgmod"] === "Yes") {
                            update["repeating_attack_" + atkid + "_dmgattr"] = v.spellcasting_ability.slice(0, -1);
                        }
                        else {
                            update["repeating_attack_" + atkid + "_dmgattr"] = "0";
                        }
                    } 
                    else if(!v["repeating_spell" + cat + "_" + repid + "spelldamage2"] || v["repeating_spell" + cat + "_" + repid + "spelldamage2"] === "") {
                        update["repeating_attack_" + atkid + "_dmg2flag"] = "{{damage=1}} {{dmg2flag=1}}";
                        update["repeating_attack_" + atkid + "_dmg2base"] = v["repeating_spell" + cat + "_" + repid + "spellhealing"];
                        update["repeating_attack_" + atkid + "_dmg2type"] = "Healing";
                        if(v["repeating_spell" + cat + "_" + repid + "spelldmgmod"] && v["repeating_spell" + cat + "_" + repid + "spelldmgmod"] === "Yes") {
                            update["repeating_attack_" + atkid + "_dmg2attr"] = v.spellcasting_ability.slice(0, -1);
                        }
                        else {
                            update["repeating_attack_" + atkid + "_dmg2attr"] = "0";
                        }
                    }
                }
            }
            setAttrs(update);
        });
    };
    
    var updateSpellSlots = function(lvl) {
        if(lvl < 1) {
            l1 = 0; l2 = 0; l3 = 0; l4 = 0; l5 = 0; l6 = 0; l7 = 0; l8 = 0;  l9 = 0;
        }
        else {
            l1 = Math.min((lvl + 1),4);
            if(lvl < 3) {l2 = 0;} else if(lvl === 3) {l2 = 2;} else {l2 = 3;};
            if(lvl < 5) {l3 = 0;} else if(lvl === 5) {l3 = 2;} else {l3 = 3;};
            if(lvl < 7) {l4 = 0;} else if(lvl === 7) {l4 = 1;} else if(lvl === 8) {l4 = 2;} else {l4 = 3;};
            if(lvl < 9) {l5 = 0;} else if(lvl === 9) {l5 = 1;} else if(lvl < 18) {l5 = 2;} else {l5 = 3;};
            if(lvl < 11) {l6 = 0;} else if(lvl < 19) {l6 = 1;} else {l6 = 2;};
            if(lvl < 13) {l7 = 0;} else if(lvl < 20) {l7 = 1;} else {l7 = 2;};
            if(lvl < 15) {l8 = 0;} else {l8 = 1;};
            if(lvl < 17) {l9 = 0;} else {l9 = 1;};
        }
        
        setAttrs({
            lvl1_slots_total: l1,
            lvl2_slots_total: l2,
            lvl3_slots_total: l3,
            lvl4_slots_total: l4,
            lvl5_slots_total: l5,
            lvl6_slots_total: l6,
            lvl7_slots_total: l7,
            lvl8_slots_total: l8,
            lvl9_slots_total: l9
        });
    };
    
    var updateNPC = function() {
        getAttrs(["npc_name","npc_type","npc_ac","npc_actype","hp_max","npc_hpformula","npc_speed","strength","dexterity","constitution","intelligence","wisdom","charisma","npc_str_save","npc_dex_save","npc_con_save","npc_int_save","npc_wis_save","npc_cha_save","npc_acrobatics","npc_animal_handling","npc_arcana","npc_athletics","npc_deception","npc_history","npc_insight","npc_intimidation","npc_investigation","npc_medicine","npc_nature","npc_perception","npc_performance","npc_persuasion","npc_religion","npc_sleight_of_hand","npc_stealth","npc_survival","npc_vulnerabilities","npc_resistances","npc_immunities","npc_condition_immunities","npc_senses","npc_languages","npc_challenge","npc_xp","npc_legendary_actions"], function(v) {
            first_save = 0;
            first_skill = 0;
            hp_max = isNaN(parseInt(v.hp_max, 10)) === false ? parseInt(v.hp_max, 10) : 0;
            actype = v.npc_actype && v.npc_actype != "" ? "(" + v.npc_actype + ")" : "";
            hpformula = v.npc_hpformula && v.npc_hpformula != "" ? "(" + v.npc_hpformula + ")" : "";
            str_mod_base = v.strength && isNaN(v.strength) === false ? Math.floor((parseInt(v.strength, 10) - 10) / 2) : 0;
            str_mod = str_mod_base > -1 ? "(+" + str_mod_base + ")" : "(" + str_mod_base + ")"
            dex_mod_base = v.dexterity && isNaN(v.dexterity) === false ? Math.floor((parseInt(v.dexterity, 10) - 10) / 2) : 0;
            dex_mod = dex_mod_base > -1 ? "(+" + dex_mod_base + ")" : "(" + dex_mod_base + ")"
            con_mod_base = v.constitution && isNaN(v.constitution) === false ? Math.floor((parseInt(v.constitution, 10) - 10) / 2) : 0;
            con_mod = con_mod_base > -1 ? "(+" + con_mod_base + ")" : "(" + con_mod_base + ")"
            int_mod_base = v.intelligence && isNaN(v.intelligence) === false ? Math.floor((parseInt(v.intelligence, 10) - 10) / 2) : 0;
            int_mod = int_mod_base > -1 ? "(+" + int_mod_base + ")" : "(" + int_mod_base + ")"
            wis_mod_base = v.wisdom && isNaN(v.wisdom) === false ? Math.floor((parseInt(v.wisdom, 10) - 10) / 2) : 0;
            wis_mod = wis_mod_base > -1 ? "(+" + wis_mod_base + ")" : "(" + wis_mod_base + ")"
            cha_mod_base = v.charisma && isNaN(v.charisma) === false ? Math.floor((parseInt(v.charisma, 10) - 10) / 2) : 0;
            cha_mod = cha_mod_base > -1 ? "(+" + cha_mod_base + ")" : "(" + cha_mod_base + ")"
            if(v.npc_vulnerabilities && v.npc_vulnerabilities) {vulnerabilities_flag = 1; vulnerabilities = v.npc_vulnerabilities} else {vulnerabilities_flag = 0; vulnerabilities = 0;};
            if(v.npc_resistances && v.npc_resistances) {resistances_flag = 1; resistances = v.npc_resistances} else {resistances_flag = 0; resistances = 0;};
            if(v.npc_immunities && v.npc_immunities) {immunities_flag = 1; immunities = v.npc_immunities} else {immunities_flag = 0; immunities = 0;};
            if(v.npc_condition_immunities && v.npc_condition_immunities) {condition_immunities_flag = 1; condition_immunities = v.npc_condition_immunities} else {condition_immunities_flag = 0; condition_immunities = 0;};
            senses = v.npc_senses && v.npc_senses != "" ? v.npc_senses : "-";
            languages = v.npc_languages && v.npc_languages != "" ? v.npc_languages : "-";
            challenge = v.npc_challenge && v.npc_challenge != "" ? v.npc_challenge : "-";
            xp = v.npc_xp && v.npc_xp != "" ? "(" + v.npc_xp + ")" : "(-)";
            // 1 = First Entry Single Digit, 2 = First Entry Double Digit, 3 = Later Entry Single Digit, 4 = Later Entry Double Digit
            if(v.npc_str_save && v.npc_str_save != "") {str_save = parseInt(v.npc_str_save, 10); if(first_save === 0 && str_save < 10) {str_save_flag = 1} else if(first_save === 0 && str_save > 9) {str_save_flag = 2}  else if(first_save === 1 && str_save < 10) {str_save_flag = 3} else if(first_save === 1 && str_save > 9) {str_save_flag = 4}; first_save = 1;} else {str_save_flag = 0; str_save = "";}
            if(v.npc_dex_save && v.npc_dex_save != "") {dex_save = parseInt(v.npc_dex_save, 10); if(first_save === 0 && dex_save < 10) {dex_save_flag = 1} else if(first_save === 0 && dex_save > 9) {dex_save_flag = 2}  else if(first_save === 1 && dex_save < 10) {dex_save_flag = 3} else if(first_save === 1 && dex_save > 9) {dex_save_flag = 4}; first_save = 1;} else {dex_save_flag = 0; dex_save = "";}
            if(v.npc_con_save && v.npc_con_save != "") {con_save = parseInt(v.npc_con_save, 10); if(first_save === 0 && con_save < 10) {con_save_flag = 1} else if(first_save === 0 && con_save > 9) {con_save_flag = 2}  else if(first_save === 1 && con_save < 10) {con_save_flag = 3} else if(first_save === 1 && con_save > 9) {con_save_flag = 4}; first_save = 1;} else {con_save_flag = 0; con_save = "";}
            if(v.npc_int_save && v.npc_int_save != "") {int_save = parseInt(v.npc_int_save, 10); if(first_save === 0 && int_save < 10) {int_save_flag = 1} else if(first_save === 0 && int_save > 9) {int_save_flag = 2}  else if(first_save === 1 && int_save < 10) {int_save_flag = 3} else if(first_save === 1 && int_save > 9) {int_save_flag = 4}; first_save = 1;} else {int_save_flag = 0; int_save = "";}
            if(v.npc_wis_save && v.npc_wis_save != "") {wis_save = parseInt(v.npc_wis_save, 10); if(first_save === 0 && wis_save < 10) {wis_save_flag = 1} else if(first_save === 0 && wis_save > 9) {wis_save_flag = 2}  else if(first_save === 1 && wis_save < 10) {wis_save_flag = 3} else if(first_save === 1 && wis_save > 9) {wis_save_flag = 4}; first_save = 1;} else {wis_save_flag = 0; wis_save = "";}
            if(v.npc_cha_save && v.npc_cha_save != "") {cha_save = parseInt(v.npc_cha_save, 10); if(first_save === 0 && cha_save < 10) {cha_save_flag = 1} else if(first_save === 0 && cha_save > 9) {cha_save_flag = 2}  else if(first_save === 1 && cha_save < 10) {cha_save_flag = 3} else if(first_save === 1 && cha_save > 9) {cha_save_flag = 4}; first_save = 1;} else {cha_save_flag = 0; cha_save = "";}
            if(v.npc_acrobatics && v.npc_acrobatics != "") {acrobatics = parseInt(v.npc_acrobatics, 10); if(first_skill === 0 && acrobatics < 10) {acrobatics_flag = 1} else if(first_skill === 0 && acrobatics > 9) {acrobatics_flag = 2}  else if(first_skill === 1 && acrobatics < 10) {acrobatics_flag = 3} else if(first_skill === 1 && acrobatics > 9) {acrobatics_flag = 4}; first_skill = 1;} else {acrobatics_flag = 0; acrobatics = "";}
            if(v.npc_animal_handling && v.npc_animal_handling != "") {animal_handling = parseInt(v.npc_animal_handling, 10); if(first_skill === 0 && animal_handling < 10) {animal_handling_flag = 1} else if(first_skill === 0 && animal_handling > 9) {animal_handling_flag = 2}  else if(first_skill === 1 && animal_handling < 10) {animal_handling_flag = 3} else if(first_skill === 1 && animal_handling > 9) {animal_handling_flag = 4}; first_skill = 1;} else {animal_handling_flag = 0; animal_handling = "";}
            if(v.npc_arcana && v.npc_arcana != "") {arcana = parseInt(v.npc_arcana, 10); if(first_skill === 0 && arcana < 10) {arcana_flag = 1} else if(first_skill === 0 && arcana > 9) {arcana_flag = 2}  else if(first_skill === 1 && arcana < 10) {arcana_flag = 3} else if(first_skill === 1 && arcana > 9) {arcana_flag = 4}; first_skill = 1;} else {arcana_flag = 0; arcana = "";}
            if(v.npc_athletics && v.npc_athletics != "") {athletics = parseInt(v.npc_athletics, 10); if(first_skill === 0 && athletics < 10) {athletics_flag = 1} else if(first_skill === 0 && athletics > 9) {athletics_flag = 2}  else if(first_skill === 1 && athletics < 10) {athletics_flag = 3} else if(first_skill === 1 && athletics > 9) {athletics_flag = 4}; first_skill = 1;} else {athletics_flag = 0; athletics = "";}
            if(v.npc_deception && v.npc_deception != "") {deception = parseInt(v.npc_deception, 10); if(first_skill === 0 && deception < 10) {deception_flag = 1} else if(first_skill === 0 && deception > 9) {deception_flag = 2}  else if(first_skill === 1 && deception < 10) {deception_flag = 3} else if(first_skill === 1 && deception > 9) {deception_flag = 4}; first_skill = 1;} else {deception_flag = 0; deception = "";}
            if(v.npc_history && v.npc_history != "") {history = parseInt(v.npc_history, 10); if(first_skill === 0 && history < 10) {history_flag = 1} else if(first_skill === 0 && history > 9) {history_flag = 2}  else if(first_skill === 1 && history < 10) {history_flag = 3} else if(first_skill === 1 && history > 9) {history_flag = 4}; first_skill = 1;} else {history_flag = 0; history = "";}
            if(v.npc_insight && v.npc_insight != "") {insight = parseInt(v.npc_insight, 10); if(first_skill === 0 && insight < 10) {insight_flag = 1} else if(first_skill === 0 && insight > 9) {insight_flag = 2}  else if(first_skill === 1 && insight < 10) {insight_flag = 3} else if(first_skill === 1 && insight > 9) {insight_flag = 4}; first_skill = 1;} else {insight_flag = 0; insight = "";}
            if(v.npc_intimidation && v.npc_intimidation != "") {intimidation = parseInt(v.npc_intimidation, 10); if(first_skill === 0 && intimidation < 10) {intimidation_flag = 1} else if(first_skill === 0 && intimidation > 9) {intimidation_flag = 2}  else if(first_skill === 1 && intimidation < 10) {intimidation_flag = 3} else if(first_skill === 1 && intimidation > 9) {intimidation_flag = 4}; first_skill = 1;} else {intimidation_flag = 0; intimidation = "";}
            if(v.npc_investigation && v.npc_investigation != "") {investigation = parseInt(v.npc_investigation, 10); if(first_skill === 0 && investigation < 10) {investigation_flag = 1} else if(first_skill === 0 && investigation > 9) {investigation_flag = 2}  else if(first_skill === 1 && investigation < 10) {investigation_flag = 3} else if(first_skill === 1 && investigation > 9) {investigation_flag = 4}; first_skill = 1;} else {investigation_flag = 0; investigation = "";}
            if(v.npc_medicine && v.npc_medicine != "") {medicine = parseInt(v.npc_medicine, 10); if(first_skill === 0 && medicine < 10) {medicine_flag = 1} else if(first_skill === 0 && medicine > 9) {medicine_flag = 2}  else if(first_skill === 1 && medicine < 10) {medicine_flag = 3} else if(first_skill === 1 && medicine > 9) {medicine_flag = 4}; first_skill = 1;} else {medicine_flag = 0; medicine = "";}
            if(v.npc_nature && v.npc_nature != "") {nature = parseInt(v.npc_nature, 10); if(first_skill === 0 && nature < 10) {nature_flag = 1} else if(first_skill === 0 && nature > 9) {nature_flag = 2}  else if(first_skill === 1 && nature < 10) {nature_flag = 3} else if(first_skill === 1 && nature > 9) {nature_flag = 4}; first_skill = 1;} else {nature_flag = 0; nature = "";}
            if(v.npc_perception && v.npc_perception != "") {perception = parseInt(v.npc_perception, 10); if(first_skill === 0 && perception < 10) {perception_flag = 1} else if(first_skill === 0 && perception > 9) {perception_flag = 2}  else if(first_skill === 1 && perception < 10) {perception_flag = 3} else if(first_skill === 1 && perception > 9) {perception_flag = 4}; first_skill = 1;} else {perception_flag = 0; perception = "";}
            if(v.npc_performance && v.npc_performance != "") {sperformance = parseInt(v.npc_performance, 10); if(first_skill === 0 && sperformance < 10) {performance_flag = 1} else if(first_skill === 0 && sperformance > 9) {performance_flag = 2}  else if(first_skill === 1 && sperformance < 10) {performance_flag = 3} else if(first_skill === 1 && sperformance > 9) {performance_flag = 4}; first_skill = 1;} else {performance_flag = 0; sperformance = "";}
            if(v.npc_persuasion && v.npc_persuasion != "") {persuasion = parseInt(v.npc_persuasion, 10); if(first_skill === 0 && persuasion < 10) {persuasion_flag = 1} else if(first_skill === 0 && persuasion > 9) {persuasion_flag = 2}  else if(first_skill === 1 && persuasion < 10) {persuasion_flag = 3} else if(first_skill === 1 && persuasion > 9) {persuasion_flag = 4}; first_skill = 1;} else {persuasion_flag = 0; persuasion = "";}
            if(v.npc_religion && v.npc_religion != "") {religion = parseInt(v.npc_religion, 10); if(first_skill === 0 && religion < 10) {religion_flag = 1} else if(first_skill === 0 && religion > 9) {religion_flag = 2}  else if(first_skill === 1 && religion < 10) {religion_flag = 3} else if(first_skill === 1 && religion > 9) {religion_flag = 4}; first_skill = 1;} else {religion_flag = 0; religion = "";}
            if(v.npc_sleight_of_hand && v.npc_sleight_of_hand != "") {sleight_of_hand = parseInt(v.npc_sleight_of_hand, 10); if(first_skill === 0 && sleight_of_hand < 10) {sleight_of_hand_flag = 1} else if(first_skill === 0 && sleight_of_hand > 9) {sleight_of_hand_flag = 2}  else if(first_skill === 1 && sleight_of_hand < 10) {sleight_of_hand_flag = 3} else if(first_skill === 1 && sleight_of_hand > 9) {sleight_of_hand_flag = 4}; first_skill = 1;} else {sleight_of_hand_flag = 0; sleight_of_hand = "";}
            if(v.npc_stealth && v.npc_stealth != "") {stealth = parseInt(v.npc_stealth, 10); if(first_skill === 0 && stealth < 10) {stealth_flag = 1} else if(first_skill === 0 && stealth > 9) {stealth_flag = 2}  else if(first_skill === 1 && stealth < 10) {stealth_flag = 3} else if(first_skill === 1 && stealth > 9) {stealth_flag = 4}; first_skill = 1;} else {stealth_flag = 0; stealth = "";}
            if(v.npc_survival && v.npc_survival != "") {survival = parseInt(v.npc_survival, 10); if(first_skill === 0 && survival < 10) {survival_flag = 1} else if(first_skill === 0 && survival > 9) {survival_flag = 2}  else if(first_skill === 1 && survival < 10) {survival_flag = 3} else if(first_skill === 1 && survival > 9) {survival_flag = 4}; first_skill = 1;} else {survival_flag = 0; survival = "";}
            leg_act = v.npc_legendary_actions && v.npc_legendary_actions != "" ? v.npc_legendary_actions : 0;
            legendary_actions_display = "The " + v.npc_name + " can take " + leg_act + " legendary actions, choosing from the options below. Only one legendary option can be used at a time and only at the end of another creature's turn. The " + v.npc_name + " regains spent legendary actions at the start of its turn."

            setAttrs({
                npcd_name: v.npc_name,
                npcd_type: v.npc_type,
                npcd_ac: v.npc_ac,
                npcd_actype: actype,
                npcd_hp: hp_max,
                npcd_hpformula: hpformula,
                npcd_speed: v.npc_speed,
                npcd_str: v.strength,
                npcd_str_mod: str_mod,
                npcd_dex: v.dexterity,
                npcd_dex_mod: dex_mod,
                npcd_con: v.constitution,
                npcd_con_mod: con_mod,
                npcd_int: v.intelligence,
                npcd_int_mod: int_mod,
                npcd_wis: v.wisdom,
                npcd_wis_mod: wis_mod,
                npcd_cha: v.charisma,
                npcd_cha_mod: cha_mod,
                npcd_str_save: str_save,
                npc_str_save_flag: str_save_flag,
                npcd_dex_save: dex_save,
                npc_dex_save_flag: dex_save_flag,
                npcd_con_save: con_save,
                npc_con_save_flag: con_save_flag,
                npcd_int_save: int_save,
                npc_int_save_flag: int_save_flag,
                npcd_wis_save: wis_save,
                npc_wis_save_flag: wis_save_flag,
                npcd_cha_save: cha_save,
                npc_cha_save_flag: cha_save_flag,
                npc_saving_flag: first_save,
                npcd_acrobatics: acrobatics,
                npc_acrobatics_flag: acrobatics_flag,
                npcd_animal_handling: animal_handling,
                npc_animal_handling_flag: animal_handling_flag,
                npcd_arcana: arcana,
                npc_arcana_flag: arcana_flag,
                npcd_athletics: athletics,
                npc_athletics_flag: athletics_flag,
                npcd_deception: deception,
                npc_deception_flag: deception_flag,
                npcd_history: history,
                npc_history_flag: history_flag,
                npcd_insight: insight,
                npc_insight_flag: insight_flag,
                npcd_intimidation: intimidation,
                npc_intimidation_flag: intimidation_flag,
                npcd_investigation: investigation,
                npc_investigation_flag: investigation_flag,
                npcd_medicine: medicine,
                npc_medicine_flag: medicine_flag,
                npcd_nature: nature,
                npc_nature_flag: nature_flag,
                npcd_perception: perception,
                npc_perception_flag: perception_flag,
                npcd_performance: sperformance,
                npc_performance_flag: performance_flag,
                npcd_persuasion: persuasion,
                npc_persuasion_flag: persuasion_flag,
                npcd_religion: religion,
                npc_religion_flag: religion_flag,
                npcd_sleight_of_hand: sleight_of_hand,
                npc_sleight_of_hand_flag: sleight_of_hand_flag,
                npcd_stealth: stealth,
                npc_stealth_flag: stealth_flag,
                npcd_survival: survival,
                npc_survival_flag: survival_flag,
                npc_skills_flag: first_skill,
                npcd_vulnerabilities: vulnerabilities,
                npc_vulnerabilities_flag: vulnerabilities_flag,
                npcd_resistances: resistances,
                npc_resistances_flag: resistances_flag,
                npcd_immunities: immunities,
                npc_immunities_flag: immunities_flag,
                npcd_condition_immunities: condition_immunities,
                npc_condition_immunities_flag: condition_immunities_flag,
                npcd_senses: senses,
                npcd_languages: languages,
                npcd_challenge: challenge,
                npcd_xp: xp,
                legendary_flag: leg_act,
                legendary_actions_display: legendary_actions_display
            });
        });
    };
    
    var updateNPCaction = function() {
        getAttrs(["repeating_npcaction_name","repeating_npcaction_attack_flag","repeating_npcaction_attack_type","repeating_npcaction_attack_range","repeating_npcaction_attack_target","repeating_npcaction_attack_tohit","repeating_npcaction_attack_damage","repeating_npcaction_attack_damagetype","repeating_npcaction_attack_damage2","repeating_npcaction_attack_damagetype2","repeating_npcaction_description"], function(v) {
            var onhit = "";
            var damage_flag = "";
            description_flag = v.repeating_npcaction_description && v.repeating_npcaction_description != "" ? Math.max(Math.ceil(v.repeating_npcaction_description.length/57),1) : 0;
            attack_flag = v.repeating_npcaction_attack_flag && v.repeating_npcaction_attack_flag != "0" ? "{{attack=1}}" : 0;
            attack_type = v.repeating_npcaction_attack_type + " Weapon Attack:";
            tohit = v.repeating_npcaction_attack_tohit && isNaN(parseInt(v.repeating_npcaction_attack_tohit, 10)) === false ? parseInt(v.repeating_npcaction_attack_tohit, 10) : 0;
            if(v.repeating_npcaction_attack_range && v.repeating_npcaction_attack_range) {
                if(v.repeating_npcaction_attack_type === "Melee") {rangetype = "Reach";}
                else {rangetype = "Range";}
                range = ", " + rangetype + " " + v.repeating_npcaction_attack_range
            }
            else {range = "";}
            target = v.repeating_npcaction_attack_target && v.repeating_npcaction_attack_target != "" ? ", " + v.repeating_npcaction_attack_target : ""
            attack_tohitrange = "+" + tohit + range + target + ".";
            dmg1 = v.repeating_npcaction_attack_damage && v.repeating_npcaction_attack_damage != "" ? v.repeating_npcaction_attack_damage : "";
            dmg1type = v.repeating_npcaction_attack_damagetype && v.repeating_npcaction_attack_damagetype != "" ? " " + v.repeating_npcaction_attack_damagetype : "";
            dmg2 = v.repeating_npcaction_attack_damage2 && v.repeating_npcaction_attack_damage2 != "" ? v.repeating_npcaction_attack_damage2 : "";
            dmg2type = v.repeating_npcaction_attack_damagetype2 && v.repeating_npcaction_attack_damagetype2 != "" ? " " + v.repeating_npcaction_attack_damagetype2 : "";
            dmgspacer = dmg1 != "" && dmg2 != "" ? " plus " : "";
            if(dmg1 != "") {
                dmg1t = dmg1.replace(/\s/g, '').split(/[d+]+/);
                dmg1t2 = isNaN(eval(dmg1t[1])) === false ? eval(dmg1t[1]) : 0;
                if(dmg1t.length < 2) {
                    onhit = onhit + dmg1t[0] + " (" + dmg1 + ")" + dmg1type + " damage";
                }
                else if(dmg1t.length < 3) {
                    onhit = onhit + Math.floor(dmg1t[0]*((dmg1t2/2)+0.5)) + " (" + dmg1 + ")" + dmg1type + " damage";
                }
                else {
                    onhit = onhit + (Math.floor(dmg1t[0]*((dmg1t2/2)+0.5))+parseInt(dmg1t[2],10)) + " (" + dmg1 + ")" + dmg1type + " damage";
                };
            };
            dmgspacer = dmg1 != "" && dmg2 != "" ? " plus " : "";
            onhit = onhit + dmgspacer;
            if(dmg2 != "") {
                dmg2t = dmg2.replace(/\s/g, '').split(/[d+]+/);
                dmg2t2 = isNaN(eval(dmg2t[1])) === false ? eval(dmg2t[1]) : 0;
                if(dmg2t.length < 2) {
                    onhit = onhit + dmg2t[0] + " (" + dmg2 + ")" + dmg2type + " damage";
                }
                else if(dmg2t.length < 3) {
                    onhit = onhit + Math.floor(dmg2t[0]*((dmg2t2/2)+0.5)) + " (" + dmg2 + ")" + dmg2type + " damage";
                }
                else {
                    onhit = onhit + (Math.floor(dmg2t[0]*((dmg2t2/2)+0.5))+parseInt(dmg2t[2],10)) + " (" + dmg2 + ")" + dmg2type + " damage";
                };
            };
            if(dmg1 != "" || dmg2 != "") {damage_flag = damage_flag + "{{damage=1}} "};
            if(dmg1 != "") {damage_flag = damage_flag + "{{dmg1flag=1}} "};
            if(dmg2 != "") {damage_flag = damage_flag + "{{dmg2flag=1}} "};
            crit1 = dmg1 != "" && dmg1t.length > 1 ? dmg1t[0] + "d" + dmg1t[1] : "";
            crit2 = dmg2 != "" && dmg2t.length > 1 ? dmg2t[0] + "d" + dmg2t[1] : "";
            setAttrs({
                repeating_npcaction_name_display: v.repeating_npcaction_name + ".",
                repeating_npcaction_attack_display_flag: attack_flag,
                repeating_npcaction_attack_options: attack_flag,
                repeating_npcaction_attack_type_display: attack_type,
                repeating_npcaction_attack_tohitrange: attack_tohitrange,
                repeating_npcaction_attack_onhit: onhit,
                repeating_npcaction_description_flag: description_flag,
                repeating_npcaction_damage_flag: damage_flag,
                repeating_npcaction_attack_crit: crit1,
                repeating_npcaction_attack_crit2: crit2
            });
        });
    };

    var force_refresh_spells = function() {
        spellcats = ["cantrip","1","2","3","4","5","6","7","8","9"];
        _.each(spellcats, function(cat) {
            getSectionIDs("repeating_spell-" + cat, function(idarray) {
                _.each(idarray, function(currentID, i) {
                    updateSpell(currentID,cat);
                    // getAttrs(["repeating_spell-" + cat + "_" + currentID + "_spell_updateflag"], function(v) {
                    //     update = {};
                    //     toggle = v["repeating_spell-" + cat + "_" + currentID + "_spell_updateflag"] === true ? false : true;
                    //     update["repeating_spell-" + cat + "_" + currentID + "_spell_updateflag"] = toggle;
                    //     setAttrs(update);
                    // });
                });
            });
        })
    }

    var force_refresh_attacks = function() {
        getSectionIDs("repeating_attack", function(idarray) {
            _.each(idarray, function(currentID, i) {
                getAttrs(["repeating_attack_" + currentID + "_updateflag"], function(v) {
                    update = {};
                    toggle = v["repeating_attack_" + currentID + "_updateflag"] === true ? false : true;
                    update["repeating_attack_" + currentID + "_updateflag"] = toggle;
                    setAttrs(update);
                });
            });
        });
    }

    var upgrade_1_1_to_1_2 = function() {
        force_refresh_spells();
        force_refresh_attacks();
    }
    
    var versioning = function() {
        getAttrs(["version"], function(v) {
            if(!v["version"] || v["version"] === "") {
                console.log("UPGRADING TO v1.0");
                setAttrs({version: "1.0"});
                versioning();
            }
            else if(v["version"] === "1.0") {
                console.log("UPGRADING TO v1.1");
                setAttrs({version: "1.1"});
                versioning();
            }
            else if(v["version"] === "1.1") {
                console.log("UPGRADING TO v1.2");
                upgrade_1_1_to_1_2();
                setAttrs({version: "1.2"});
                versioning();
            }
            else {
                console.log("5th Edition OGL by Roll20 version " + v["version"]);
            }
        });
    };
    
</script>
